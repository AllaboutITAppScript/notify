<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏£‡∏ß‡∏°‡∏®‡∏π‡∏ô‡∏¢‡πå</title>
    <meta name="theme-color" content="#121826">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" id="manifestLink">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    
    <style>
        body {
            background-color: #121826;
            color: #e5e7eb;
            font-family: 'Sarabun', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Prompt', sans-serif;
        }
        
        /* Mobile app style containers */
        .app-container {
            max-width: 480px;
            margin: 0 auto;
            background: #121826;
            min-height: 100vh;
            position: relative;
        }
        
        /* iOS-style notifications */
        .ios-notification {
            background: rgba(40, 40, 40, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 14px;
            padding: 16px;
            margin: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .ios-notification::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3B82F6, #8B5CF6);
        }
        
        /* iOS-style buttons */
        .ios-btn {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px 20px;
            border: none;
            color: white;
            font-weight: 500;
            transition: all 0.2s;
            backdrop-filter: blur(10px);
            cursor: pointer;
        }
        
        .ios-btn:active {
            transform: scale(0.98);
            background: rgba(255, 255, 255, 0.2);
        }
        
        .ios-btn-primary {
            background: linear-gradient(135deg, #3B82F6, #1D4ED8);
        }
        
        /* Floating notification panel */
        .notification-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
        }
        
        .notification-panel.active {
            transform: translateY(0);
        }
        
        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Status indicators */
        .status-connected { color: #10b981; }
        .status-disconnected { color: #ef4444; }
        .status-connecting { color: #f59e0b; }
        
        /* Notification badge */
        .notification-badge {
            background-color: #FF3B30;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 12px;
            font-weight: bold;
            position: absolute;
            top: -5px;
            right: -5px;
            min-width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Mobile navigation */
        .mobile-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(30, 30, 40, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: 12px 0;
            z-index: 50;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #9ca3af;
            transition: all 0.2s;
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
        }
        
        .nav-item.active {
            color: #3B82F6;
        }
        
        .nav-item:active {
            transform: scale(0.95);
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }
        
        /* iOS-style switches */
        .ios-switch {
            position: relative;
            display: inline-block;
            width: 52px;
            height: 32px;
        }
        
        .ios-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .ios-switch-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #4b5563;
            transition: .4s;
            border-radius: 34px;
        }
        
        .ios-switch-slider:before {
            position: absolute;
            content: "";
            height: 24px;
            width: 24px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .ios-switch-slider {
            background-color: #3B82F6;
        }
        
        input:checked + .ios-switch-slider:before {
            transform: translateX(20px);
        }
        
        /* Vibration effect */
        @keyframes vibrate {
            0% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            50% { transform: translateX(2px); }
            75% { transform: translateX(-2px); }
            100% { transform: translateX(0); }
        }
        
        .vibrate {
            animation: vibrate 0.3s linear;
        }
        
        /* Mobile app launch animation */
        .app-launch {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #121826, #1f2937);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.5s ease-out;
        }
        
        .app-icon-large {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- App Launch Screen -->
    <div id="appLaunch" class="app-launch">
        <div class="app-icon-large">
            <i class="fas fa-bell"></i>
        </div>
        <h1 class="text-2xl font-bold mt-4 mb-2">‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏£‡∏ß‡∏°‡∏®‡∏π‡∏ô‡∏¢‡πå</h1>
        <p class="text-gray-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
        <div class="mt-8 w-48 h-1 bg-gray-700 rounded-full overflow-hidden">
            <div id="loadingBar" class="h-full bg-blue-500" style="width: 0%"></div>
        </div>
    </div>
    
    <!-- iOS Style Push Notification -->
    <div id="pushNotification" class="fixed top-4 left-4 right-4 z-50 ios-notification hidden" style="transform: translateY(-100%); transition: transform 0.3s ease-out">
        <div class="flex items-start">
            <div class="flex-shrink-0 mr-3">
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center">
                    <i class="fas fa-bell text-white"></i>
                </div>
            </div>
            <div class="flex-1">
                <div class="flex justify-between items-start">
                    <h3 id="pushTitle" class="font-bold text-white">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
                    <span id="pushTime" class="text-xs text-gray-400">‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</span>
                </div>
                <p id="pushMessage" class="text-gray-300 text-sm mt-1">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
            </div>
            <button onclick="closePushNotification()" class="ml-2 text-gray-400 hover:text-white bg-transparent border-none">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="mt-3 flex space-x-2">
            <button onclick="viewNotificationDetails()" class="flex-1 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm">
                ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
            </button>
            <button onclick="closePushNotification()" class="flex-1 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm">
                ‡∏õ‡∏¥‡∏î
            </button>
        </div>
    </div>
    
    <!-- Notification Panel -->
    <div id="notificationPanel" class="notification-panel">
        <div class="p-4 border-b border-gray-800">
            <div class="flex items-center justify-between">
                <h2 class="text-xl font-bold">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h2>
                <button onclick="closeNotificationPanel()" class="p-2 rounded-full bg-gray-800 border-none">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div id="notificationList" class="flex-1 overflow-y-auto p-4">
            <!-- Notifications will be loaded here -->
        </div>
        <div class="p-4 border-t border-gray-800">
            <button onclick="clearAllNotifications()" class="w-full py-3 bg-red-900/30 hover:bg-red-800/50 rounded-lg text-center">
                ‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            </button>
        </div>
    </div>
    
    <!-- Main App Container -->
    <div class="app-container pb-20">
        <!-- Header -->
        <div class="sticky top-0 z-30 bg-gray-900/95 backdrop-blur-lg border-b border-gray-800">
            <div class="flex items-center justify-between p-4">
                <div class="flex items-center">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center mr-3">
                        <i class="fas fa-bell text-white"></i>
                    </div>
                    <div>
                        <h1 class="font-bold text-lg">‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h1>
                        <div class="flex items-center">
                            <div id="statusDot" class="w-2 h-2 rounded-full bg-green-500 mr-2 pulse"></div>
                            <span id="statusText" class="text-xs text-green-400">‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</span>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button onclick="openNotificationPanel()" class="relative bg-transparent border-none">
                        <i class="fas fa-bell text-xl text-gray-300"></i>
                        <div id="headerBadge" class="notification-badge hidden">0</div>
                    </button>
                    <button onclick="refreshData()" class="p-2 rounded-full bg-gray-800 border-none">
                        <i class="fas fa-sync-alt text-gray-300"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Connection Status -->
        <div id="connectionStatus" class="m-4 p-4 bg-green-900/30 rounded-xl border border-green-700/50">
            <div class="flex items-center">
                <div class="w-3 h-3 rounded-full bg-green-500 mr-3 pulse"></div>
                <div class="flex-1">
                    <h3 class="font-bold text-green-300">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h3>
                    <p class="text-sm text-green-400 mt-1">‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
                </div>
            </div>
            <div class="mt-3 grid grid-cols-3 gap-2 text-center">
                <div>
                    <div class="text-2xl font-bold text-green-300" id="syncCount">0</div>
                    <div class="text-xs text-green-400">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-blue-300" id="totalAlarms">0</div>
                    <div class="text-xs text-blue-400">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-purple-300" id="totalBroadcasts">0</div>
                    <div class="text-xs text-purple-400">‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</div>
                </div>
            </div>
        </div>
        
        <!-- Current Time Display -->
        <div class="px-4">
            <div class="ios-notification">
                <div class="text-center">
                    <div id="currentTime" class="text-3xl font-bold mb-2">--:--:--</div>
                    <div id="currentDate" class="text-gray-400">-</div>
                    <div class="mt-4 flex justify-between items-center">
                        <div class="text-left">
                            <div class="text-sm text-gray-400">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</div>
                            <div id="nextAlarmTime" class="font-medium">‡πÑ‡∏°‡πà‡∏°‡∏µ</div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm text-gray-400">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                            <div class="font-medium">1</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="px-4 my-4">
            <h2 class="text-lg font-bold mb-3">‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡πà‡∏ß‡∏ô</h2>
            <div class="grid grid-cols-2 gap-3">
                <button onclick="scrollToForm()" class="ios-btn flex flex-col items-center p-4">
                    <i class="fas fa-plus-circle text-blue-400 text-2xl mb-2"></i>
                    <span class="text-sm font-medium">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</span>
                </button>
                <button onclick="openNotificationPanel()" class="ios-btn flex flex-col items-center p-4 relative">
                    <i class="fas fa-bell text-yellow-400 text-2xl mb-2"></i>
                    <span class="text-sm font-medium">‡∏î‡∏π‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</span>
                    <div id="quickBadge" class="notification-badge hidden">0</div>
                </button>
                <button onclick="scrollToBroadcast()" class="ios-btn flex flex-col items-center p-4">
                    <i class="fas fa-broadcast-tower text-purple-400 text-2xl mb-2"></i>
                    <span class="text-sm font-medium">‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</span>
                </button>
                <button onclick="testNotification()" class="ios-btn flex flex-col items-center p-4">
                    <i class="fas fa-vibrate text-green-400 text-2xl mb-2"></i>
                    <span class="text-sm font-medium">‡∏ó‡∏î‡∏™‡∏≠‡∏ö</span>
                </button>
            </div>
        </div>
        
        <!-- Add Alarm Form -->
        <div id="addAlarmSection" class="p-4 bg-gray-900 mx-4 rounded-2xl mb-6">
            <h2 class="text-lg font-bold mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà</h2>
            <form id="alarmForm" class="space-y-4">
                <div>
                    <label class="block text-gray-400 text-sm mb-2">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</label>
                    <input 
                        type="text" 
                        id="title" 
                        class="w-full p-3 bg-gray-800 border border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏ó‡∏µ‡∏°, ‡∏ô‡∏±‡∏î‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå"
                        required
                    >
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-400 text-sm mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                        <input 
                            type="date" 
                            id="date" 
                            class="w-full p-3 bg-gray-800 border border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            required
                        >
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm mb-2">‡πÄ‡∏ß‡∏•‡∏≤</label>
                        <input 
                            type="time" 
                            id="time" 
                            class="w-full p-3 bg-gray-800 border border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            required
                        >
                    </div>
                </div>
                
                <div>
                    <label class="block text-gray-400 text-sm mb-2">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                    <textarea 
                        id="description" 
                        rows="2"
                        class="w-full p-3 bg-gray-800 border border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô"
                    ></textarea>
                </div>
                
                <div>
                    <label class="block text-gray-400 text-sm mb-3">‡∏ó‡∏≥‡∏ã‡πâ‡∏≥</label>
                    <div class="flex flex-wrap gap-2">
                        <button type="button" onclick="setRepeat('none')" class="px-4 py-2 bg-blue-600 rounded-lg text-sm" id="repeatNone">‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏ã‡πâ‡∏≥</button>
                        <button type="button" onclick="setRepeat('daily')" class="px-4 py-2 bg-gray-800 rounded-lg text-sm" id="repeatDaily">‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô</button>
                        <button type="button" onclick="setRepeat('weekly')" class="px-4 py-2 bg-gray-800 rounded-lg text-sm" id="repeatWeekly">‡∏ó‡∏∏‡∏Å‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</button>
                        <button type="button" onclick="setRepeat('monthly')" class="px-4 py-2 bg-gray-800 rounded-lg text-sm" id="repeatMonthly">‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
                    </div>
                </div>
                
                <div class="pt-4">
                    <button type="submit" class="w-full ios-btn ios-btn-primary py-3 rounded-xl">
                        <i class="fas fa-plus-circle mr-2"></i>‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                    </button>
                </div>
            </form>
        </div>
        
        <!-- All Alarms Section -->
        <div id="allAlarmsSection" class="px-4 mb-6">
            <div class="flex justify-between items-center mb-3">
                <h2 class="text-lg font-bold">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
                <button onclick="refreshAlarms()" class="text-sm text-blue-400">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
            </div>
            <div id="allAlarms" class="space-y-3">
                <!-- All alarms will be loaded here -->
                <div class="ios-notification text-center py-6">
                    <i class="fas fa-clock text-3xl text-gray-500 mb-3"></i>
                    <p class="text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
                </div>
            </div>
        </div>
        
        <!-- Broadcast Section -->
        <div id="broadcastSection" class="p-4 bg-purple-900/30 mx-4 rounded-2xl mb-6">
            <h2 class="text-lg font-bold mb-4 text-purple-300">
                <i class="fas fa-broadcast-tower mr-2"></i>‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏î‡πà‡∏ß‡∏ô
            </h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-gray-400 text-sm mb-2">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</label>
                    <input 
                        type="text" 
                        id="broadcastTitle" 
                        class="w-full p-3 bg-gray-800 border border-gray-700 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                        placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏î‡πà‡∏ß‡∏ô, ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß"
                    >
                </div>
                <div>
                    <label class="block text-gray-400 text-sm mb-2">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</label>
                    <textarea 
                        id="broadcastMessage" 
                        rows="2"
                        class="w-full p-3 bg-gray-800 border border-gray-700 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                        placeholder="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏î‡πà‡∏ß‡∏ô"
                    ></textarea>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="sendBroadcast()" class="ios-btn bg-purple-600 hover:bg-purple-700">
                        <i class="fas fa-paper-plane mr-2"></i>‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®
                    </button>
                    <button onclick="clearBroadcastForm()" class="ios-btn bg-gray-800 hover:bg-gray-700">
                        <i class="fas fa-trash mr-2"></i>‡∏•‡πâ‡∏≤‡∏á
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Settings -->
        <div class="p-4 mb-24" id="settingsSection">
            <h2 class="text-lg font-bold mb-4">‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h2>
            <div class="space-y-4">
                <div class="ios-notification">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h3 class="font-bold">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö Push</h3>
                            <p class="text-sm text-gray-400">‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö Mobile App</p>
                        </div>
                        <label class="ios-switch">
                            <input type="checkbox" id="pushToggle" checked>
                            <span class="ios-switch-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h3 class="font-bold">‡∏™‡∏±‡πà‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
                            <p class="text-sm text-gray-400">‡∏™‡∏±‡πà‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
                        </div>
                        <label class="ios-switch">
                            <input type="checkbox" id="vibrationToggle" checked>
                            <span class="ios-switch-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-bold">‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
                            <p class="text-sm text-gray-400">‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
                        </div>
                        <label class="ios-switch">
                            <input type="checkbox" id="soundToggle" checked>
                            <span class="ios-switch-slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="ios-notification">
                    <div class="space-y-3">
                        <button onclick="requestNotificationPermission()" class="w-full ios-btn">
                            <i class="fas fa-bell mr-2"></i>‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                        </button>
                        <button onclick="showInstallPrompt()" class="w-full ios-btn">
                            <i class="fas fa-download mr-2"></i>‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏≠‡∏õ
                        </button>
                        <button onclick="testConnection()" class="w-full ios-btn">
                            <i class="fas fa-wifi mr-2"></i>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                        </button>
                        <button onclick="showClearAllDialog()" class="w-full ios-btn bg-red-900/30 hover:bg-red-800/50">
                            <i class="fas fa-trash mr-2"></i>‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Mobile Navigation -->
        <div class="mobile-nav">
            <div class="flex justify-around">
                <button onclick="scrollToTop()" class="nav-item">
                    <i class="fas fa-home text-xl mb-1"></i>
                    <span class="text-xs">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</span>
                </button>
                <button onclick="scrollToForm()" class="nav-item">
                    <i class="fas fa-plus text-xl mb-1"></i>
                    <span class="text-xs">‡πÄ‡∏û‡∏¥‡πà‡∏°</span>
                </button>
                <button onclick="openNotificationPanel()" class="nav-item relative">
                    <i class="fas fa-bell text-xl mb-1"></i>
                    <span class="text-xs">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</span>
                    <div id="navBadge" class="notification-badge hidden">0</div>
                </button>
                <button onclick="scrollToBroadcast()" class="nav-item">
                    <i class="fas fa-broadcast-tower text-xl mb-1"></i>
                    <span class="text-xs">‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</span>
                </button>
                <button onclick="scrollToSettings()" class="nav-item">
                    <i class="fas fa-cog text-xl mb-1"></i>
                    <span class="text-xs">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
    
    <!-- Main Application Script -->
    <script>
        // ================================
        // ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
        // ================================
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwpOYJ_pB6Llu9bd7RJABMd0awxu09oVFPB1cK4zsq3-aBYze5EpSHTSGgO1EcSJ3DwpQ/exec";
        
        // ================================
        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        // ================================
        let alarms = [];
        let notifications = [];
        let broadcastMessages = [];
        let userId = '';
        let userName = '';
        let settings = {};
        
        // ================================
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
        // ================================
        async function initApp() {
            console.log('üöÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô...');
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏î‡∏∂‡∏á User ID
            userId = localStorage.getItem('userId');
            if (!userId) {
                userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('userId', userId);
            }
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏î‡∏∂‡∏á User Name
            userName = localStorage.getItem('userName');
            if (!userName) {
                userName = `‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ${Math.floor(Math.random() * 1000)}`;
                localStorage.setItem('userName', userName);
            }
            
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
            loadSettings();
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').min = today;
            document.getElementById('date').value = today;
            
            const nextHour = new Date();
            nextHour.setHours(nextHour.getHours() + 1);
            document.getElementById('time').value = `${nextHour.getHours().toString().padStart(2, '0')}:00`;
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏≥‡∏ã‡πâ‡∏≥
            setRepeat('none');
            
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            loadAlarms();
            loadNotifications();
            loadBroadcastMessages();
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
            updateCurrentTime();
            updateBadges();
            updateCounts();
            
            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå
            setInterval(updateCurrentTime, 1000);
            setInterval(checkAlarms, 1000);
            setInterval(checkConnection, 30000);
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
            await testConnection();
            
            // ‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            setTimeout(() => {
                if (Notification.permission === 'default') {
                    requestNotificationPermission();
                }
            }, 3000);
            
            // ‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÇ‡∏´‡∏•‡∏î
            simulateLoading();
            
            console.log('‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
        }
        
        // ================================
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        // ================================
        function loadSettings() {
            settings = JSON.parse(localStorage.getItem('notificationSettings')) || {
                pushEnabled: true,
                vibrationEnabled: true,
                soundEnabled: true,
                notificationPermission: 'default'
            };
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
            document.getElementById('pushToggle').checked = settings.pushEnabled;
            document.getElementById('vibrationToggle').checked = settings.vibrationEnabled;
            document.getElementById('soundToggle').checked = settings.soundEnabled;
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
            saveSettings();
        }
        
        function saveSettings() {
            settings.pushEnabled = document.getElementById('pushToggle').checked;
            settings.vibrationEnabled = document.getElementById('vibrationToggle').checked;
            settings.soundEnabled = document.getElementById('soundToggle').checked;
            localStorage.setItem('notificationSettings', JSON.stringify(settings));
        }
        
        function loadAlarms() {
            alarms = JSON.parse(localStorage.getItem('alarms')) || [];
            renderAlarms();
            updateCounts();
        }
        
        function loadNotifications() {
            notifications = JSON.parse(localStorage.getItem('notifications')) || [];
            updateBadges();
        }
        
        function loadBroadcastMessages() {
            broadcastMessages = JSON.parse(localStorage.getItem('broadcastMessages')) || [];
            updateCounts();
        }
        
        // ================================
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• UI
        // ================================
        function renderAlarms() {
            const allAlarmsContainer = document.getElementById('allAlarms');
            
            if (alarms.length === 0) {
                allAlarmsContainer.innerHTML = `
                    <div class="ios-notification text-center py-6">
                        <i class="fas fa-clock text-3xl text-gray-500 mb-3"></i>
                        <p class="text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
                        <p class="text-sm text-gray-500 mt-2">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</p>
                    </div>
                `;
                updateNextAlarm();
                return;
            }
            
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤ (‡πÉ‡∏Å‡∏•‡πâ‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô)
            alarms.sort((a, b) => new Date(a.datetime) - new Date(b.datetime));
            
            allAlarmsContainer.innerHTML = '';
            const now = new Date();
            
            alarms.forEach(alarm => {
                const alarmDate = new Date(alarm.datetime);
                const isPast = alarmDate < now;
                const isTriggered = alarm.triggered || false;
                
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠
                const timeDiff = alarmDate - now;
                const hoursDiff = Math.floor(timeDiff / (1000 * 60 * 60));
                
                let timeBadge = '';
                if (isTriggered) {
                    timeBadge = `<span class="text-xs px-2 py-1 bg-green-900/30 text-green-300 rounded">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß</span>`;
                } else if (isPast) {
                    timeBadge = `<span class="text-xs px-2 py-1 bg-gray-900/30 text-gray-300 rounded">‡πÄ‡∏•‡∏¢‡πÄ‡∏ß‡∏•‡∏≤</span>`;
                } else if (hoursDiff < 24) {
                    timeBadge = `<span class="text-xs px-2 py-1 bg-red-900/30 text-red-300 rounded">${hoursDiff} ‡∏ä‡∏°.</span>`;
                } else if (hoursDiff < 168) {
                    timeBadge = `<span class="text-xs px-2 py-1 bg-yellow-900/30 text-yellow-300 rounded">${Math.floor(hoursDiff/24)} ‡∏ß‡∏±‡∏ô</span>`;
                }
                
                const alarmElement = document.createElement('div');
                alarmElement.className = 'ios-notification';
                alarmElement.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h3 class="font-bold ${isTriggered ? 'text-gray-400' : 'text-white'}">${alarm.title}</h3>
                            <p class="text-sm text-gray-400 mt-1">${alarm.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î'}</p>
                        </div>
                        <div class="text-right ml-4">
                            <div class="text-sm font-medium">${alarmDate.toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'})}</div>
                            <div class="text-xs text-gray-500">${alarmDate.toLocaleDateString('th-TH', {day: 'numeric', month: 'short'})}</div>
                        </div>
                    </div>
                    <div class="mt-3 flex items-center justify-between">
                        <div class="flex space-x-2">
                            <span class="text-xs px-2 py-1 bg-blue-900/30 text-blue-300 rounded">${getRepeatText(alarm.repeat)}</span>
                            ${timeBadge}
                            ${alarm.synced ? '<span class="text-xs px-2 py-1 bg-green-900/30 text-green-300 rounded"><i class="fas fa-cloud mr-1"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span>' : ''}
                        </div>
                        <div class="flex space-x-2">
                            ${!isTriggered ? `
                                <button onclick="testAlarmNow('${alarm.id}')" class="text-xs px-2 py-1 bg-yellow-900/30 text-yellow-300 rounded hover:bg-yellow-800/50">
                                    <i class="fas fa-bell mr-1"></i>‡∏ó‡∏î‡∏™‡∏≠‡∏ö
                                </button>
                            ` : ''}
                            <button onclick="deleteAlarmPrompt('${alarm.id}')" class="text-xs px-2 py-1 bg-red-900/30 text-red-300 rounded hover:bg-red-800/50">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                allAlarmsContainer.appendChild(alarmElement);
            });
            
            updateNextAlarm();
        }
        
        function updateNextAlarm() {
            const now = new Date();
            const upcomingAlarms = alarms.filter(alarm => 
                !alarm.triggered && new Date(alarm.datetime) > now
            );
            
            if (upcomingAlarms.length > 0) {
                const nextAlarm = upcomingAlarms[0];
                const nextAlarmDate = new Date(nextAlarm.datetime);
                document.getElementById('nextAlarmTime').textContent = 
                    `${nextAlarmDate.toLocaleDateString('th-TH', {day: 'numeric', month: 'short'})} ${nextAlarmDate.toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'})}`;
            } else {
                document.getElementById('nextAlarmTime').textContent = '‡πÑ‡∏°‡πà‡∏°‡∏µ';
            }
        }
        
        function updateCurrentTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('th-TH', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('currentDate').textContent = now.toLocaleDateString('th-TH', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        function updateBadges() {
            const unreadCount = notifications.length;
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏∏‡∏Å‡πÅ‡∏ö‡∏î‡∏à‡πå
            const badges = ['headerBadge', 'navBadge', 'quickBadge'];
            badges.forEach(badgeId => {
                const badge = document.getElementById(badgeId);
                if (unreadCount > 0) {
                    badge.textContent = unreadCount > 99 ? '99+' : unreadCount;
                    badge.classList.remove('hidden');
                } else {
                    badge.classList.add('hidden');
                }
            });
        }
        
        function updateCounts() {
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            document.getElementById('totalAlarms').textContent = alarms.length;
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheets
            const syncedCount = alarms.filter(alarm => alarm.synced).length;
            document.getElementById('syncCount').textContent = syncedCount;
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®
            document.getElementById('totalBroadcasts').textContent = broadcastMessages.length;
        }
        
        // ================================
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        // ================================
        function checkAlarms() {
            const now = new Date();
            
            alarms.forEach((alarm, index) => {
                if (!alarm.triggered && new Date(alarm.datetime) <= now) {
                    triggerAlarm(alarm.id);
                }
            });
        }
        
        async function triggerAlarm(alarmId) {
            const alarmIndex = alarms.findIndex(a => a.id === alarmId);
            if (alarmIndex === -1) return;
            
            const alarm = alarms[alarmIndex];
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
            alarms[alarmIndex].triggered = true;
            alarms[alarmIndex].triggered_at = new Date().toISOString();
            localStorage.setItem('alarms', JSON.stringify(alarms));
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheets
            await updateAlarmStatusInSheets(alarm.id, 'triggered');
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            addNotification({
                type: 'alarm',
                title: alarm.title,
                message: alarm.description || '‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏∂‡∏á‡πÅ‡∏•‡πâ‡∏ß!',
                timestamp: new Date().toISOString(),
                alarmId: alarm.id,
                read: false
            });
            
            // ‡∏™‡πà‡∏á Push Notification
            sendPushNotification(alarm.title, alarm.description || '‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏∂‡∏á‡πÅ‡∏•‡πâ‡∏ß!', 'alarm');
            
            // ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏ã‡πâ‡∏≥ ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà
            if (alarm.repeat !== 'none') {
                scheduleNextRepeatingAlarm(alarm);
            }
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
            renderAlarms();
            updateCounts();
            updateBadges();
        }
        
        function scheduleNextRepeatingAlarm(alarm) {
            const alarmDate = new Date(alarm.datetime);
            
            switch (alarm.repeat) {
                case 'daily':
                    alarmDate.setDate(alarmDate.getDate() + 1);
                    break;
                case 'weekly':
                    alarmDate.setDate(alarmDate.getDate() + 7);
                    break;
                case 'monthly':
                    alarmDate.setMonth(alarmDate.getMonth() + 1);
                    break;
            }
            
            const newAlarm = {
                ...alarm,
                id: 'alarm_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                datetime: alarmDate.toISOString(),
                triggered: false,
                synced: false,
                created: new Date().toISOString()
            };
            
            alarms.push(newAlarm);
            localStorage.setItem('alarms', JSON.stringify(alarms));
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheets
            saveToGoogleSheets(newAlarm);
            
            renderAlarms();
            updateCounts();
        }
        
        // ================================
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ü‡∏≠‡∏£‡πå‡∏°
        // ================================
        function setRepeat(repeatValue) {
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            ['none', 'daily', 'weekly', 'monthly'].forEach(type => {
                const btn = document.getElementById(`repeat${type.charAt(0).toUpperCase() + type.slice(1)}`);
                btn.className = 'px-4 py-2 bg-gray-800 rounded-lg text-sm';
            });
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            const selectedBtn = document.getElementById(`repeat${repeatValue.charAt(0).toUpperCase() + repeatValue.slice(1)}`);
            selectedBtn.className = 'px-4 py-2 bg-blue-600 rounded-lg text-sm';
            
            // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            window.selectedRepeat = repeatValue;
        }
        
        // ================================
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Google Sheets
        // ================================
        async function testConnection() {
            try {
                const params = new URLSearchParams({
                    action: 'test',
                    user_id: userId
                });
                
                const response = await fetch(`${GOOGLE_SCRIPT_URL}?${params.toString()}`, {
                    method: 'GET',
                    mode: 'no-cors'
                });
                
                document.getElementById('statusDot').className = 'w-2 h-2 rounded-full bg-green-500 mr-2 pulse';
                document.getElementById('statusText').textContent = '‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå';
                document.getElementById('statusText').className = 'text-xs text-green-400';
                
                return true;
            } catch (error) {
                console.log('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ:', error);
                document.getElementById('statusDot').className = 'w-2 h-2 rounded-full bg-yellow-500 mr-2 pulse';
                document.getElementById('statusText').textContent = '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô';
                document.getElementById('statusText').className = 'text-xs text-yellow-400';
                return false;
            }
        }
        
        async function saveToGoogleSheets(alarmData) {
            try {
                console.log('üì§ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:', alarmData.title);
                
                const payload = {
                    action: 'add',
                    date: alarmData.date,
                    time: alarmData.time,
                    title: alarmData.title,
                    description: alarmData.description || '',
                    repeat: alarmData.repeat,
                    status: 'created',
                    user_id: userId,
                    user_name: userName,
                    alarm_id: alarmData.id
                };
                
                const params = new URLSearchParams();
                for (const key in payload) {
                    if (payload[key] !== undefined && payload[key] !== null) {
                        params.append(key, payload[key].toString());
                    }
                }
                
                // ‡πÉ‡∏ä‡πâ CORS proxy ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ CORS
                const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
                const url = `${GOOGLE_SCRIPT_URL}?${params.toString()}`;
                
                const response = await fetch(proxyUrl + url, {
                    method: 'GET',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.text();
                console.log('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', data);
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ô localStorage
                const alarmIndex = alarms.findIndex(a => a.id === alarmData.id);
                if (alarmIndex !== -1) {
                    alarms[alarmIndex].synced = true;
                    localStorage.setItem('alarms', JSON.stringify(alarms));
                    updateCounts();
                }
                
                return true;
            } catch (error) {
                console.error('‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', error);
                return false;
            }
        }
        
        async function deleteFromGoogleSheets(alarmId) {
            try {
                console.log('üóëÔ∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:', alarmId);
                
                const payload = {
                    action: 'delete',
                    alarm_id: alarmId,
                    user_id: userId
                };
                
                const params = new URLSearchParams();
                for (const key in payload) {
                    if (payload[key] !== undefined && payload[key] !== null) {
                        params.append(key, payload[key].toString());
                    }
                }
                
                // ‡πÉ‡∏ä‡πâ CORS proxy
                const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
                const url = `${GOOGLE_SCRIPT_URL}?${params.toString()}`;
                
                const response = await fetch(proxyUrl + url, {
                    method: 'GET',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.text();
                console.log('‚úÖ ‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', data);
                return true;
            } catch (error) {
                console.error('‚ùå ‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', error);
                return false;
            }
        }
        
        async function updateAlarmStatusInSheets(alarmId, status) {
            try {
                const payload = {
                    action: 'update',
                    alarm_id: alarmId,
                    status: status,
                    triggered_at: new Date().toISOString(),
                    user_id: userId
                };
                
                const params = new URLSearchParams();
                for (const key in payload) {
                    if (payload[key] !== undefined && payload[key] !== null) {
                        params.append(key, payload[key].toString());
                    }
                }
                
                // ‡πÉ‡∏ä‡πâ CORS proxy
                const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
                const url = `${GOOGLE_SCRIPT_URL}?${params.toString()}`;
                
                await fetch(proxyUrl + url, {
                    method: 'GET',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });
                
                return true;
            } catch (error) {
                console.error('‚ùå ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', error);
                return false;
            }
        }
        
        // ================================
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Push Notifications
        // ================================
        function sendPushNotification(title, message, type = 'info') {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
            if (!settings.pushEnabled) return;
            
            // 1. ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ (Push Notification UI)
            showInAppPushNotification(title, message, type);
            
            // 2. ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå)
            if ('Notification' in window && Notification.permission === 'granted') {
                try {
                    const notification = new Notification(`üîî ${title}`, {
                        body: message,
                        icon: '/icon-192.png',
                        badge: '/icon-192.png',
                        tag: 'notification-' + Date.now(),
                        requireInteraction: true
                    });
                    
                    notification.onclick = function() {
                        window.focus();
                        this.close();
                        openNotificationPanel();
                    };
                } catch (error) {
                    console.log('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á Notification ‡πÑ‡∏î‡πâ:', error);
                }
            }
            
            // 3. ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î)
            if (settings.soundEnabled) {
                playNotificationSound();
            }
            
            // 4. ‡∏™‡∏±‡πà‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î)
            if (settings.vibrationEnabled && navigator.vibrate) {
                navigator.vibrate([200, 100, 200]);
            }
        }
        
        function showInAppPushNotification(title, message, type) {
            const pushNotification = document.getElementById('pushNotification');
            document.getElementById('pushTitle').textContent = title;
            document.getElementById('pushMessage').textContent = message;
            document.getElementById('pushTime').textContent = '‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ';
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
            const iconDiv = pushNotification.querySelector('.w-10.h-10');
            if (iconDiv) {
                iconDiv.className = `w-10 h-10 rounded-full bg-gradient-to-br ${
                    type === 'alarm' ? 'from-blue-500 to-purple-600' : 
                    type === 'broadcast' ? 'from-purple-500 to-pink-600' : 
                    'from-green-500 to-blue-600'
                } flex items-center justify-center`;
            }
            
            // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• notification ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            window.currentNotification = { title, message, type };
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            pushNotification.classList.remove('hidden');
            setTimeout(() => {
                pushNotification.style.transform = 'translateY(0)';
            }, 100);
            
            // ‡∏õ‡∏¥‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            setTimeout(() => {
                if (pushNotification.style.transform === 'translateY(0)') {
                    closePushNotification();
                }
            }, 10000);
        }
        
        function closePushNotification() {
            const pushNotification = document.getElementById('pushNotification');
            pushNotification.style.transform = 'translateY(-100%)';
            setTimeout(() => {
                pushNotification.classList.add('hidden');
            }, 300);
        }
        
        function viewNotificationDetails() {
            closePushNotification();
            openNotificationPanel();
        }
        
        function playNotificationSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.1);
                gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                console.log("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏î‡πâ:", e);
            }
        }
        
        // ================================
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®
        // ================================
        async function sendBroadcast() {
            const title = document.getElementById('broadcastTitle').value.trim();
            const message = document.getElementById('broadcastMessage').value.trim();
            
            if (!title || !message) {
                Swal.fire({
                    icon: 'error',
                    title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®',
                    background: '#1f2937',
                    color: '#e5e7eb'
                });
                return;
            }
            
            const result = await Swal.fire({
                icon: 'question',
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®',
                html: `‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®<br><strong>"${title}"</strong><br>‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`,
                showCancelButton: true,
                confirmButtonText: '‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                background: '#1f2937',
                color: '#e5e7eb'
            });
            
            if (!result.isConfirmed) return;
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheets
            await saveBroadcastToGoogleSheets(title, message);
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            addNotification({
                type: 'broadcast',
                title: `üì¢ ${title}`,
                message: message,
                timestamp: new Date().toISOString(),
                read: false
            });
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á broadcastMessages
            broadcastMessages.unshift({
                id: 'broadcast_' + Date.now(),
                title,
                message,
                timestamp: new Date().toISOString(),
                sender: userId
            });
            localStorage.setItem('broadcastMessages', JSON.stringify(broadcastMessages));
            
            // ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            sendPushNotification(`üì¢ ${title}`, message, 'broadcast');
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
            clearBroadcastForm();
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
            updateCounts();
            updateBadges();
            
            Swal.fire({
                icon: 'success',
                title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                text: '‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                background: '#1f2937',
                color: '#e5e7eb'
            });
        }
        
        async function saveBroadcastToGoogleSheets(title, message) {
            try {
                const payload = {
                    action: 'add',
                    date: new Date().toLocaleDateString('th-TH'),
                    time: new Date().toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'}),
                    title: `üì¢ ${title}`,
                    description: message,
                    status: 'broadcast',
                    user_id: userId,
                    user_name: userName,
                    alarm_id: 'broadcast_' + Date.now()
                };
                
                const params = new URLSearchParams();
                for (const key in payload) {
                    if (payload[key] !== undefined && payload[key] !== null) {
                        params.append(key, payload[key].toString());
                    }
                }
                
                // ‡πÉ‡∏ä‡πâ CORS proxy
                const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
                const url = `${GOOGLE_SCRIPT_URL}?${params.toString()}`;
                
                await fetch(proxyUrl + url, {
                    method: 'GET',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });
                
                return true;
            } catch (error) {
                console.error('‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', error);
                return false;
            }
        }
        
        function clearBroadcastForm() {
            document.getElementById('broadcastTitle').value = '';
            document.getElementById('broadcastMessage').value = '';
        }
        
        // ================================
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Notifications
        // ================================
        function addNotification(notification) {
            notifications.unshift(notification);
            if (notifications.length > 100) {
                notifications = notifications.slice(0, 100);
            }
            localStorage.setItem('notifications', JSON.stringify(notifications));
            updateBadges();
        }
        
        function openNotificationPanel() {
            document.getElementById('notificationPanel').classList.add('active');
            renderNotificationList();
        }
        
        function closeNotificationPanel() {
            document.getElementById('notificationPanel').classList.remove('active');
        }
        
        function renderNotificationList() {
            const container = document.getElementById('notificationList');
            
            if (notifications.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-10">
                        <i class="fas fa-bell-slash text-4xl text-gray-500 mb-3"></i>
                        <p class="text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            notifications.forEach(notification => {
                const time = new Date(notification.timestamp);
                const notificationElement = document.createElement('div');
                notificationElement.className = 'ios-notification mb-3';
                notificationElement.innerHTML = `
                    <div class="flex items-start">
                        <div class="flex-shrink-0 mr-3">
                            <div class="w-8 h-8 rounded-full ${notification.type === 'alarm' ? 'bg-blue-600' : 'bg-purple-600'} flex items-center justify-center">
                                <i class="fas fa-${notification.type === 'alarm' ? 'clock' : 'broadcast-tower'} text-white text-sm"></i>
                            </div>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-bold">${notification.title}</h3>
                            <p class="text-sm text-gray-400 mt-1">${notification.message}</p>
                            <p class="text-xs text-gray-500 mt-2">
                                ${time.toLocaleDateString('th-TH')} ${time.toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'})}
                            </p>
                        </div>
                    </div>
                `;
                container.appendChild(notificationElement);
            });
        }
        
        function clearAllNotifications() {
            notifications = [];
            localStorage.setItem('notifications', JSON.stringify(notifications));
            updateBadges();
            renderNotificationList();
            
            Swal.fire({
                icon: 'success',
                title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                text: '‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                background: '#1f2937',
                color: '#e5e7eb'
            });
        }
        
        // ================================
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
        // ================================
        function simulateLoading() {
            let progress = 0;
            const loadingInterval = setInterval(() => {
                progress += 10;
                document.getElementById('loadingBar').style.width = progress + '%';
                
                if (progress >= 100) {
                    clearInterval(loadingInterval);
                    setTimeout(() => {
                        document.getElementById('appLaunch').style.opacity = '0';
                        setTimeout(() => {
                            document.getElementById('appLaunch').style.display = 'none';
                        }, 500);
                    }, 300);
                }
            }, 200);
        }
        
        function getRepeatText(repeatValue) {
            const repeatMap = {
                'none': '‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏ã‡πâ‡∏≥',
                'daily': '‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô',
                'weekly': '‡∏ó‡∏∏‡∏Å‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå',
                'monthly': '‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'
            };
            return repeatMap[repeatValue] || repeatValue;
        }
        
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function scrollToForm() {
            document.getElementById('addAlarmSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        function scrollToAlarms() {
            document.getElementById('allAlarmsSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        function scrollToBroadcast() {
            document.getElementById('broadcastSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        function scrollToSettings() {
            document.getElementById('settingsSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        function refreshData() {
            loadAlarms();
            loadNotifications();
            loadBroadcastMessages();
            
            const refreshBtn = document.querySelector('[onclick="refreshData()"]');
            refreshBtn.classList.add('animate-spin');
            setTimeout(() => {
                refreshBtn.classList.remove('animate-spin');
            }, 1000);
            
            Swal.fire({
                icon: 'success',
                title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                text: '‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 2000,
                background: '#1f2937',
                color: '#e5e7eb'
            });
        }
        
        function refreshAlarms() {
            loadAlarms();
            Swal.fire({
                icon: 'success',
                title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                text: '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 2000,
                background: '#1f2937',
                color: '#e5e7eb'
            });
        }
        
        // ================================
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
        // ================================
        function requestNotificationPermission() {
            if (!('Notification' in window)) {
                Swal.fire({
                    icon: 'info',
                    title: '‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö',
                    text: '‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô',
                    background: '#1f2937',
                    color: '#e5e7eb'
                });
                return;
            }
            
            if (Notification.permission === 'granted') {
                Swal.fire({
                    icon: 'success',
                    title: '‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÅ‡∏•‡πâ‡∏ß',
                    text: '‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß',
                    background: '#1f2937',
                    color: '#e5e7eb'
                });
                return;
            }
            
            if (Notification.permission === 'denied') {
                Swal.fire({
                    icon: 'warning',
                    title: '‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò',
                    text: '‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå',
                    background: '#1f2937',
                    color: '#e5e7eb'
                });
                return;
            }
            
            Notification.requestPermission().then(permission => {
                settings.notificationPermission = permission;
                localStorage.setItem('notificationSettings', JSON.stringify(settings));
                
                if (permission === 'granted') {
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                        text: '‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß',
                        background: '#1f2937',
                        color: '#e5e7eb'
                    });
                    setTimeout(() => testNotification(), 1000);
                } else {
                    Swal.fire({
                        icon: 'warning',
                        title: '‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò',
                        text: '‡∏Ñ‡∏∏‡∏ì‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô',
                        background: '#1f2937',
                        color: '#e5e7eb'
                    });
                }
            });
        }
        
        function testNotification() {
            sendPushNotification(
                '‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', 
                '‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö Mobile App', 
                'test'
            );
            
            addNotification({
                type: 'test',
                title: '‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô',
                message: '‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô',
                timestamp: new Date().toISOString(),
                read: false
            });
            
            Swal.fire({
                icon: 'success',
                title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                text: '‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 2000,
                background: '#1f2937',
                color: '#e5e7eb'
            });
        }
        
        function testAlarmNow(alarmId) {
            const alarm = alarms.find(a => a.id === alarmId);
            if (!alarm) return;
            
            sendPushNotification(
                `‡∏ó‡∏î‡∏™‡∏≠‡∏ö: ${alarm.title}`,
                alarm.description || '‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô',
                'test'
            );
            
            addNotification({
                type: 'test',
                title: `‡∏ó‡∏î‡∏™‡∏≠‡∏ö: ${alarm.title}`,
                message: alarm.description || '‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô',
                timestamp: new Date().toISOString(),
                read: false
            });
            
            Swal.fire({
                icon: 'success',
                title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                text: '‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 2000,
                background: '#1f2937',
                color: '#e5e7eb'
            });
        }
        
        function showInstallPrompt() {
            if (!window.deferredPrompt) {
                Swal.fire({
                    icon: 'info',
                    title: '‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ',
                    html: '‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢:<br>1. ‡πÅ‡∏ï‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏°‡∏ô‡∏π "..."<br>2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ"<br>3. ‡∏Å‡∏î "‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á"',
                    background: '#1f2937',
                    color: '#e5e7eb'
                });
                return;
            }
            
            window.deferredPrompt.prompt();
            window.deferredPrompt.userChoice.then(choiceResult => {
                if (choiceResult.outcome === 'accepted') {
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                        text: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ...',
                        background: '#1f2937',
                        color: '#e5e7eb'
                    });
                }
                window.deferredPrompt = null;
            });
        }
        
        // ================================
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        // ================================
        async function deleteAlarmPrompt(alarmId) {
            const alarm = alarms.find(a => a.id === alarmId);
            if (!alarm) return;
            
            const result = await Swal.fire({
                icon: 'warning',
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö',
                html: `‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô<br><strong>"${alarm.title}"</strong><br>‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?<br><small class="text-gray-400">(‡∏à‡∏∞‡∏•‡∏ö‡∏à‡∏≤‡∏Å Google Sheets ‡∏î‡πâ‡∏ß‡∏¢)</small>`,
                showCancelButton: true,
                confirmButtonText: '‡∏•‡∏ö',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                background: '#1f2937',
                color: '#e5e7eb'
            });
            
            if (!result.isConfirmed) return;
            
            // ‡∏•‡∏ö‡∏à‡∏≤‡∏Å Google Sheets ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
            if (alarm.synced) {
                const deleted = await deleteFromGoogleSheets(alarm.id);
                if (!deleted) {
                    Swal.fire({
                        icon: 'warning',
                        title: '‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô',
                        text: '‡∏•‡∏ö‡∏à‡∏≤‡∏Å Google Sheets ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÅ‡∏ï‡πà‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß',
                        background: '#1f2937',
                        color: '#e5e7eb'
                    });
                }
            }
            
            // ‡∏•‡∏ö‡∏à‡∏≤‡∏Å localStorage
            alarms = alarms.filter(a => a.id !== alarmId);
            localStorage.setItem('alarms', JSON.stringify(alarms));
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
            renderAlarms();
            updateCounts();
            
            Swal.fire({
                icon: 'success',
                title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                text: '‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                background: '#1f2937',
                color: '#e5e7eb'
            });
        }
        
        async function showClearAllDialog() {
            const result = await Swal.fire({
                icon: 'warning',
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
                html: `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?<br>
                      <small class="text-gray-400">
                      ‚Ä¢ ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${alarms.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£<br>
                      ‚Ä¢ ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö: ${notifications.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£<br>
                      ‚Ä¢ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${broadcastMessages.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£<br>
                      </small>`,
                showCancelButton: true,
                confirmButtonText: '‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                background: '#1f2937',
                color: '#e5e7eb'
            });
            
            if (!result.isConfirmed) return;
            
            // ‡∏•‡∏ö‡∏à‡∏≤‡∏Å Google Sheets (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ)
            let deleteCount = 0;
            for (const alarm of alarms.filter(a => a.synced)) {
                const deleted = await deleteFromGoogleSheets(alarm.id);
                if (deleted) deleteCount++;
            }
            
            // ‡∏•‡∏ö‡∏à‡∏≤‡∏Å localStorage
            alarms = [];
            notifications = [];
            broadcastMessages = [];
            localStorage.setItem('alarms', JSON.stringify(alarms));
            localStorage.setItem('notifications', JSON.stringify(notifications));
            localStorage.setItem('broadcastMessages', JSON.stringify(broadcastMessages));
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
            renderAlarms();
            updateBadges();
            updateCounts();
            
            Swal.fire({
                icon: 'success',
                title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                html: `‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß<br>
                      <small class="text-gray-400">
                      ‡∏•‡∏ö ${deleteCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≤‡∏Å Google Sheets
                      </small>`,
                background: '#1f2937',
                color: '#e5e7eb'
            });
        }
        
        // ================================
        // Event Listeners
        // ================================
        document.getElementById('alarmForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const title = document.getElementById('title').value.trim();
            const description = document.getElementById('description').value.trim();
            const date = document.getElementById('date').value;
            const time = document.getElementById('time').value;
            const repeat = window.selectedRepeat || 'none';
            
            if (!title || !date || !time) {
                Swal.fire({
                    icon: 'error',
                    title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠, ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤',
                    background: '#1f2937',
                    color: '#e5e7eb'
                });
                return;
            }
            
            const datetime = new Date(`${date}T${time}:00`);
            
            if (datetime <= new Date()) {
                Swal.fire({
                    icon: 'warning',
                    title: '‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï',
                    background: '#1f2937',
                    color: '#e5e7eb'
                });
                return;
            }
            
            const alarm = {
                id: 'alarm_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                title,
                description,
                date,
                time,
                datetime: datetime.toISOString(),
                repeat,
                triggered: false,
                synced: false,
                created: new Date().toISOString()
            };
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            alarms.push(alarm);
            localStorage.setItem('alarms', JSON.stringify(alarms));
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheets
            const saved = await saveToGoogleSheets(alarm);
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.getElementById('alarmForm').reset();
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
            const nextHour = new Date();
            nextHour.setHours(nextHour.getHours() + 1);
            document.getElementById('time').value = `${nextHour.getHours().toString().padStart(2, '0')}:00`;
            setRepeat('none');
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
            renderAlarms();
            updateCounts();
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
            Swal.fire({
                icon: 'success',
                title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                text: `‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô "${title}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!${saved ? ' (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô Google Sheets)' : ' (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö)'}`,
                background: '#1f2937',
                color: '#e5e7eb'
            });
            
            // ‡∏™‡∏±‡πà‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î)
            if (settings.vibrationEnabled && navigator.vibrate) {
                navigator.vibrate([100, 50, 100]);
            }
        });
        
        // Event listeners ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
        document.getElementById('pushToggle').addEventListener('change', saveSettings);
        document.getElementById('vibrationToggle').addEventListener('change', saveSettings);
        document.getElementById('soundToggle').addEventListener('change', saveSettings);
        
        // ================================
        // PWA Installation
        // ================================
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            window.deferredPrompt = e;
        });
        
        // ================================
        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏≠‡∏õ
        // ================================
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
