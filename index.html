<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #2196F3;
            --primary-dark: #1976D2;
            --success: #4CAF50;
            --warning: #FF9800;
            --danger: #f44336;
            --dark: #333;
            --light: #f5f5f5;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Prompt', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .app-container {
            width: 100%;
            max-width: 500px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .header h1 i {
            font-size: 2rem;
        }
        
        .header p {
            opacity: 0.9;
        }
        
        /* Content */
        .content {
            padding: 30px;
        }
        
        /* Status Panel */
        .status-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid #e9ecef;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .status-item:last-child {
            border-bottom: none;
        }
        
        .status-label {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .status-dot.active {
            background: var(--success);
            animation: pulse 2s infinite;
        }
        
        .status-dot.inactive {
            background: var(--danger);
        }
        
        .status-dot.waiting {
            background: var(--warning);
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Notification Form */
        .notification-form {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid #e9ecef;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .form-control {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }
        
        /* Buttons */
        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 1rem;
            width: 100%;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success), #45a049);
            color: white;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #e68900);
            color: white;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.3);
        }
        
        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        /* Notification History */
        .history-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #e9ecef;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .history-item {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid var(--primary);
        }
        
        .history-item.success {
            border-left-color: var(--success);
        }
        
        .history-item.warning {
            border-left-color: var(--warning);
        }
        
        .history-item.error {
            border-left-color: var(--danger);
        }
        
        .history-time {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }
        
        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .toast {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 15px;
            animation: slideIn 0.3s;
            border-left: 5px solid var(--success);
            min-width: 300px;
        }
        
        .toast.error {
            border-left-color: var(--danger);
        }
        
        .toast.warning {
            border-left-color: var(--warning);
        }
        
        .toast.info {
            border-left-color: var(--primary);
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            border-top: 1px solid #e9ecef;
            background: #f8f9fa;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .app-container {
                border-radius: 15px;
            }
            
            .header {
                padding: 25px 20px;
            }
            
            .content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <h1>
                <i class="fas fa-bell"></i>
                ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            </h1>
            <p>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</p>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- Status Panel -->
            <div class="status-panel">
                <div class="status-item">
                    <div class="status-label">
                        <div class="status-dot" id="notificationStatus"></div>
                        <span>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</span>
                    </div>
                    <span id="notificationStatusText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</span>
                </div>
                
                <div class="status-item">
                    <div class="status-label">
                        <div class="status-dot" id="systemStatus"></div>
                        <span>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏ö‡∏ö</span>
                    </div>
                    <span id="systemStatusText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</span>
                </div>
            </div>

            <!-- Notification Form -->
            <div class="notification-form">
                <h2 style="margin-bottom: 20px; color: var(--dark);">
                    <i class="fas fa-paper-plane"></i> ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                </h2>
                
                <div class="form-group">
                    <label class="form-label">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠:</label>
                    <input type="text" id="notificationTitle" class="form-control" 
                           placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç" 
                           value="‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö">
                </div>
                
                <div class="form-group">
                    <label class="form-label">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°:</label>
                    <textarea id="notificationMessage" class="form-control" rows="3" 
                              placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô...">‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">‡πÄ‡∏ß‡∏•‡∏≤‡∏•‡πà‡∏≤‡∏ä‡πâ‡∏≤ (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ):</label>
                    <input type="number" id="delayTime" class="form-control" value="10" min="1" max="300">
                    <div style="margin-top: 8px; font-size: 0.9rem; color: #666;">
                        <i class="fas fa-info-circle"></i> ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏£‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" id="testNowBtn">
                        <i class="fas fa-bell"></i> ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                    </button>
                    <button class="btn btn-success" id="scheduleBtn">
                        <i class="fas fa-clock"></i> ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                    </button>
                    <button class="btn btn-warning" id="requestPermissionBtn">
                        <i class="fas fa-hand-paper"></i> ‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï
                    </button>
                </div>
            </div>

            <!-- Notification History -->
            <div class="history-panel">
                <h2 style="margin-bottom: 15px; color: var(--dark);">
                    <i class="fas fa-history"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                </h2>
                
                <div id="notificationHistory">
                    <div class="history-item">
                        <strong>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</strong>
                        <p>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</p>
                        <div class="history-time" id="currentTime"></div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="footer">
                <p>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</p>
                <p style="margin-top: 5px; font-size: 0.9rem; color: #888;">
                    <i class="fas fa-code"></i> ‡πÉ‡∏ä‡πâ HTML5 + JavaScript
                </p>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Audio for Notification Sound -->
    <audio id="notificationSound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3" type="audio/mpeg">
    </audio>

    <!-- Main JavaScript -->
    <script>
        // Global variables
        let notifications = [];
        let isSystemReady = false;
        
        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', initializeApp);
        
        async function initializeApp() {
            console.log('üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô...');
            
            // Update current time
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            
            // Setup event listeners
            setupEventListeners();
            
            // Check notification permission
            checkNotificationPermission();
            
            // Load notification history
            loadNotificationHistory();
            
            // Update system status
            updateSystemStatus(true);
            
            // Add initial log
            addToHistory('‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', 'success');
            
            console.log('‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
            showToast('‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô!', 'success', '‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ');
            
            // Play welcome sound
            setTimeout(() => playSound(), 500);
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Buttons
            document.getElementById('testNowBtn').addEventListener('click', sendTestNotification);
            document.getElementById('scheduleBtn').addEventListener('click', scheduleNotification);
            document.getElementById('requestPermissionBtn').addEventListener('click', requestNotificationPermission);
        }
        
        // Update current time
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('th-TH', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            document.getElementById('currentTime').textContent = `‡πÄ‡∏ß‡∏•‡∏≤: ${timeString}`;
        }
        
        // Check notification permission
        function checkNotificationPermission() {
            const statusDot = document.getElementById('notificationStatus');
            const statusText = document.getElementById('notificationStatusText');
            
            if (!('Notification' in window)) {
                statusDot.className = 'status-dot inactive';
                statusText.textContent = '‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö';
                return false;
            }
            
            const permission = Notification.permission;
            
            switch(permission) {
                case 'granted':
                    statusDot.className = 'status-dot active';
                    statusText.textContent = '‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÅ‡∏•‡πâ‡∏ß';
                    return true;
                case 'denied':
                    statusDot.className = 'status-dot inactive';
                    statusText.textContent = '‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÅ‡∏•‡πâ‡∏ß';
                    return false;
                default:
                    statusDot.className = 'status-dot waiting';
                    statusText.textContent = '‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï';
                    return false;
            }
        }
        
        // Request notification permission
        async function requestNotificationPermission() {
            if (!('Notification' in window)) {
                showToast('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', 'error');
                return false;
            }
            
            try {
                const permission = await Notification.requestPermission();
                
                // Update UI
                checkNotificationPermission();
                
                if (permission === 'granted') {
                    showToast('‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß!', 'success');
                    addToHistory('‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', 'success');
                    playSound();
                    return true;
                } else {
                    showToast('‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò', 'warning');
                    addToHistory('‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', 'error');
                    return false;
                }
            } catch (error) {
                console.error('‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:', error);
                showToast('‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', 'error');
                return false;
            }
        }
        
        // Send test notification
        async function sendTestNotification() {
            const title = document.getElementById('notificationTitle').value.trim() || '‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô';
            const message = document.getElementById('notificationMessage').value.trim() || '‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö';
            
            // Check permission first
            if (Notification.permission !== 'granted') {
                const granted = await requestNotificationPermission();
                if (!granted) return;
            }
            
            // Send notification
            const notification = new Notification(title, {
                body: message,
                icon: 'https://cdn-icons-png.flaticon.com/512/733/733585.png',
                requireInteraction: true
            });
            
            // Play sound
            playSound();
            
            // Show toast
            showToast('‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß!', 'success');
            
            // Add to history
            addToHistory(`‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ${title}`, 'success');
            
            // Log
            console.log('‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:', title);
        }
        
        // Schedule notification
        async function scheduleNotification() {
            const title = document.getElementById('notificationTitle').value.trim() || '‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤';
            const message = document.getElementById('notificationMessage').value.trim() || '‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ';
            const delaySeconds = parseInt(document.getElementById('delayTime').value) || 10;
            
            // Validation
            if (delaySeconds < 1 || delaySeconds > 300) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 1-300 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ', 'warning');
                return;
            }
            
            // Check permission
            if (Notification.permission !== 'granted') {
                const granted = await requestNotificationPermission();
                if (!granted) return;
            }
            
            // Show confirmation
            showToast(
                '‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 
                'success',
                `‡∏à‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡∏≠‡∏µ‡∏Å ${delaySeconds} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`
            );
            
            addToHistory(`‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡∏≠‡∏µ‡∏Å ${delaySeconds} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`, 'success');
            
            // Start countdown
            startCountdown(delaySeconds, title, message);
        }
        
        // Start countdown for scheduled notification
        function startCountdown(seconds, title, message) {
            console.log(`‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á: ${seconds} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`);
            
            let remaining = seconds;
            
            // Show initial countdown
            const countdownElement = document.createElement('div');
            countdownElement.className = 'history-item warning';
            countdownElement.innerHTML = `
                <strong>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á: ${title}</strong>
                <p>${message}</p>
                <div class="history-time">‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤: ${remaining} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</div>
            `;
            
            const historyContainer = document.getElementById('notificationHistory');
            historyContainer.insertBefore(countdownElement, historyContainer.firstChild);
            
            // Update countdown every second
            const countdownInterval = setInterval(() => {
                remaining--;
                
                if (remaining <= 0) {
                    clearInterval(countdownInterval);
                    
                    // Send notification
                    sendScheduledNotification(title, message);
                    
                    // Update countdown element
                    countdownElement.className = 'history-item success';
                    countdownElement.innerHTML = `
                        <strong>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤: ${title}</strong>
                        <p>${message}</p>
                        <div class="history-time">‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${new Date().toLocaleTimeString('th-TH')}</div>
                    `;
                } else {
                    // Update countdown display
                    countdownElement.querySelector('.history-time').textContent = 
                        `‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤: ${remaining} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`;
                }
            }, 1000);
        }
        
        // Send scheduled notification
        function sendScheduledNotification(title, message) {
            // Send notification
            const notification = new Notification(title, {
                body: '[‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤] ' + message,
                icon: 'https://cdn-icons-png.flaticon.com/512/733/733585.png',
                requireInteraction: true
            });
            
            // Play sound
            playSound();
            
            // Show toast
            showToast('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤!', 'success', title);
            
            // Add to history
            addToHistory(`‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤: ${title}`, 'success');
            
            console.log('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤:', title);
        }
        
        // Update system status
        function updateSystemStatus(isReady) {
            const statusDot = document.getElementById('systemStatus');
            const statusText = document.getElementById('systemStatusText');
            
            isSystemReady = isReady;
            
            if (isReady) {
                statusDot.className = 'status-dot active';
                statusText.textContent = '‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
            } else {
                statusDot.className = 'status-dot inactive';
                statusText.textContent = '‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
            }
        }
        
        // Add to history
        function addToHistory(message, type = 'info') {
            const now = new Date();
            const timeString = now.toLocaleTimeString('th-TH', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            const historyItem = document.createElement('div');
            historyItem.className = `history-item ${type}`;
            historyItem.innerHTML = `
                <strong>${message}</strong>
                <div class="history-time">‡πÄ‡∏ß‡∏•‡∏≤: ${timeString}</div>
            `;
            
            const historyContainer = document.getElementById('notificationHistory');
            historyContainer.insertBefore(historyItem, historyContainer.firstChild);
            
            // Keep only last 20 items
            const maxItems = 20;
            while (historyContainer.children.length > maxItems) {
                historyContainer.removeChild(historyContainer.lastChild);
            }
            
            // Save to localStorage
            saveToHistoryStorage(message, type, timeString);
        }
        
        // Save to history storage
        function saveToHistoryStorage(message, type, timeString) {
            try {
                const history = JSON.parse(localStorage.getItem('notificationHistory') || '[]');
                history.unshift({
                    message,
                    type,
                    timeString,
                    timestamp: Date.now()
                });
                
                // Keep only last 50 items
                if (history.length > 50) {
                    history.pop();
                }
                
                localStorage.setItem('notificationHistory', JSON.stringify(history));
            } catch (error) {
                console.error('Save history error:', error);
            }
        }
        
        // Load notification history
        function loadNotificationHistory() {
            try {
                const history = JSON.parse(localStorage.getItem('notificationHistory') || '[]');
                
                history.forEach(item => {
                    const historyItem = document.createElement('div');
                    historyItem.className = `history-item ${item.type}`;
                    historyItem.innerHTML = `
                        <strong>${item.message}</strong>
                        <div class="history-time">‡πÄ‡∏ß‡∏•‡∏≤: ${item.timeString}</div>
                    `;
                    
                    const historyContainer = document.getElementById('notificationHistory');
                    // Don't add the initial item again
                    if (item.message !== '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö') {
                        historyContainer.appendChild(historyItem);
                    }
                });
            } catch (error) {
                console.error('Load history error:', error);
            }
        }
        
        // Play sound
        function playSound() {
            try {
                const audio = document.getElementById('notificationSound');
                audio.currentTime = 0;
                audio.play().catch(e => console.log('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á:', e));
            } catch (error) {
                console.log('‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:', error);
                
                // Fallback sound using Web Audio API
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = 800;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                } catch (e) {
                    console.log('Web Audio API also failed:', e);
                }
            }
        }
        
        // Show toast notification
        function showToast(title, type = 'info', message = '') {
            const container = document.getElementById('toastContainer');
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-times-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            
            toast.innerHTML = `
                <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--${type}); 
                           display: flex; align-items: center; justify-content: center; color: white; font-size: 18px;">
                    <i class="fas ${icons[type] || 'fa-info-circle'}"></i>
                </div>
                <div style="flex: 1;">
                    <strong style="display: block; margin-bottom: 5px;">${title}</strong>
                    ${message ? `<div style="font-size: 0.9rem; color: #666;">${message}</div>` : ''}
                </div>
                <button class="toast-close" style="background: none; border: none; font-size: 1.5rem; 
                        cursor: pointer; color: #999; padding: 5px; width: 30px; height: 30px; 
                        display: flex; align-items: center; justify-content: center; border-radius: 50%;">
                    &times;
                </button>
            `;
            
            container.appendChild(toast);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.style.opacity = '0';
                    setTimeout(() => {
                        if (toast.parentNode) toast.parentNode.removeChild(toast);
                    }, 300);
                }
            }, 5000);
            
            // Close button
            toast.querySelector('.toast-close').addEventListener('click', () => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    if (toast.parentNode) toast.parentNode.removeChild(toast);
                }, 300);
            });
        }
        
        // Listen for page visibility changes
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible') {
                // Page became visible, update time
                updateCurrentTime();
                
                // Check for any pending notifications
                console.log('‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏ñ‡∏π‡∏Å‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà');
                addToHistory('‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà', 'info');
            } else {
                console.log('‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô/‡∏õ‡∏¥‡∏î');
            }
        });
        
        // Check for scheduled notifications every minute
        setInterval(() => {
            // This ensures notifications work when page is open
            console.log('‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞...');
        }, 60000);
    </script>
</body>
</html>
