<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏£‡∏ß‡∏°‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</title>
    <meta name="theme-color" content="#1a1a2e">
    <meta name="description" content="‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏£‡∏ß‡∏°‡∏®‡∏π‡∏ô‡∏¢‡πå‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≤‡∏°‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°">
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    
    <!-- CSS & Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #1a1a2e;
            color: #e5e7eb;
            font-family: 'Sarabun', sans-serif;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Prompt', sans-serif;
        }
        
        /* Loading screen */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.5s;
        }
        
        .app-icon {
            width: 100px;
            height: 100px;
            border-radius: 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 40px;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); }
            50% { transform: scale(1.05); box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4); }
            100% { transform: scale(1); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); }
        }
        
        .app-icon-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #FF3B30;
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            border: 3px solid #1a1a2e;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.5);
        }
        
        /* Notification badges */
        .notification-badge {
            background-color: #FF3B30;
            color: white;
            border-radius: 10px;
            padding: 3px 8px;
            font-size: 12px;
            font-weight: bold;
            position: absolute;
            top: -8px;
            right: -8px;
            min-width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #1a1a2e;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* Animations */
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideInBottom {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .slide-in {
            animation: slideInRight 0.3s ease-out;
        }
        
        .slide-up {
            animation: slideInBottom 0.3s ease-out;
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        .shake {
            animation: shake 0.5s ease-in-out;
        }
        
        /* Notification panel */
        .notification-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .notification-panel.active {
            transform: translateY(0);
        }
        
        /* Status indicators */
        .online { color: #10b981; }
        .offline { color: #ef4444; }
        .warning { color: #f59e0b; }
        .connecting { color: #3b82f6; }
        
        /* Install prompt */
        #installPrompt {
            position: fixed;
            bottom: 100px;
            left: 20px;
            right: 20px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.95) 0%, rgba(118, 75, 162, 0.95) 100%);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.4);
            z-index: 10000;
            display: none;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Desktop notification */
        .desktop-notification {
            position: fixed;
            top: 30px;
            right: 30px;
            width: 380px;
            background: rgba(31, 41, 55, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 10000;
            overflow: hidden;
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .desktop-notification.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .desktop-notification.alarm {
            border-left: 5px solid #ef4444;
            animation: alarmPulse 1s infinite;
        }
        
        .desktop-notification.broadcast {
            border-left: 5px solid #8b5cf6;
        }
        
        .desktop-notification.test {
            border-left: 5px solid #3b82f6;
        }
        
        @keyframes alarmPulse {
            0%, 100% { border-left-color: #ef4444; box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            50% { border-left-color: #f87171; box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
        }
        
        /* Connection status bar */
        .connection-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #10b981, #3b82f6, #8b5cf6);
            z-index: 9999;
            transform: translateY(-100%);
            transition: transform 0.3s ease-out;
        }
        
        .connection-bar.show {
            transform: translateY(0);
        }
        
        /* Device list */
        .device-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .device-item {
            transition: all 0.2s;
            border-left: 4px solid transparent;
        }
        
        .device-item.online {
            border-left-color: #10b981;
        }
        
        .device-item.away {
            border-left-color: #f59e0b;
        }
        
        .device-item.offline {
            border-left-color: #ef4444;
        }
        
        /* Alarm item */
        .alarm-item {
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .alarm-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .desktop-notification {
                width: calc(100% - 40px);
                right: 20px;
                left: 20px;
            }
            
            .app-icon {
                width: 80px;
                height: 80px;
                font-size: 32px;
            }
        }
        
        /* Print styles */
        @media print {
            .no-print {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- Connection Status Bar -->
    <div id="connectionBar" class="connection-bar"></div>
    
    <!-- Loading Screen -->
    <div id="loadingScreen">
        <div class="app-icon">
            <i class="fas fa-bell"></i>
            <div id="appIconBadge" class="app-icon-badge" style="display: none;">0</div>
        </div>
        <h1 class="text-2xl font-bold mb-2">‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏£‡∏ß‡∏°‡∏®‡∏π‡∏ô‡∏¢‡πå</h1>
        <p class="text-gray-400 mb-6" id="loadingText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö...</p>
        <div class="w-64 h-3 bg-gray-800 rounded-full overflow-hidden">
            <div id="loadingProgress" class="h-full bg-gradient-to-r from-blue-500 via-purple-600 to-pink-600 transition-all duration-300" style="width: 0%"></div>
        </div>
        <div class="mt-6 text-center">
            <div class="flex items-center justify-center space-x-4 text-sm text-gray-500">
                <div class="flex items-center">
                    <div class="w-2 h-2 rounded-full bg-green-500 mr-2"></div>
                    <span id="loadingStatus">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</span>
                </div>
                <div class="flex items-center">
                    <i class="fas fa-users mr-2"></i>
                    <span id="loadingDevices">0 ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Install Prompt -->
    <div id="installPrompt">
        <div class="flex items-center mb-4">
            <div class="w-16 h-16 rounded-xl bg-white/20 flex items-center justify-center mr-4 backdrop-blur-sm">
                <i class="fas fa-bell text-white text-2xl"></i>
            </div>
            <div class="flex-1">
                <h3 class="font-bold text-white text-lg">‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ‡∏Ø ‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠</h3>
                <p class="text-white/90 text-sm">‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏¢‡∏¥‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πâ‡∏õ‡∏¥‡∏î‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå</p>
            </div>
        </div>
        <div class="flex space-x-3">
            <button onclick="installApp()" class="flex-1 py-3 bg-white text-purple-700 font-bold rounded-xl hover:bg-gray-100 transition-colors shadow-lg">
                <i class="fas fa-download mr-2"></i>‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á
            </button>
            <button onclick="dismissInstallPrompt()" class="flex-1 py-3 bg-white/20 text-white font-bold rounded-xl hover:bg-white/30 transition-colors">
                <i class="fas fa-times mr-2"></i>‡∏õ‡∏¥‡∏î
            </button>
        </div>
    </div>
    
    <!-- Desktop Notification -->
    <div id="desktopNotification" class="desktop-notification">
        <div class="p-5">
            <div class="flex justify-between items-start mb-4">
                <div class="flex items-start flex-1">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center mr-4 shadow-lg">
                        <i id="desktopNotificationIcon" class="fas fa-bell text-white text-xl"></i>
                    </div>
                    <div class="flex-1">
                        <h3 id="desktopNotificationTitle" class="font-bold text-white text-lg mb-1"></h3>
                        <p id="desktopNotificationMessage" class="text-gray-300 text-sm"></p>
                        <p id="desktopNotificationTime" class="text-xs text-gray-500 mt-2">
                            <i class="far fa-clock mr-1"></i><span></span>
                        </p>
                    </div>
                </div>
                <button onclick="closeDesktopNotification()" class="text-gray-400 hover:text-white ml-4 transition-colors">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>
            <div class="flex space-x-3">
                <button onclick="openNotificationPanel(); closeDesktopNotification();" class="flex-1 py-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 rounded-xl text-sm text-white font-medium transition-all shadow-lg hover:shadow-xl">
                    <i class="fas fa-external-link-alt mr-2"></i>‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π
                </button>
                <button onclick="closeDesktopNotification()" class="flex-1 py-3 bg-gray-800 hover:bg-gray-700 rounded-xl text-sm text-white font-medium transition-colors">
                    <i class="fas fa-times mr-2"></i>‡∏õ‡∏¥‡∏î
                </button>
            </div>
        </div>
    </div>
    
    <!-- Main App -->
    <div id="mainApp" class="min-h-screen pb-32 hidden">
        <!-- Header -->
        <header class="sticky top-0 z-50 bg-gray-900/95 backdrop-blur-xl border-b border-gray-800 shadow-xl">
            <div class="container mx-auto px-4 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center">
                        <div class="relative">
                            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center mr-4 shadow-lg">
                                <i class="fas fa-bell text-white"></i>
                                <div id="headerIconBadge" class="notification-badge" style="display: none;">0</div>
                            </div>
                            <div id="connectionIndicator" class="absolute -bottom-1 -right-1 w-4 h-4 rounded-full bg-green-500 border-2 border-gray-900"></div>
                        </div>
                        <div>
                            <h1 class="font-bold text-xl">‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</h1>
                            <div class="flex items-center">
                                <div id="statusDot" class="w-3 h-3 rounded-full bg-green-500 mr-2 animate-pulse"></div>
                                <span id="statusText" class="text-sm online">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå...</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button onclick="showActiveDevices()" class="relative group">
                            <div class="w-10 h-10 bg-gray-800 hover:bg-gray-700 rounded-full flex items-center justify-center transition-colors shadow-lg">
                                <i class="fas fa-desktop text-lg"></i>
                            </div>
                            <div class="absolute -top-2 -right-2 w-5 h-5 rounded-full bg-blue-600 text-xs flex items-center justify-center" id="deviceCount">0</div>
                            <div class="absolute top-full right-0 mt-2 w-64 bg-gray-900 rounded-xl shadow-2xl p-4 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 border border-gray-800">
                                <h4 class="font-bold text-white mb-3">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</h4>
                                <div id="deviceList" class="space-y-2 max-h-60 overflow-y-auto">
                                    <p class="text-gray-400 text-sm text-center py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
                                </div>
                            </div>
                        </button>
                        <button onclick="openNotificationPanel()" class="relative">
                            <div class="w-10 h-10 bg-gray-800 hover:bg-gray-700 rounded-full flex items-center justify-center transition-colors shadow-lg">
                                <i class="fas fa-bell text-lg"></i>
                                <div id="headerBadge" class="notification-badge" style="display: none;">0</div>
                            </div>
                        </button>
                        <button onclick="refreshAllData()" id="refreshBtn" class="w-10 h-10 bg-gray-800 hover:bg-gray-700 rounded-full flex items-center justify-center transition-colors shadow-lg">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                        <button onclick="showSettings()" class="w-10 h-10 bg-gray-800 hover:bg-gray-700 rounded-full flex items-center justify-center transition-colors shadow-lg">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Real-time Stats -->
        <div id="connectionStatus" class="container mx-auto px-4 py-6">
            <div class="bg-gradient-to-r from-gray-900 to-gray-800 rounded-2xl p-6 border border-gray-700 shadow-xl">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center">
                        <div class="w-4 h-4 rounded-full bg-green-500 mr-3 animate-pulse"></div>
                        <h3 class="font-bold text-green-300 text-lg" id="connectionMessage">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß</h3>
                    </div>
                    <div class="text-sm text-gray-400" id="lastSync">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: --:--:--</div>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                    <div class="bg-gray-800/50 rounded-xl p-4 backdrop-blur-sm">
                        <div class="text-3xl font-bold text-blue-300 mb-1" id="alarmCount">0</div>
                        <div class="text-sm text-blue-400">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</div>
                        <div class="text-xs text-gray-500 mt-1" id="activeAlarms">0 ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</div>
                    </div>
                    <div class="bg-gray-800/50 rounded-xl p-4 backdrop-blur-sm">
                        <div class="text-3xl font-bold text-green-300 mb-1" id="deviceOnlineCount">0</div>
                        <div class="text-sm text-green-400">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</div>
                        <div class="text-xs text-gray-500 mt-1" id="totalDevices">0 ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                    </div>
                    <div class="bg-gray-800/50 rounded-xl p-4 backdrop-blur-sm">
                        <div class="text-3xl font-bold text-purple-300 mb-1" id="broadcastCount">0</div>
                        <div class="text-sm text-purple-400">‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                        <div class="text-xs text-gray-500 mt-1" id="todayBroadcasts">0 ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
                    </div>
                    <div class="bg-gray-800/50 rounded-xl p-4 backdrop-blur-sm">
                        <div class="text-3xl font-bold text-yellow-300 mb-1" id="notificationCount">0</div>
                        <div class="text-sm text-yellow-400">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</div>
                        <div class="text-xs text-gray-500 mt-1" id="unreadNotifications">0 ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏≠‡πà‡∏≤‡∏ô</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Current Time & User Info -->
        <div class="container mx-auto px-4 mb-8">
            <div class="bg-gradient-to-r from-blue-900/30 to-purple-900/30 rounded-2xl p-6 border border-gray-700 shadow-xl">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="text-center md:text-left mb-6 md:mb-0">
                        <div id="currentTime" class="text-4xl md:text-5xl font-bold mb-2 font-mono">--:--:--</div>
                        <div id="currentDate" class="text-gray-400 text-lg">-</div>
                    </div>
                    <div class="text-center md:text-right">
                        <div class="text-sm text-gray-400 mb-1">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</div>
                        <div class="flex items-center justify-center md:justify-end">
                            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center mr-3 shadow-lg">
                                <i class="fas fa-user text-white"></i>
                            </div>
                            <div>
                                <div class="font-medium text-xl" id="userName">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</div>
                                <div class="text-sm text-gray-400" id="userDevice">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå: --</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-8 pt-6 border-t border-gray-700">
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="text-sm text-gray-400">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</div>
                            <div id="nextAlarm" class="font-medium text-lg">‡πÑ‡∏°‡πà‡∏°‡∏µ</div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm text-gray-400">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
                            <div class="font-medium text-green-400" id="syncStatus">‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="container mx-auto px-4 mb-8">
            <h2 class="text-xl font-bold mb-4 flex items-center">
                <i class="fas fa-bolt text-yellow-400 mr-3"></i>
                ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡πà‡∏ß‡∏ô
            </h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <button onclick="scrollToForm()" class="bg-gray-800 hover:bg-gray-700 rounded-2xl p-6 flex flex-col items-center transition-all duration-300 hover:scale-105 hover:shadow-2xl group">
                    <div class="w-16 h-16 rounded-full bg-gradient-to-br from-blue-500 to-blue-700 flex items-center justify-center mb-4 shadow-lg group-hover:shadow-xl">
                        <i class="fas fa-plus-circle text-white text-2xl"></i>
                    </div>
                    <span class="text-sm font-medium">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</span>
                    <span class="text-xs text-gray-400 mt-2">‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡∏°‡πà</span>
                </button>
                <button onclick="openNotificationPanel()" class="bg-gray-800 hover:bg-gray-700 rounded-2xl p-6 flex flex-col items-center transition-all duration-300 hover:scale-105 hover:shadow-2xl group relative">
                    <div class="w-16 h-16 rounded-full bg-gradient-to-br from-yellow-500 to-yellow-700 flex items-center justify-center mb-4 shadow-lg group-hover:shadow-xl">
                        <i class="fas fa-bell text-white text-2xl"></i>
                    </div>
                    <span class="text-sm font-medium">‡∏î‡∏π‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</span>
                    <span class="text-xs text-gray-400 mt-2">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
                    <div id="actionBadge" class="notification-badge" style="display: none;">0</div>
                </button>
                <button onclick="scrollToBroadcast()" class="bg-gray-800 hover:bg-gray-700 rounded-2xl p-6 flex flex-col items-center transition-all duration-300 hover:scale-105 hover:shadow-2xl group">
                    <div class="w-16 h-16 rounded-full bg-gradient-to-br from-purple-500 to-purple-700 flex items-center justify-center mb-4 shadow-lg group-hover:shadow-xl">
                        <i class="fas fa-broadcast-tower text-white text-2xl"></i>
                    </div>
                    <span class="text-sm font-medium">‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</span>
                    <span class="text-xs text-gray-400 mt-2">‡πÑ‡∏õ‡∏ó‡∏∏‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</span>
                </button>
                <button onclick="testCrossDeviceNotification()" class="bg-gray-800 hover:bg-gray-700 rounded-2xl p-6 flex flex-col items-center transition-all duration-300 hover:scale-105 hover:shadow-2xl group">
                    <div class="w-16 h-16 rounded-full bg-gradient-to-br from-green-500 to-green-700 flex items-center justify-center mb-4 shadow-lg group-hover:shadow-xl">
                        <i class="fas fa-vibrate text-white text-2xl"></i>
                    </div>
                    <span class="text-sm font-medium">‡∏ó‡∏î‡∏™‡∏≠‡∏ö</span>
                    <span class="text-xs text-gray-400 mt-2">‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</span>
                </button>
            </div>
        </div>
        
        <!-- Add Alarm Form -->
        <div id="alarmFormSection" class="container mx-auto px-4 mb-10">
            <div class="bg-gradient-to-r from-gray-900 to-gray-800 rounded-2xl p-8 border border-gray-700 shadow-2xl">
                <h2 class="text-xl font-bold mb-6 flex items-center">
                    <i class="fas fa-plus-circle text-blue-400 mr-3"></i>
                    ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà
                </h2>
                <form id="alarmForm" class="space-y-6">
                    <div>
                        <label class="block text-gray-400 text-sm font-medium mb-3">
                            <i class="fas fa-heading mr-2"></i>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô *
                        </label>
                        <input type="text" id="alarmTitle" class="w-full p-4 bg-gray-800 border border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg shadow-inner" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏ó‡∏µ‡∏°, ‡∏ô‡∏±‡∏î‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå, ‡∏à‡πà‡∏≤‡∏¢‡∏ö‡∏¥‡∏•..." required>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-400 text-sm font-medium mb-3">
                                <i class="far fa-calendar mr-2"></i>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà *
                            </label>
                            <input type="date" id="alarmDate" class="w-full p-4 bg-gray-800 border border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg shadow-inner" required>
                        </div>
                        <div>
                            <label class="block text-gray-400 text-sm font-medium mb-3">
                                <i class="far fa-clock mr-2"></i>‡πÄ‡∏ß‡∏•‡∏≤ *
                            </label>
                            <input type="time" id="alarmTime" class="w-full p-4 bg-gray-800 border border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg shadow-inner" required>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-gray-400 text-sm font-medium mb-3">
                            <i class="fas fa-align-left mr-2"></i>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                        </label>
                        <textarea id="alarmDescription" rows="3" class="w-full p-4 bg-gray-800 border border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent shadow-inner" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ..."></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-gray-400 text-sm font-medium mb-3">
                            <i class="fas fa-redo mr-2"></i>‡∏ó‡∏≥‡∏ã‡πâ‡∏≥
                        </label>
                        <div class="flex flex-wrap gap-3">
                            <button type="button" onclick="setRepeat('none')" class="px-5 py-3 bg-gradient-to-r from-blue-600 to-blue-700 rounded-xl text-sm font-medium hover:from-blue-700 hover:to-blue-800 transition-all shadow-lg" id="repeatNone">
                                <i class="fas fa-times mr-2"></i>‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏ã‡πâ‡∏≥
                            </button>
                            <button type="button" onclick="setRepeat('daily')" class="px-5 py-3 bg-gray-800 hover:bg-gray-700 rounded-xl text-sm font-medium transition-colors" id="repeatDaily">
                                <i class="fas fa-calendar-day mr-2"></i>‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô
                            </button>
                            <button type="button" onclick="setRepeat('weekly')" class="px-5 py-3 bg-gray-800 hover:bg-gray-700 rounded-xl text-sm font-medium transition-colors" id="repeatWeekly">
                                <i class="fas fa-calendar-week mr-2"></i>‡∏ó‡∏∏‡∏Å‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå
                            </button>
                            <button type="button" onclick="setRepeat('monthly')" class="px-5 py-3 bg-gray-800 hover:bg-gray-700 rounded-xl text-sm font-medium transition-colors" id="repeatMonthly">
                                <i class="fas fa-calendar-alt mr-2"></i>‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-gray-400 text-sm font-medium mb-3">
                            <i class="fas fa-share-alt mr-2"></i>‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏õ‡∏¢‡∏±‡∏á
                        </label>
                        <div class="flex flex-wrap gap-3">
                            <button type="button" onclick="setShareType('private')" class="px-5 py-3 bg-gradient-to-r from-gray-700 to-gray-800 rounded-xl text-sm font-medium" id="sharePrivate">
                                <i class="fas fa-user mr-2"></i>‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏â‡∏±‡∏ô
                            </button>
                            <button type="button" onclick="setShareType('team')" class="px-5 py-3 bg-gray-800 hover:bg-gray-700 rounded-xl text-sm font-medium transition-colors" id="shareTeam">
                                <i class="fas fa-users mr-2"></i>‡∏ó‡∏µ‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                            </button>
                            <button type="button" onclick="setShareType('public')" class="px-5 py-3 bg-gray-800 hover:bg-gray-700 rounded-xl text-sm font-medium transition-colors" id="sharePublic">
                                <i class="fas fa-globe mr-2"></i>‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô
                            </button>
                        </div>
                    </div>
                    
                    <div class="pt-4">
                        <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white py-4 rounded-xl font-bold text-lg transition-all duration-300 hover:scale-[1.02] hover:shadow-2xl shadow-lg">
                            <i class="fas fa-plus-circle mr-3"></i>‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Active Alarms -->
        <div class="container mx-auto px-4 mb-10">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold flex items-center">
                    <i class="fas fa-clock text-yellow-400 mr-3"></i>
                    ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </h2>
                <div class="flex items-center space-x-4">
                    <button onclick="loadAlarms()" class="text-blue-400 text-sm font-medium hover:text-blue-300 transition-colors">
                        <i class="fas fa-sync-alt mr-2"></i>‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                    </button>
                    <button onclick="exportAlarms()" class="text-green-400 text-sm font-medium hover:text-green-300 transition-colors">
                        <i class="fas fa-download mr-2"></i>‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å
                    </button>
                </div>
            </div>
            <div id="alarmsList" class="space-y-4">
                <div class="bg-gradient-to-r from-gray-900 to-gray-800 rounded-2xl p-8 text-center border border-gray-700">
                    <i class="fas fa-clock text-4xl text-gray-500 mb-4"></i>
                    <p class="text-gray-400 text-lg mb-2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
                    <p class="text-gray-500">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</p>
                </div>
            </div>
        </div>
        
        <!-- Broadcast Section -->
        <div id="broadcastSection" class="container mx-auto px-4 mb-24">
            <div class="bg-gradient-to-r from-purple-900/50 to-purple-800/30 rounded-2xl p-8 border border-purple-700/50 shadow-2xl">
                <h2 class="text-xl font-bold mb-6 text-purple-300 flex items-center">
                    <i class="fas fa-broadcast-tower mr-3"></i>
                    ‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÑ‡∏õ‡∏ó‡∏∏‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
                </h2>
                <p class="text-purple-200 text-sm mb-6 bg-purple-900/30 rounded-xl p-4">
                    <i class="fas fa-info-circle mr-2"></i>
                    ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà (‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á) ‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÅ‡∏•‡∏∞‡πÅ‡∏≠‡∏û‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô
                </p>
                <div class="space-y-6">
                    <div>
                        <label class="block text-gray-400 text-sm font-medium mb-3">
                            <i class="fas fa-heading mr-2"></i>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® *
                        </label>
                        <input type="text" id="broadcastTitle" class="w-full p-4 bg-gray-800 border border-gray-700 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent text-lg shadow-inner" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏î‡πà‡∏ß‡∏ô, ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß, ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç..." required>
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm font-medium mb-3">
                            <i class="fas fa-comment-alt mr-2"></i>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® *
                        </label>
                        <textarea id="broadcastMessage" rows="3" class="w-full p-4 bg-gray-800 border border-gray-700 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent shadow-inner" placeholder="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ó‡∏∏‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö..." required></textarea>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button onclick="sendBroadcast()" class="bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white py-4 rounded-xl font-medium transition-all duration-300 hover:scale-[1.02] hover:shadow-2xl shadow-lg">
                            <i class="fas fa-paper-plane mr-3"></i>‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®
                        </button>
                        <button onclick="sendUrgentBroadcast()" class="bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white py-4 rounded-xl font-medium transition-all duration-300 hover:scale-[1.02] hover:shadow-2xl shadow-lg">
                            <i class="fas fa-exclamation-triangle mr-3"></i>‡∏™‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô
                        </button>
                        <button onclick="clearBroadcast()" class="bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-800 hover:to-gray-900 text-white py-4 rounded-xl font-medium transition-all duration-300 hover:scale-[1.02] hover:shadow-2xl shadow-lg">
                            <i class="fas fa-trash mr-3"></i>‡∏•‡πâ‡∏≤‡∏á
                        </button>
                    </div>
                </div>
                <div class="mt-8 p-6 bg-gray-900/50 rounded-xl">
                    <h4 class="font-bold text-purple-300 mb-4 flex items-center">
                        <i class="fas fa-history mr-2"></i>‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                    </h4>
                    <div id="recentBroadcasts" class="space-y-3 max-h-60 overflow-y-auto">
                        <p class="text-gray-400 text-sm text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Notifications Panel -->
        <div id="notificationsPanel" class="notification-panel">
            <div class="p-6 border-b border-gray-800 bg-gradient-to-r from-gray-900 to-gray-800">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
                        <p class="text-gray-400 text-sm mt-1" id="notificationsCount">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button onclick="markAllNotificationsAsRead()" class="text-blue-400 hover:text-blue-300 transition-colors">
                            <i class="fas fa-check-double mr-2"></i>‡∏≠‡πà‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                        </button>
                        <button onclick="closeNotificationPanel()" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fas fa-times text-2xl"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div id="notificationsList" class="flex-1 overflow-y-auto p-6">
                <!-- Notifications will be loaded here -->
            </div>
            <div class="p-6 border-t border-gray-800 bg-gradient-to-r from-gray-900 to-gray-800">
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="clearAllNotifications()" class="bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white py-4 rounded-xl font-medium transition-all duration-300 hover:scale-[1.02] hover:shadow-2xl shadow-lg">
                        <i class="fas fa-trash mr-2"></i>‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                    </button>
                    <button onclick="closeNotificationPanel()" class="bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-800 hover:to-gray-900 text-white py-4 rounded-xl font-medium transition-all duration-300 hover:scale-[1.02] hover:shadow-2xl shadow-lg">
                        <i class="fas fa-times mr-2"></i>‡∏õ‡∏¥‡∏î
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Bottom Navigation -->
        <div class="fixed bottom-0 left-0 right-0 bg-gradient-to-t from-gray-900 to-transparent backdrop-blur-lg z-40 pt-6">
            <div class="container mx-auto px-4">
                <div class="bg-gray-900/90 backdrop-blur-xl rounded-2xl p-4 border border-gray-800 shadow-2xl">
                    <div class="flex justify-around">
                        <button onclick="scrollToTop()" class="flex flex-col items-center text-gray-400 hover:text-white transition-colors p-3 group">
                            <div class="w-12 h-12 rounded-full bg-gradient-to-br from-gray-800 to-gray-900 flex items-center justify-center mb-2 group-hover:from-gray-700 group-hover:to-gray-800 transition-all">
                                <i class="fas fa-home text-xl"></i>
                            </div>
                            <span class="text-xs font-medium">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</span>
                        </button>
                        <button onclick="scrollToForm()" class="flex flex-col items-center text-gray-400 hover:text-white transition-colors p-3 group">
                            <div class="w-12 h-12 rounded-full bg-gradient-to-br from-gray-800 to-gray-900 flex items-center justify-center mb-2 group-hover:from-gray-700 group-hover:to-gray-800 transition-all">
                                <i class="fas fa-plus text-xl"></i>
                            </div>
                            <span class="text-xs font-medium">‡πÄ‡∏û‡∏¥‡πà‡∏°</span>
                        </button>
                        <button onclick="openNotificationPanel()" class="flex flex-col items-center text-gray-400 hover:text-white transition-colors p-3 group relative">
                            <div class="w-12 h-12 rounded-full bg-gradient-to-br from-gray-800 to-gray-900 flex items-center justify-center mb-2 group-hover:from-gray-700 group-hover:to-gray-800 transition-all">
                                <i class="fas fa-bell text-xl"></i>
                            </div>
                            <span class="text-xs font-medium">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</span>
                            <div id="bottomBadge" class="notification-badge" style="display: none;">0</div>
                        </button>
                        <button onclick="scrollToBroadcast()" class="flex flex-col items-center text-gray-400 hover:text-white transition-colors p-3 group">
                            <div class="w-12 h-12 rounded-full bg-gradient-to-br from-gray-800 to-gray-900 flex items-center justify-center mb-2 group-hover:from-gray-700 group-hover:to-gray-800 transition-all">
                                <i class="fas fa-broadcast-tower text-xl"></i>
                            </div>
                            <span class="text-xs font-medium">‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Firebase (Optional) -->
    <!-- <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-messaging-compat.js"></script> -->
    
    <script>
        // ============================================
        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÅ‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà
        // ============================================
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwpOYJ_pB6Llu9bd7RJABMd0awxu09oVFPB1cK4zsq3-aBYze5EpSHTSGgO1EcSJ3DwpQ/exec";
        const VAPID_PUBLIC_KEY = "YOUR_VAPID_PUBLIC_KEY_HERE"; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Push Notifications
        
        let alarms = [];
        let notifications = [];
        let broadcasts = [];
        let devices = [];
        let userId = '';
        let userName = '';
        let deviceId = '';
        let currentRepeat = 'none';
        let currentShareType = 'private';
        let checkAlarmInterval = null;
        let updateTimeInterval = null;
        let checkBroadcastInterval = null;
        let deviceSyncInterval = null;
        let lastBroadcastCheck = 0;
        let lastSync = null;
        let deferredPrompt = null;
        let isAppInstalled = false;
        let isOnline = true;
        let notificationPermission = 'default';
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
        const platform = {
            isMobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
            isDesktop: !/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
            browser: {
                isChrome: /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor),
                isFirefox: typeof InstallTrigger !== 'undefined',
                isSafari: /^((?!chrome|android).)*safari/i.test(navigator.userAgent),
                isEdge: /Edg/.test(navigator.userAgent),
                isOpera: !!window.opera || navigator.userAgent.indexOf(' OPR/') >= 0
            },
            os: {
                isWindows: /Win/.test(navigator.platform),
                isMac: /Mac/.test(navigator.platform),
                isLinux: /Linux/.test(navigator.platform)
            }
        };
        
        // ============================================
        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô
        // ============================================
        async function initApp() {
            console.log('üöÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á...');
            console.log('‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°:', platform);
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï
            isOnline = navigator.onLine;
            window.addEventListener('online', () => {
                isOnline = true;
                updateConnectionStatus();
                syncAllData();
            });
            window.addEventListener('offline', () => {
                isOnline = false;
                updateConnectionStatus();
            });
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ
            checkAppInstallation();
            
            // ‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            await requestNotificationPermission();
            
            // ‡πÄ‡∏£‡∏¥‡πà‡∏° Service Worker
            await initServiceWorker();
            
            // ‡πÅ‡∏™‡∏î‡∏á loading progress
            updateLoadingText('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏£‡∏∞‡∏ö‡∏ö...', 10);
            
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
            setTimeout(() => {
                loadUserData();
                updateLoadingText('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ...', 25);
            }, 500);
            
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏≠‡∏õ
            setTimeout(() => {
                loadAppData();
                updateLoadingText('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏≠‡∏õ...', 40);
            }, 1000);
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ device
            setTimeout(async () => {
                await initDevice();
                updateLoadingText('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå...', 60);
            }, 1500);
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
            setTimeout(() => {
                setupForm();
                updateLoadingText('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤...', 75);
            }, 2000);
            
            // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
            setTimeout(async () => {
                await testConnection();
                updateLoadingText('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...', 85);
            }, 2200);
            
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå
            setTimeout(async () => {
                await syncAllData();
                updateLoadingText('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 90);
            }, 2400);
            
            // ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î
            setTimeout(() => {
                finishLoading();
                updateLoadingText('‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô!', 100);
            }, 2700);
        }
        
        function updateLoadingText(text, progress) {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loadingProgress').style.width = progress + '%';
            document.getElementById('loadingStatus').textContent = text;
        }
        
        async function loadUserData() {
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏î‡∏∂‡∏á User ID
            userId = localStorage.getItem('userId');
            if (!userId) {
                userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('userId', userId);
            }
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏î‡∏∂‡∏á User Name
            userName = localStorage.getItem('userName');
            if (!userName) {
                // ‡∏™‡∏∏‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à
                const names = ['‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö', '‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡∏°', '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô', '‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà', '‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£'];
                const randomNum = Math.floor(Math.random() * 1000);
                userName = `${names[Math.floor(Math.random() * names.length)]} ${randomNum}`;
                localStorage.setItem('userName', userName);
            }
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
            document.getElementById('userName').textContent = userName;
            document.getElementById('userDevice').textContent = `‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå: ${platform.isMobile ? '‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠' : '‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå'}`;
        }
        
        function loadAppData() {
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å localStorage
            alarms = JSON.parse(localStorage.getItem('alarms')) || [];
            notifications = JSON.parse(localStorage.getItem('notifications')) || [];
            broadcasts = JSON.parse(localStorage.getItem('broadcasts')) || [];
            devices = JSON.parse(localStorage.getItem('devices')) || [];
            
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö alarms
            alarms.sort((a, b) => new Date(a.datetime) - new Date(b.datetime));
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
            updateAlarmsList();
            updateCounts();
            updateBadges();
            updateRecentBroadcasts();
            updateDeviceList();
        }
        
        async function initDevice() {
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏î‡∏∂‡∏á Device ID
            deviceId = localStorage.getItem('deviceId');
            if (!deviceId) {
                deviceId = 'device_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('deviceId', deviceId);
            }
            
            // ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô device ‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå
            await registerDevice();
            
            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£ sync ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• device
            deviceSyncInterval = setInterval(syncDeviceStatus, 60000); // ‡∏ó‡∏∏‡∏Å 1 ‡∏ô‡∏≤‡∏ó‡∏µ
            
            // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏õ
            window.addEventListener('beforeunload', () => {
                updateDeviceStatus('offline');
            });
            
            // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠ visibility ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
            document.addEventListener('visibilitychange', () => {
                if (document.visibilityState === 'hidden') {
                    updateDeviceStatus('away');
                } else {
                    updateDeviceStatus('online');
                }
            });
            
            console.log('üì± Device initialized:', deviceId);
        }
        
        async function registerDevice() {
            try {
                const payload = {
                    action: 'register_device',
                    device_id: deviceId,
                    user_id: userId,
                    user_name: userName,
                    user_agent: navigator.userAgent,
                    platform: platform.isMobile ? 'mobile' : 'desktop',
                    browser: platform.browser.isChrome ? 'chrome' : 
                            platform.browser.isFirefox ? 'firefox' : 
                            platform.browser.isSafari ? 'safari' : 
                            platform.browser.isEdge ? 'edge' : 'other',
                    os: platform.os.isWindows ? 'windows' : 
                        platform.os.isMac ? 'mac' : 
                        platform.os.isLinux ? 'linux' : 'other',
                    timestamp: Date.now()
                };
                
                await callGoogleScript(payload);
                console.log('‚úÖ Device registered successfully');
            } catch (error) {
                console.log('‚ö†Ô∏è Could not register device:', error);
            }
        }
        
        async function updateDeviceStatus(status = 'online') {
            try {
                const payload = {
                    action: 'update_device_status',
                    device_id: deviceId,
                    status: status,
                    timestamp: Date.now()
                };
                
                await callGoogleScript(payload);
                console.log(`üì± Device status updated to: ${status}`);
            } catch (error) {
                console.log('‚ö†Ô∏è Could not update device status:', error);
            }
        }
        
        async function syncDeviceStatus() {
            await updateDeviceStatus('online');
            await getOnlineDevices();
        }
        
        function setupForm() {
            const today = new Date().toISOString().split('T')[0];
            const now = new Date();
            const nextHour = new Date(now.getTime() + 60 * 60 * 1000);
            
            document.getElementById('alarmDate').min = today;
            document.getElementById('alarmDate').value = today;
            document.getElementById('alarmTime').value = 
                nextHour.getHours().toString().padStart(2, '0') + ':' + 
                nextHour.getMinutes().toString().padStart(2, '0');
            
            setRepeat('none');
            setShareType('private');
        }
        
        function startTimers() {
            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            if (checkAlarmInterval) clearInterval(checkAlarmInterval);
            checkAlarmInterval = setInterval(checkAlarms, 1000);
            
            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ß‡∏•‡∏≤
            if (updateTimeInterval) clearInterval(updateTimeInterval);
            updateTimeInterval = setInterval(updateCurrentTime, 1000);
            
            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÉ‡∏´‡∏°‡πà
            if (checkBroadcastInterval) clearInterval(checkBroadcastInterval);
            checkBroadcastInterval = setInterval(checkForNewBroadcasts, 10000); // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
            updateCurrentTime();
            
            console.log('‚è∞ Timers started');
        }
        
        function finishLoading() {
            updateLoadingText('‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô!', 100);
            
            setTimeout(() => {
                document.getElementById('loadingScreen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                    document.getElementById('mainApp').classList.remove('hidden');
                    
                    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
                    startTimers();
                    
                    console.log('‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
                    
                    // ‡πÅ‡∏™‡∏î‡∏á welcome notification
                    setTimeout(() => {
                        if (Notification.permission === 'granted') {
                            showCrossDeviceNotification(
                                '‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô',
                                '‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ',
                                'welcome'
                            );
                        }
                    }, 1000);
                }, 300);
            }, 500);
        }
        
        // ============================================
        // Service Worker ‡πÅ‡∏•‡∏∞ Push Notifications
        // ============================================
        async function initServiceWorker() {
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js');
                    console.log('‚úÖ Service Worker registered:', registration);
                    
                    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Push Notifications
                    await setupPushNotifications(registration);
                    
                    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Background Sync
                    setupBackgroundSync(registration);
                    
                } catch (error) {
                    console.log('‚ùå Service Worker registration failed:', error);
                }
            } else {
                console.log('‚ùå Service Worker not supported');
            }
        }
        
        async function setupPushNotifications(registration) {
            if (!('PushManager' in window)) {
                console.log('‚ùå Push notifications not supported');
                return;
            }
            
            try {
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö subscription ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
                let subscription = await registration.pushManager.getSubscription();
                
                if (!subscription) {
                    // ‡∏•‡∏≠‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                    const permission = await Notification.requestPermission();
                    if (permission !== 'granted') {
                        console.log('‚ùå Notification permission denied');
                        return;
                    }
                    
                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á subscription ‡πÉ‡∏´‡∏°‡πà
                    subscription = await registration.pushManager.subscribe({
                        userVisibleOnly: true,
                        applicationServerKey: urlBase64ToUint8Array(VAPID_PUBLIC_KEY)
                    });
                    
                    console.log('‚úÖ Push subscription created');
                    
                    // ‡∏™‡πà‡∏á subscription ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå
                    await savePushSubscription(subscription);
                }
                
                console.log('‚úÖ Push notifications ready');
            } catch (error) {
                console.log('‚ùå Push notification setup failed:', error);
            }
        }
        
        function setupBackgroundSync(registration) {
            if ('sync' in registration) {
                console.log('‚úÖ Background Sync supported');
                
                // ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô sync tags
                registration.sync.register('sync-alarms');
                registration.sync.register('sync-broadcasts');
                registration.sync.register('sync-devices');
            }
        }
        
        function urlBase64ToUint8Array(base64String) {
            const padding = '='.repeat((4 - base64String.length % 4) % 4);
            const base64 = (base64String + padding)
                .replace(/-/g, '+')
                .replace(/_/g, '/');
            
            const rawData = window.atob(base64);
            const outputArray = new Uint8Array(rawData.length);
            
            for (let i = 0; i < rawData.length; ++i) {
                outputArray[i] = rawData.charCodeAt(i);
            }
            return outputArray;
        }
        
        async function savePushSubscription(subscription) {
            try {
                const payload = {
                    action: 'save_push_subscription',
                    device_id: deviceId,
                    user_id: userId,
                    subscription: JSON.stringify(subscription),
                    timestamp: Date.now()
                };
                
                await callGoogleScript(payload);
                console.log('‚úÖ Push subscription saved to server');
            } catch (error) {
                console.log('‚ùå Could not save push subscription:', error);
            }
        }
        
        async function requestNotificationPermission() {
            if (!('Notification' in window)) {
                console.log('‚ùå This browser does not support notifications');
                return;
            }
            
            notificationPermission = Notification.permission;
            
            if (notificationPermission === 'default') {
                // ‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏î‡πâ‡∏ß‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
                if (platform.isDesktop) {
                    // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Desktop: ‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                    notificationPermission = await Notification.requestPermission();
                } else {
                    // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Mobile: ‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÇ‡∏ï‡πâ‡∏ï‡∏≠‡∏ö
                    await Swal.fire({
                        title: '‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô',
                        html: `
                            <div class="text-left">
                                <p class="mb-3">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ö‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏∑‡πà‡∏≠:</p>
                                <div class="space-y-2 mb-4">
                                    <div class="flex items-center">
                                        <i class="fas fa-check-circle text-green-400 mr-2"></i>
                                        <span>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤</span>
                                    </div>
                                    <div class="flex items-center">
                                        <i class="fas fa-check-circle text-green-400 mr-2"></i>
                                        <span>‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô</span>
                                    </div>
                                    <div class="flex items-center">
                                        <i class="fas fa-check-circle text-green-400 mr-2"></i>
                                        <span>‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ</span>
                                    </div>
                                </div>
                                <p class="text-sm text-gray-400">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</p>
                            </div>
                        `,
                        icon: 'info',
                        showCancelButton: true,
                        confirmButtonText: '‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï',
                        cancelButtonText: '‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô',
                        background: '#1f2937',
                        color: '#e5e7eb'
                    }).then(async (result) => {
                        if (result.isConfirmed) {
                            notificationPermission = await Notification.requestPermission();
                        }
                    });
                }
            }
            
            if (notificationPermission === 'granted') {
                console.log('‚úÖ Notification permission granted');
            } else {
                console.log('‚ùå Notification permission denied or dismissed');
            }
        }
        
        // ============================================
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ß‡∏•‡∏≤
        // ============================================
        function updateCurrentTime() {
            const now = new Date();
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ß‡∏•‡∏≤
            document.getElementById('currentTime').textContent = 
                now.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            
            document.getElementById('currentDate').textContent = 
                now.toLocaleDateString('th-TH', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ß‡∏•‡∏≤‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
            if (lastSync) {
                const syncTime = new Date(lastSync);
                const diff = Math.floor((now - syncTime) / 1000);
                
                let timeText;
                if (diff < 60) {
                    timeText = `${diff} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß`;
                } else if (diff < 3600) {
                    timeText = `${Math.floor(diff / 60)} ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß`;
                } else {
                    timeText = syncTime.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' });
                }
                
                document.getElementById('lastSync').textContent = `‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${timeText}`;
            }
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
            updateNextAlarm();
        }
        
        function updateNextAlarm() {
            const now = new Date();
            const upcomingAlarms = alarms.filter(alarm => 
                !alarm.triggered && new Date(alarm.datetime) > now
            );
            
            if (upcomingAlarms.length > 0) {
                const nextAlarm = upcomingAlarms[0];
                const alarmDate = new Date(nextAlarm.datetime);
                const timeDiff = alarmDate - now;
                const hoursDiff = Math.floor(timeDiff / (1000 * 60 * 60));
                const minutesDiff = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
                
                let timeText;
                if (hoursDiff > 0) {
                    timeText = `${hoursDiff} ‡∏ä‡∏°. ${minutesDiff} ‡∏ô‡∏≤‡∏ó‡∏µ`;
                } else {
                    timeText = `${minutesDiff} ‡∏ô‡∏≤‡∏ó‡∏µ`;
                }
                
                document.getElementById('nextAlarm').innerHTML = `
                    <div class="font-bold">${nextAlarm.title}</div>
                    <div class="text-sm text-gray-400">‡∏≠‡∏µ‡∏Å ${timeText}</div>
                `;
            } else {
                document.getElementById('nextAlarm').innerHTML = `
                    <div class="font-bold">‡πÑ‡∏°‡πà‡∏°‡∏µ</div>
                    <div class="text-sm text-gray-400">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà</div>
                `;
            }
        }
        
        // ============================================
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ü‡∏≠‡∏£‡πå‡∏°
        // ============================================
        function setRepeat(value) {
            currentRepeat = value;
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            ['none', 'daily', 'weekly', 'monthly'].forEach(type => {
                const btn = document.getElementById('repeat' + type.charAt(0).toUpperCase() + type.slice(1));
                if (btn) btn.className = 'px-5 py-3 bg-gray-800 hover:bg-gray-700 rounded-xl text-sm font-medium transition-colors';
            });
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            const selectedBtn = document.getElementById('repeat' + value.charAt(0).toUpperCase() + value.slice(1));
            if (selectedBtn) selectedBtn.className = 'px-5 py-3 bg-gradient-to-r from-blue-600 to-blue-700 rounded-xl text-sm font-medium hover:from-blue-700 hover:to-blue-800 transition-all shadow-lg';
        }
        
        function setShareType(value) {
            currentShareType = value;
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            ['private', 'team', 'public'].forEach(type => {
                const btn = document.getElementById('share' + type.charAt(0).toUpperCase() + type.slice(1));
                if (btn) btn.className = 'px-5 py-3 bg-gray-800 hover:bg-gray-700 rounded-xl text-sm font-medium transition-colors';
            });
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            const selectedBtn = document.getElementById('share' + value.charAt(0).toUpperCase() + value.slice(1));
            if (selectedBtn) selectedBtn.className = 'px-5 py-3 bg-gradient-to-r from-gray-700 to-gray-800 rounded-xl text-sm font-medium';
        }
        
        document.getElementById('alarmForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const title = document.getElementById('alarmTitle').value.trim();
            const date = document.getElementById('alarmDate').value;
            const time = document.getElementById('alarmTime').value;
            const description = document.getElementById('alarmDescription').value.trim();
            
            if (!title || !date || !time) {
                showAlert('error', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }
            
            const datetime = new Date(`${date}T${time}`);
            
            if (datetime <= new Date()) {
                showAlert('warning', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï');
                return;
            }
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á alarm object
            const alarm = {
                id: 'alarm_' + Date.now() + '_' + Math.random().toString(36).substr(2, 8),
                title: title,
                description: description,
                date: date,
                time: time,
                datetime: datetime.toISOString(),
                repeat: currentRepeat,
                share: currentShareType,
                triggered: false,
                synced: false,
                device_id: deviceId,
                user_id: userId,
                user_name: userName,
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString()
            };
            
            // ‡πÅ‡∏™‡∏î‡∏á loading
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
            submitBtn.disabled = true;
            
            try {
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                alarms.push(alarm);
                localStorage.setItem('alarms', JSON.stringify(alarms));
                
                // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheets
                let saved = false;
                try {
                    saved = await saveToGoogleSheets(alarm, 'created');
                    alarm.synced = saved;
                    localStorage.setItem('alarms', JSON.stringify(alarms));
                } catch (error) {
                    console.log('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheets:', error);
                }
                
                // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
                document.getElementById('alarmForm').reset();
                setupForm();
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
                updateAlarmsList();
                updateCounts();
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                showAlert('success', `‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤ "${title}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!` + (saved ? ' (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå)' : ' (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)'));
                
                // ‡∏™‡∏±‡πà‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î
                vibrateDevice([100, 50, 100]);
                
                // ‡πÅ‡∏™‡∏î‡∏á notification ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                if (notificationPermission === 'granted') {
                    showCrossDeviceNotification(
                        `‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà: ${title}`,
                        description || '‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢',
                        'alarm_created'
                    );
                }
                
                // Sync ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                syncAllData();
                
            } catch (error) {
                console.error('Error creating alarm:', error);
                showAlert('error', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤');
            } finally {
                // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏õ‡∏∏‡πà‡∏°
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        });
        
        // ============================================
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Google Sheets
        // ============================================
        async function testConnection() {
            try {
                const payload = {
                    action: 'test',
                    timestamp: Date.now()
                };
                
                const response = await callGoogleScript(payload);
                
                if (response && response.status === 'success') {
                    console.log('‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', response);
                    
                    updateConnectionStatus('online', '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                    return true;
                }
            } catch (error) {
                console.log('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ:', error);
            }
            
            updateConnectionStatus('warning', '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô');
            return false;
        }
        
        async function callGoogleScript(payload) {
            if (!isOnline) {
                throw new Error('Offline');
            }
            
            const params = new URLSearchParams();
            for (const key in payload) {
                if (payload[key] !== undefined && payload[key] !== null) {
                    params.append(key, payload[key].toString());
                }
            }
            
            const url = `${GOOGLE_SCRIPT_URL}?${params.toString()}`;
            const response = await fetch(url, {
                method: 'GET',
                headers: {
                    'Cache-Control': 'no-cache'
                }
            });
            
            if (response.ok) {
                return await response.json();
            } else {
                throw new Error(`HTTP ${response.status}`);
            }
        }
        
        async function saveToGoogleSheets(alarm, status = 'created') {
            try {
                const payload = {
                    action: 'add_alarm',
                    alarm_id: alarm.id,
                    user_id: userId,
                    user_name: userName,
                    device_id: deviceId,
                    title: alarm.title,
                    description: alarm.description || '',
                    date: alarm.date,
                    time: alarm.time,
                    datetime: alarm.datetime,
                    repeat: alarm.repeat,
                    share: alarm.share,
                    status: status,
                    created_at: alarm.created_at,
                    timestamp: Date.now()
                };
                
                const result = await callGoogleScript(payload);
                console.log('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', result);
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï last sync
                lastSync = Date.now();
                
                return true;
            } catch (error) {
                console.error('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå:', error);
                return false;
            }
        }
        
        async function deleteFromGoogleSheets(alarmId) {
            try {
                const payload = {
                    action: 'delete_alarm',
                    alarm_id: alarmId,
                    user_id: userId,
                    device_id: deviceId,
                    hard_delete: 'true',
                    timestamp: Date.now()
                };
                
                await callGoogleScript(payload);
                console.log('‚úÖ ‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                return true;
            } catch (error) {
                console.error('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå:', error);
                return false;
            }
        }
        
        async function updateAlarmStatusInSheets(alarmId, status) {
            try {
                const payload = {
                    action: 'update_alarm',
                    alarm_id: alarmId,
                    status: status,
                    triggered_at: new Date().toISOString(),
                    user_id: userId,
                    device_id: deviceId,
                    timestamp: Date.now()
                };
                
                await callGoogleScript(payload);
                return true;
            } catch (error) {
                console.error('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:', error);
                return false;
            }
        }
        
        // ============================================
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        // ============================================
        function checkAlarms() {
            const now = new Date();
            
            alarms.forEach((alarm, index) => {
                if (!alarm.triggered && new Date(alarm.datetime) <= now) {
                    triggerAlarm(alarm);
                }
            });
        }
        
        async function triggerAlarm(alarm) {
            console.log('üîî Triggering alarm:', alarm.title);
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
            alarm.triggered = true;
            alarm.triggered_at = new Date().toISOString();
            alarm.updated_at = new Date().toISOString();
            localStorage.setItem('alarms', JSON.stringify(alarms));
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á notification
            const notification = {
                id: 'notif_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6),
                type: 'alarm',
                title: `‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ${alarm.title}`,
                message: alarm.description || '‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏∂‡∏á‡πÅ‡∏•‡πâ‡∏ß!',
                time: new Date().toISOString(),
                alarm_id: alarm.id,
                read: false,
                device_id: deviceId,
                user_id: userId
            };
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            addNotification(notification);
            
            // ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
            await sendCrossDeviceNotification(
                notification.title,
                notification.message,
                'alarm',
                { alarm_id: alarm.id }
            );
            
            // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏ã‡πâ‡∏≥ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà
            if (alarm.repeat !== 'none') {
                createNextRepeatAlarm(alarm);
            }
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
            updateAlarmsList();
            updateCounts();
            
            // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå
            try {
                await updateAlarmStatusInSheets(alarm.id, 'triggered');
            } catch (error) {
                console.error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ô‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå:', error);
            }
        }
        
        function createNextRepeatAlarm(alarm) {
            const alarmDate = new Date(alarm.datetime);
            
            switch (alarm.repeat) {
                case 'daily':
                    alarmDate.setDate(alarmDate.getDate() + 1);
                    break;
                case 'weekly':
                    alarmDate.setDate(alarmDate.getDate() + 7);
                    break;
                case 'monthly':
                    alarmDate.setMonth(alarmDate.getMonth() + 1);
                    break;
            }
            
            const newAlarm = {
                ...alarm,
                id: 'alarm_' + Date.now() + '_' + Math.random().toString(36).substr(2, 8),
                datetime: alarmDate.toISOString(),
                date: alarmDate.toISOString().split('T')[0],
                time: alarmDate.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit', second: '2-digit' }),
                triggered: false,
                synced: false,
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString()
            };
            
            alarms.push(newAlarm);
            localStorage.setItem('alarms', JSON.stringify(alarms));
            
            // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå
            saveToGoogleSheets(newAlarm, 'created').catch(error => {
                console.error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≥‡∏ã‡πâ‡∏≥:', error);
            });
            
            updateAlarmsList();
            updateCounts();
        }
        
        // ============================================
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Broadcast (‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)
        // ============================================
        async function checkForNewBroadcasts() {
            if (!isOnline) return;
            
            try {
                const payload = {
                    action: 'get_broadcasts',
                    user_id: userId,
                    device_id: deviceId,
                    last_check: lastBroadcastCheck || 0,
                    timestamp: Date.now()
                };
                
                const result = await callGoogleScript(payload);
                
                if (result.status === 'success' && result.data && result.data.length > 0) {
                    // ‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÉ‡∏´‡∏°‡πà
                    result.data.forEach(broadcast => {
                        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏Ñ‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
                        if (!broadcasts.some(b => b.id === broadcast.id)) {
                            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÉ‡∏´‡∏°‡πà
                            broadcasts.unshift(broadcast);
                            
                            // ‡∏™‡∏£‡πâ‡∏≤‡∏á notification
                            const notification = {
                                id: 'broadcast_' + broadcast.id,
                                type: 'broadcast',
                                title: broadcast.title,
                                message: broadcast.message,
                                time: broadcast.time || new Date().toISOString(),
                                broadcast_id: broadcast.id,
                                read: false,
                                device_id: deviceId,
                                user_id: userId
                            };
                            
                            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô notifications
                            addNotification(notification);
                            
                            // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                            showCrossDeviceNotification(
                                broadcast.title,
                                broadcast.message,
                                'broadcast',
                                { broadcast_id: broadcast.id }
                            );
                        }
                    });
                    
                    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å broadcasts
                    if (broadcasts.length > 100) {
                        broadcasts = broadcasts.slice(0, 100);
                    }
                    localStorage.setItem('broadcasts', JSON.stringify(broadcasts));
                    
                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
                    updateRecentBroadcasts();
                    updateCounts();
                    
                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                    lastBroadcastCheck = Date.now();
                }
            } catch (error) {
                console.log('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÉ‡∏´‡∏°‡πà:', error);
            }
        }
        
        async function sendBroadcast() {
            const title = document.getElementById('broadcastTitle').value.trim();
            const message = document.getElementById('broadcastMessage').value.trim();
            
            if (!title || !message) {
                showAlert('error', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®');
                return;
            }
            
            const result = await Swal.fire({
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®',
                html: `
                    <div class="text-left">
                        <p class="mb-3">‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® "<strong>${title}</strong>" ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ó‡∏∏‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á?</p>
                        <div class="bg-gray-800 rounded-lg p-3 mb-3">
                            <p class="text-sm mb-1"><i class="fas fa-check-circle text-green-400 mr-2"></i>‡∏ó‡∏∏‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</p>
                            <p class="text-sm mb-1"><i class="fas fa-check-circle text-green-400 mr-2"></i>‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ</p>
                            <p class="text-sm"><i class="fas fa-check-circle text-green-400 mr-2"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</p>
                        </div>
                        <p class="text-xs text-gray-400">‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
                    </div>
                `,
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: '‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                background: '#1f2937',
                color: '#e5e7eb'
            });
            
            if (!result.isConfirmed) return;
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á broadcast
            const broadcast = {
                id: 'broadcast_' + Date.now() + '_' + Math.random().toString(36).substr(2, 8),
                type: 'broadcast',
                title: `üì¢ ${title}`,
                message: message,
                time: new Date().toISOString(),
                sender: userId,
                sender_name: userName,
                device_id: deviceId,
                urgent: false
            };
            
            // ‡∏™‡πà‡∏á broadcast
            await sendBroadcastToServer(broadcast);
        }
        
        async function sendUrgentBroadcast() {
            const title = document.getElementById('broadcastTitle').value.trim();
            const message = document.getElementById('broadcastMessage').value.trim();
            
            if (!title || !message) {
                showAlert('error', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®');
                return;
            }
            
            const result = await Swal.fire({
                title: '‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏î‡πà‡∏ß‡∏ô!',
                html: `
                    <div class="text-left">
                        <p class="mb-3 text-red-400"><i class="fas fa-exclamation-triangle mr-2"></i>‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏î‡πà‡∏ß‡∏ô "<strong>${title}</strong>"</p>
                        <div class="bg-red-900/30 rounded-lg p-3 mb-3 border border-red-700/50">
                            <p class="text-sm mb-1"><i class="fas fa-bell text-red-400 mr-2"></i>‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏π‡∏á</p>
                            <p class="text-sm mb-1"><i class="fas fa-exclamation text-red-400 mr-2"></i>‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÅ‡∏°‡πâ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á</p>
                            <p class="text-sm"><i class="fas fa-vibrate text-red-400 mr-2"></i>‡∏™‡∏±‡πà‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</p>
                        </div>
                        <p class="text-xs text-gray-400">‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏î‡πà‡∏ß‡∏ô‡∏à‡∏∞‡∏£‡∏ö‡∏Å‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
                    </div>
                `,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: '‡∏™‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô',
                cancelButtonText: '‡∏™‡πà‡∏á‡∏õ‡∏Å‡∏ï‡∏¥',
                confirmButtonColor: '#ef4444',
                background: '#1f2937',
                color: '#e5e7eb'
            });
            
            if (!result.isConfirmed) return;
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á broadcast ‡∏î‡πà‡∏ß‡∏ô
            const broadcast = {
                id: 'broadcast_urgent_' + Date.now() + '_' + Math.random().toString(36).substr(2, 8),
                type: 'broadcast',
                title: `üö® ${title}`,
                message: message,
                time: new Date().toISOString(),
                sender: userId,
                sender_name: userName,
                device_id: deviceId,
                urgent: true
            };
            
            // ‡∏™‡πà‡∏á broadcast ‡∏î‡πà‡∏ß‡∏ô
            await sendBroadcastToServer(broadcast, true);
        }
        
        async function sendBroadcastToServer(broadcast, urgent = false) {
            try {
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô local broadcasts
                broadcasts.unshift(broadcast);
                if (broadcasts.length > 100) {
                    broadcasts = broadcasts.slice(0, 100);
                }
                localStorage.setItem('broadcasts', JSON.stringify(broadcasts));
                
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á notification
                const notification = {
                    id: broadcast.id,
                    type: 'broadcast',
                    title: broadcast.title,
                    message: broadcast.message,
                    time: broadcast.time,
                    broadcast_id: broadcast.id,
                    read: false,
                    device_id: deviceId,
                    user_id: userId
                };
                
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô notifications
                addNotification(notification);
                
                // ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ
                showCrossDeviceNotification(
                    broadcast.title,
                    broadcast.message,
                    'broadcast',
                    { broadcast_id: broadcast.id, urgent: urgent }
                );
                
                // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå
                const payload = {
                    action: 'add_broadcast',
                    broadcast_id: broadcast.id,
                    user_id: userId,
                    user_name: userName,
                    device_id: deviceId,
                    title: broadcast.title.replace(/[üì¢üö®]/g, '').trim(),
                    message: broadcast.message,
                    urgent: urgent ? 'true' : 'false',
                    timestamp: Date.now()
                };
                
                const result = await callGoogleScript(payload);
                
                if (result && result.status === 'success') {
                    showAlert('success', '‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! (‡∏ó‡∏∏‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏µ‡πâ)');
                    
                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö
                    setTimeout(() => {
                        const deviceCount = document.getElementById('deviceOnlineCount').textContent;
                        showAlert('info', `‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á ${deviceCount} ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå`);
                    }, 1000);
                } else {
                    showAlert('warning', '‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÑ‡∏î‡πâ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß)');
                }
                
                // ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
                clearBroadcast();
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
                updateRecentBroadcasts();
                updateCounts();
                
            } catch (error) {
                console.error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®:', error);
                showAlert('error', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
            }
        }
        
        function clearBroadcast() {
            document.getElementById('broadcastTitle').value = '';
            document.getElementById('broadcastMessage').value = '';
        }
        
        function updateRecentBroadcasts() {
            const container = document.getElementById('recentBroadcasts');
            
            if (broadcasts.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-sm text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</p>';
                return;
            }
            
            const recentBroadcasts = broadcasts.slice(0, 5); // ‡πÅ‡∏™‡∏î‡∏á 5 ‡∏≠‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
            container.innerHTML = '';
            
            recentBroadcasts.forEach(broadcast => {
                const time = new Date(broadcast.time);
                const isUrgent = broadcast.title.includes('üö®');
                const isBroadcast = broadcast.title.includes('üì¢');
                
                const broadcastElement = document.createElement('div');
                broadcastElement.className = `bg-gray-800/50 rounded-xl p-4 border-l-4 ${isUrgent ? 'border-red-500' : 'border-purple-500'}`;
                broadcastElement.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h5 class="font-medium text-white text-sm flex items-center">
                            ${isUrgent ? '<i class="fas fa-exclamation-triangle text-red-400 mr-2"></i>' : 
                              isBroadcast ? '<i class="fas fa-broadcast-tower text-purple-400 mr-2"></i>' : 
                              '<i class="fas fa-bell text-blue-400 mr-2"></i>'}
                            ${broadcast.title}
                        </h5>
                        <span class="text-xs ${isUrgent ? 'text-red-400' : 'text-purple-400'}">
                            ${isUrgent ? '‡∏î‡πà‡∏ß‡∏ô' : '‡∏õ‡∏Å‡∏ï‡∏¥'}
                        </span>
                    </div>
                    <p class="text-gray-300 text-sm mb-2">${broadcast.message}</p>
                    <div class="flex justify-between items-center">
                        <p class="text-gray-500 text-xs">
                            <i class="far fa-clock mr-1"></i>
                            ${time.toLocaleDateString('th-TH')} ${time.toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'})}
                        </p>
                        <p class="text-gray-500 text-xs">
                            <i class="fas fa-user mr-1"></i>
                            ${broadcast.sender_name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}
                        </p>
                    </div>
                `;
                container.appendChild(broadcastElement);
            });
        }
        
        // ============================================
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Cross-Device Notifications
        // ============================================
        async function showCrossDeviceNotification(title, message, type = 'notification', data = {}) {
            // ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ
            if (platform.isDesktop) {
                showDesktopNotification(title, message, type, data);
            } else {
                showMobileNotification(title, message, type, data);
            }
            
            // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡πÅ‡∏ä‡∏£‡πå‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
            if (data.broadcast_id || data.alarm_id) {
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å notification ‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö sync ‡∏Å‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏∑‡πà‡∏ô
                saveNotificationForSync(title, message, type, data);
            }
        }
        
        function showDesktopNotification(title, message, type = 'notification', data = {}) {
            const notificationEl = document.getElementById('desktopNotification');
            const iconEl = document.getElementById('desktopNotificationIcon');
            const titleEl = document.getElementById('desktopNotificationTitle');
            const messageEl = document.getElementById('desktopNotificationMessage');
            const timeEl = document.getElementById('desktopNotificationTime').querySelector('span');
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            titleEl.textContent = title;
            messageEl.textContent = message;
            timeEl.textContent = new Date().toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' });
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ icon ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏•‡∏≤‡∏™‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
            notificationEl.className = 'desktop-notification show';
            
            if (type === 'alarm' || data.alarm_id) {
                iconEl.className = 'fas fa-clock text-white text-xl';
                notificationEl.classList.add('alarm');
            } else if (type === 'broadcast' || data.broadcast_id) {
                iconEl.className = 'fas fa-broadcast-tower text-white text-xl';
                notificationEl.classList.add('broadcast');
            } else {
                iconEl.className = 'fas fa-bell text-white text-xl';
                notificationEl.classList.add('test');
            }
            
            // ‡πÅ‡∏™‡∏î‡∏á notification
            notificationEl.classList.add('show');
            
            // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
            if (data.urgent || type === 'alarm') {
                playNotificationSound('urgent');
                vibrateDevice([500, 200, 500]);
            } else {
                playNotificationSound('normal');
            }
            
            // ‡∏õ‡∏¥‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
            const autoCloseTime = data.urgent ? 30000 : // 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡πà‡∏ß‡∏ô
                                 type === 'alarm' ? 60000 : // 1 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö alarm
                                 10000; // 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
                                 
            setTimeout(() => {
                if (notificationEl.classList.contains('show')) {
                    closeDesktopNotification();
                }
            }, autoCloseTime);
        }
        
        function closeDesktopNotification() {
            const notificationEl = document.getElementById('desktopNotification');
            notificationEl.classList.remove('show');
        }
        
        function showMobileNotification(title, message, type = 'notification', data = {}) {
            // ‡πÉ‡∏ä‡πâ Web Notifications API ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö mobile
            if ('Notification' in window && Notification.permission === 'granted') {
                const options = {
                    body: message,
                    icon: getNotificationIcon(type),
                    badge: getNotificationBadge(),
                    tag: type + '_' + Date.now(),
                    requireInteraction: data.urgent || type === 'alarm',
                    vibrate: data.urgent ? [500, 200, 500] : [200, 100, 200],
                    silent: false,
                    data: {
                        url: window.location.href,
                        type: type,
                        ...data
                    },
                    actions: [
                        {
                            action: 'view',
                            title: '‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π'
                        },
                        {
                            action: 'dismiss',
                            title: '‡∏õ‡∏¥‡∏î'
                        }
                    ]
                };
                
                const notification = new Notification(title, options);
                
                notification.onclick = function(event) {
                    event.preventDefault();
                    window.focus();
                    notification.close();
                    openNotificationPanel();
                };
                
                // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á
                playNotificationSound(data.urgent ? 'urgent' : 'normal');
            }
        }
        
        async function sendCrossDeviceNotification(title, message, type = 'notification', data = {}) {
            // ‡∏™‡πà‡∏á notification ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
            try {
                const payload = {
                    action: 'send_notification',
                    title: title,
                    message: message,
                    type: type,
                    data: JSON.stringify(data),
                    sender_id: userId,
                    sender_name: userName,
                    device_id: deviceId,
                    timestamp: Date.now()
                };
                
                await callGoogleScript(payload);
                console.log('‚úÖ Cross-device notification sent');
            } catch (error) {
                console.error('‚ùå Could not send cross-device notification:', error);
            }
        }
        
        function saveNotificationForSync(title, message, type, data) {
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å notification ‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö sync ‡∏Å‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏∑‡πà‡∏ô
            const notification = {
                id: 'sync_notif_' + Date.now(),
                title: title,
                message: message,
                type: type,
                data: data,
                timestamp: Date.now(),
                synced: false
            };
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô local storage ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö sync ‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á
            const syncNotifications = JSON.parse(localStorage.getItem('syncNotifications') || '[]');
            syncNotifications.push(notification);
            localStorage.setItem('syncNotifications', JSON.stringify(syncNotifications));
        }
        
        function getNotificationIcon(type) {
            const icons = {
                alarm: 'data:image/svg+xml,' + encodeURIComponent(`
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="45" fill="#ef4444"/>
                        <text x="50" y="65" font-size="40" text-anchor="middle" fill="white">‚è∞</text>
                    </svg>
                `),
                broadcast: 'data:image/svg+xml,' + encodeURIComponent(`
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="45" fill="#8b5cf6"/>
                        <text x="50" y="65" font-size="40" text-anchor="middle" fill="white">üì¢</text>
                    </svg>
                `),
                default: 'data:image/svg+xml,' + encodeURIComponent(`
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="45" fill="#3b82f6"/>
                        <text x="50" y="65" font-size="40" text-anchor="middle" fill="white">üîî</text>
                    </svg>
                `)
            };
            
            return icons[type] || icons.default;
        }
        
        function getNotificationBadge() {
            return 'data:image/svg+xml,' + encodeURIComponent(`
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="50" fill="#FF3B30"/>
                    <text x="50" y="60" font-size="30" text-anchor="middle" fill="white">!</text>
                </svg>
            `);
        }
        
        function playNotificationSound(type = 'normal') {
            try {
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Web Audio API
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                if (type === 'urgent') {
                    // ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏î‡πà‡∏ß‡∏ô: ‡∏™‡∏π‡∏á‡πÅ‡∏•‡∏∞‡∏î‡∏±‡∏á
                    oscillator.frequency.setValueAtTime(1000, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(2000, audioContext.currentTime + 0.2);
                    
                    gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(0.5, audioContext.currentTime + 0.1);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                    
                    // ‡∏ó‡∏≥‡∏ã‡πâ‡∏≥ 3 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                    setTimeout(() => {
                        playNotificationSound('urgent');
                    }, 300);
                    setTimeout(() => {
                        playNotificationSound('urgent');
                    }, 600);
                } else {
                    // ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏õ‡∏Å‡∏ï‡∏¥
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.1);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                }
            } catch (e) {
                console.log("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏î‡πâ:", e);
            }
        }
        
        function vibrateDevice(pattern) {
            if (navigator.vibrate) {
                navigator.vibrate(pattern);
            }
        }
        
        // ============================================
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Alarms List
        // ============================================
        function updateAlarmsList() {
            const container = document.getElementById('alarmsList');
            
            if (alarms.length === 0) {
                container.innerHTML = `
                    <div class="bg-gradient-to-r from-gray-900 to-gray-800 rounded-2xl p-8 text-center border border-gray-700">
                        <i class="fas fa-clock text-4xl text-gray-500 mb-4"></i>
                        <p class="text-gray-400 text-lg mb-2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
                        <p class="text-gray-500">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</p>
                    </div>
                `;
                return;
            }
            
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤ (‡πÄ‡∏£‡πá‡∏ß‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô)
            alarms.sort((a, b) => new Date(a.datetime) - new Date(b.datetime));
            
            container.innerHTML = '';
            const now = new Date();
            
            alarms.forEach(alarm => {
                const alarmDate = new Date(alarm.datetime);
                const isPast = alarmDate < now;
                const isTriggered = alarm.triggered;
                
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠
                const timeDiff = alarmDate - now;
                const hoursDiff = Math.floor(timeDiff / (1000 * 60 * 60));
                const minutesDiff = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
                
                // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏ß‡∏•‡∏≤
                let timeStatus = '';
                let timeClass = '';
                
                if (isTriggered) {
                    timeStatus = '<span class="text-xs px-3 py-1 bg-green-900/30 text-green-300 rounded-full">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß</span>';
                    timeClass = 'opacity-70';
                } else if (isPast) {
                    timeStatus = '<span class="text-xs px-3 py-1 bg-gray-700 text-gray-300 rounded-full">‡πÄ‡∏•‡∏¢‡πÄ‡∏ß‡∏•‡∏≤</span>';
                    timeClass = 'opacity-50';
                } else if (hoursDiff < 1) {
                    timeStatus = `<span class="text-xs px-3 py-1 bg-red-900/30 text-red-300 rounded-full">${minutesDiff} ‡∏ô‡∏≤‡∏ó‡∏µ</span>`;
                } else if (hoursDiff < 24) {
                    timeStatus = `<span class="text-xs px-3 py-1 bg-yellow-900/30 text-yellow-300 rounded-full">${hoursDiff} ‡∏ä‡∏°.</span>`;
                } else {
                    const daysDiff = Math.floor(hoursDiff / 24);
                    timeStatus = `<span class="text-xs px-3 py-1 bg-blue-900/30 text-blue-300 rounded-full">${daysDiff} ‡∏ß‡∏±‡∏ô</span>`;
                }
                
                // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå
                let shareStatus = '';
                if (alarm.share === 'team') {
                    shareStatus = '<span class="text-xs px-3 py-1 bg-purple-900/30 text-purple-300 rounded-full"><i class="fas fa-users mr-1"></i>‡∏ó‡∏µ‡∏°</span>';
                } else if (alarm.share === 'public') {
                    shareStatus = '<span class="text-xs px-3 py-1 bg-indigo-900/30 text-indigo-300 rounded-full"><i class="fas fa-globe mr-1"></i>‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞</span>';
                }
                
                const alarmElement = document.createElement('div');
                alarmElement.className = `alarm-item bg-gradient-to-r from-gray-900 to-gray-800 rounded-2xl p-6 border border-gray-700 ${timeClass}`;
                alarmElement.innerHTML = `
                    <div class="flex flex-col md:flex-row justify-between items-start">
                        <div class="flex-1 mb-4 md:mb-0">
                            <div class="flex items-start mb-3">
                                <div class="w-10 h-10 rounded-xl ${isTriggered ? 'bg-green-900/30' : 'bg-blue-900/30'} flex items-center justify-center mr-4">
                                    <i class="fas ${isTriggered ? 'fa-check-circle' : 'fa-clock'} ${isTriggered ? 'text-green-400' : 'text-blue-400'}"></i>
                                </div>
                                <div class="flex-1">
                                    <h3 class="font-bold text-lg ${isTriggered ? 'text-gray-400' : 'text-white'}">${alarm.title}</h3>
                                    <p class="text-gray-400 text-sm mt-1">${alarm.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î'}</p>
                                    <div class="flex flex-wrap gap-2 mt-3">
                                        <span class="text-xs px-3 py-1 bg-blue-900/30 text-blue-300 rounded-full">
                                            <i class="far fa-clock mr-1"></i>
                                            ${alarmDate.toLocaleDateString('th-TH', {day: 'numeric', month: 'short'})} 
                                            ${alarmDate.toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'})}
                                        </span>
                                        <span class="text-xs px-3 py-1 bg-purple-900/30 text-purple-300 rounded-full">
                                            <i class="fas fa-redo mr-1"></i>${getRepeatText(alarm.repeat)}
                                        </span>
                                        ${shareStatus}
                                        ${timeStatus}
                                        ${alarm.synced ? '<span class="text-xs px-3 py-1 bg-green-900/30 text-green-300 rounded-full"><i class="fas fa-cloud mr-1"></i>‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÅ‡∏•‡πâ‡∏ß</span>' : ''}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col space-y-2">
                            ${!isTriggered ? `
                                <button onclick="testAlarm('${alarm.id}')" class="px-4 py-2 bg-gradient-to-r from-yellow-600 to-yellow-700 hover:from-yellow-700 hover:to-yellow-800 rounded-xl text-sm text-white font-medium transition-all">
                                    <i class="fas fa-bell mr-2"></i>‡∏ó‡∏î‡∏™‡∏≠‡∏ö
                                </button>
                            ` : ''}
                            <button onclick="deleteAlarm('${alarm.id}')" class="px-4 py-2 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 rounded-xl text-sm text-white font-medium transition-all">
                                <i class="fas fa-trash mr-2"></i>‡∏•‡∏ö
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(alarmElement);
            });
        }
        
        function loadAlarms() {
            loadAppData();
            showAlert('success', '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß');
        }
        
        async function deleteAlarm(alarmId) {
            const alarm = alarms.find(a => a.id === alarmId);
            if (!alarm) return;
            
            const result = await Swal.fire({
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö',
                html: `
                    <div class="text-left">
                        <p class="mb-3">‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô<br><strong>"${alarm.title}"</strong></p>
                        <div class="bg-gray-800 rounded-lg p-3 mb-3">
                            <p class="text-sm"><i class="fas fa-calendar mr-2"></i>${new Date(alarm.datetime).toLocaleDateString('th-TH')} ${new Date(alarm.datetime).toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'})}</p>
                            <p class="text-sm mt-1"><i class="fas fa-redo mr-2"></i>${getRepeatText(alarm.repeat)}</p>
                        </div>
                        <p class="text-xs text-gray-400">‡∏à‡∏∞‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏î‡πâ‡∏ß‡∏¢</p>
                    </div>
                `,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: '‡∏•‡∏ö',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                confirmButtonColor: '#ef4444',
                background: '#1f2937',
                color: '#e5e7eb'
            });
            
            if (!result.isConfirmed) return;
            
            // ‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
            if (alarm.synced) {
                const deleted = await deleteFromGoogleSheets(alarm.id);
                if (!deleted) {
                    showAlert('warning', '‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÅ‡∏ï‡πà‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß');
                } else {
                    showAlert('success', '‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß');
                }
            } else {
                showAlert('success', '‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå)');
            }
            
            // ‡∏•‡∏ö‡∏à‡∏≤‡∏Å localStorage
            alarms = alarms.filter(a => a.id !== alarmId);
            localStorage.setItem('alarms', JSON.stringify(alarms));
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
            updateAlarmsList();
            updateCounts();
        }
        
        function testAlarm(alarmId) {
            const alarm = alarms.find(a => a.id === alarmId);
            if (!alarm) return;
            
            // ‡πÅ‡∏™‡∏î‡∏á notification ‡∏ó‡∏î‡∏™‡∏≠‡∏ö
            showCrossDeviceNotification(
                `‡∏ó‡∏î‡∏™‡∏≠‡∏ö: ${alarm.title}`,
                alarm.description || '‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô',
                'test',
                { alarm_id: alarm.id, test: true }
            );
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô notifications
            addNotification({
                id: 'test_' + Date.now(),
                type: 'test',
                title: `‡∏ó‡∏î‡∏™‡∏≠‡∏ö: ${alarm.title}`,
                message: alarm.description || '‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô',
                time: new Date().toISOString(),
                read: false,
                device_id: deviceId,
                user_id: userId
            });
            
            showAlert('success', '‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß');
        }
        
        function testCrossDeviceNotification() {
            showCrossDeviceNotification(
                '‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á',
                '‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≤‡∏°‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°',
                'test',
                { test: true, cross_device: true }
            );
            
            addNotification({
                id: 'test_cross_' + Date.now(),
                type: 'test',
                title: '‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á',
                message: '‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á',
                time: new Date().toISOString(),
                read: false,
                device_id: deviceId,
                user_id: userId
            });
            
            showAlert('success', '‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß');
        }
        
        // ============================================
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Notifications
        // ============================================
        function addNotification(notification) {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ notification ‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            const exists = notifications.some(n => n.id === notification.id);
            if (exists) return;
            
            notifications.unshift(notification);
            
            // ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô notifications
            if (notifications.length > 100) {
                notifications = notifications.slice(0, 100);
            }
            
            localStorage.setItem('notifications', JSON.stringify(notifications));
            updateBadges();
            updateCounts();
            updateAppIconBadge();
        }
        
        function openNotificationPanel() {
            loadNotificationsList();
            document.getElementById('notificationsPanel').classList.add('active');
        }
        
        function closeNotificationPanel() {
            document.getElementById('notificationsPanel').classList.remove('active');
        }
        
        function loadNotificationsList() {
            const container = document.getElementById('notificationsList');
            const countElement = document.getElementById('notificationsCount');
            
            if (notifications.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-10">
                        <i class="fas fa-bell-slash text-4xl text-gray-500 mb-3"></i>
                        <p class="text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
                        <p class="text-gray-500 text-sm mt-2">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
                    </div>
                `;
                countElement.textContent = '0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£';
                return;
            }
            
            // ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏≠‡πà‡∏≤‡∏ô
            const unreadCount = notifications.filter(n => !n.read).length;
            countElement.textContent = `${notifications.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (${unreadCount} ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏≠‡πà‡∏≤‡∏ô)`;
            
            container.innerHTML = '';
            notifications.forEach(notification => {
                const time = new Date(notification.time);
                const isRead = notification.read;
                const type = notification.type;
                
                let icon = 'fa-bell';
                let iconColor = 'text-blue-400';
                let bgColor = 'bg-blue-900/20';
                
                if (type === 'alarm') {
                    icon = 'fa-clock';
                    iconColor = 'text-red-400';
                    bgColor = 'bg-red-900/20';
                } else if (type === 'broadcast') {
                    icon = 'fa-broadcast-tower';
                    iconColor = 'text-purple-400';
                    bgColor = 'bg-purple-900/20';
                } else if (type === 'test') {
                    icon = 'fa-vial';
                    iconColor = 'text-yellow-400';
                    bgColor = 'bg-yellow-900/20';
                }
                
                const notificationElement = document.createElement('div');
                notificationElement.className = `bg-gradient-to-r from-gray-900 to-gray-800 rounded-2xl p-5 mb-4 border border-gray-700 ${isRead ? 'opacity-70' : ''}`;
                notificationElement.innerHTML = `
                    <div class="flex items-start">
                        <div class="w-12 h-12 rounded-xl ${bgColor} flex items-center justify-center mr-4">
                            <i class="fas ${icon} ${iconColor} text-lg"></i>
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-bold ${isRead ? 'text-gray-400' : 'text-white'}">${notification.title}</h3>
                                ${!isRead ? '<span class="text-xs px-2 py-1 bg-blue-600 rounded-full text-white">‡πÉ‡∏´‡∏°‡πà</span>' : ''}
                            </div>
                            <p class="text-gray-300 text-sm mb-3">${notification.message}</p>
                            <div class="flex justify-between items-center">
                                <p class="text-gray-500 text-xs">
                                    <i class="far fa-clock mr-1"></i>
                                    ${time.toLocaleDateString('th-TH')} ${time.toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'})}
                                </p>
                                <div class="flex space-x-2">
                                    ${!isRead ? `
                                        <button onclick="markNotificationAsRead('${notification.id}')" class="text-xs px-3 py-1 bg-green-600 hover:bg-green-700 rounded-lg text-white">
                                            <i class="fas fa-check mr-1"></i>‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß
                                        </button>
                                    ` : ''}
                                    <button onclick="deleteNotification('${notification.id}')" class="text-xs px-3 py-1 bg-red-600 hover:bg-red-700 rounded-lg text-white">
                                        <i class="fas fa-trash mr-1"></i>‡∏•‡∏ö
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(notificationElement);
            });
        }
        
        function markNotificationAsRead(notificationId) {
            const notification = notifications.find(n => n.id === notificationId);
            if (notification) {
                notification.read = true;
                localStorage.setItem('notifications', JSON.stringify(notifications));
                loadNotificationsList();
                updateBadges();
                showAlert('success', '‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß');
            }
        }
        
        function markAllNotificationsAsRead() {
            notifications.forEach(notification => {
                notification.read = true;
            });
            localStorage.setItem('notifications', JSON.stringify(notifications));
            loadNotificationsList();
            updateBadges();
            showAlert('success', '‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß');
        }
        
        function deleteNotification(notificationId) {
            notifications = notifications.filter(n => n.id !== notificationId);
            localStorage.setItem('notifications', JSON.stringify(notifications));
            loadNotificationsList();
            updateBadges();
            updateCounts();
            showAlert('success', '‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß');
        }
        
        function clearAllNotifications() {
            const result = confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?');
            if (!result) return;
            
            notifications = [];
            localStorage.setItem('notifications', JSON.stringify(notifications));
            updateBadges();
            updateCounts();
            loadNotificationsList();
            
            showAlert('success', '‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß');
        }
        
        // ============================================
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Devices
        // ============================================
        async function getOnlineDevices() {
            try {
                const payload = {
                    action: 'get_devices',
                    user_id: userId,
                    device_id: deviceId,
                    timestamp: Date.now()
                };
                
                const result = await callGoogleScript(payload);
                
                if (result.status === 'success') {
                    devices = result.devices || [];
                    localStorage.setItem('devices', JSON.stringify(devices));
                    updateDeviceList();
                    updateCounts();
                }
            } catch (error) {
                console.log('‚ö†Ô∏è Could not get online devices:', error);
            }
        }
        
        function updateDeviceList() {
            const container = document.getElementById('deviceList');
            const countElement = document.getElementById('deviceCount');
            
            if (!container) return;
            
            // ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô device ‡∏ó‡∏µ‡πà online
            const onlineDevices = devices.filter(d => 
                d.status === 'online' && d.device_id !== deviceId
            );
            const totalDevices = devices.length;
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÉ‡∏ô badge
            countElement.textContent = onlineDevices.length;
            
            if (devices.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-sm text-center py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>';
                return;
            }
            
            container.innerHTML = '';
            
            // ‡πÅ‡∏™‡∏î‡∏á device ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô
            const myDevice = devices.find(d => d.device_id === deviceId) || {
                device_id: deviceId,
                user_name: userName,
                status: 'online',
                platform: platform.isMobile ? 'mobile' : 'desktop',
                last_seen: new Date().toISOString()
            };
            
            const myDeviceElement = document.createElement('div');
            myDeviceElement.className = 'device-item bg-gray-800/50 rounded-lg p-3 mb-2 online';
            myDeviceElement.innerHTML = `
                <div class="flex items-center">
                    <div class="w-3 h-3 rounded-full bg-green-500 mr-3"></div>
                    <div class="flex-1">
                        <div class="font-medium text-white text-sm">${myDevice.user_name} (‡∏â‡∏±‡∏ô)</div>
                        <div class="text-gray-400 text-xs">${getDeviceType(myDevice.platform)} ‚Ä¢ ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</div>
                    </div>
                    <i class="fas fa-user text-blue-400"></i>
                </div>
            `;
            container.appendChild(myDeviceElement);
            
            // ‡πÅ‡∏™‡∏î‡∏á devices ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
            devices.filter(d => d.device_id !== deviceId).forEach(device => {
                const status = device.status || 'offline';
                const time = new Date(device.last_seen);
                const timeDiff = Date.now() - time.getTime();
                const minutesDiff = Math.floor(timeDiff / (1000 * 60));
                
                let statusText = '‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå';
                let statusClass = 'online';
                
                if (status === 'away') {
                    statusText = '‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà';
                    statusClass = 'away';
                } else if (status === 'offline' || minutesDiff > 5) {
                    statusText = '‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå';
                    statusClass = 'offline';
                }
                
                const deviceElement = document.createElement('div');
                deviceElement.className = `device-item bg-gray-800/50 rounded-lg p-3 mb-2 ${statusClass}`;
                deviceElement.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-3 h-3 rounded-full ${status === 'online' ? 'bg-green-500' : status === 'away' ? 'bg-yellow-500' : 'bg-red-500'} mr-3"></div>
                        <div class="flex-1">
                            <div class="font-medium text-white text-sm">${device.user_name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</div>
                            <div class="text-gray-400 text-xs">${getDeviceType(device.platform)} ‚Ä¢ ${statusText}</div>
                        </div>
                        <div class="text-gray-500 text-xs">
                            ${minutesDiff < 1 ? '‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡∏ô‡∏µ‡πâ' : `${minutesDiff} ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß`}
                        </div>
                    </div>
                `;
                container.appendChild(deviceElement);
            });
        }
        
        function showActiveDevices() {
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• devices ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
            getOnlineDevices();
            
            // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÇ‡∏î‡∏¢ hover ‡∏ó‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏° devices
            // UI ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô tooltip ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡πâ‡∏ß
        }
        
        function getDeviceType(platform) {
            const types = {
                'mobile': '‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠',
                'desktop': '‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå',
                'windows': 'Windows',
                'mac': 'Mac',
                'linux': 'Linux',
                'chrome': 'Chrome',
                'firefox': 'Firefox',
                'safari': 'Safari',
                'edge': 'Edge'
            };
            return types[platform] || platform || '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå';
        }
        
        // ============================================
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï UI ‡πÅ‡∏•‡∏∞ Sync
        // ============================================
        function updateCounts() {
            // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô alarms ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            const totalAlarms = alarms.length;
            const activeAlarms = alarms.filter(a => !a.triggered).length;
            document.getElementById('alarmCount').textContent = totalAlarms;
            document.getElementById('activeAlarms').textContent = `${activeAlarms} ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô`;
            
            // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô devices
            const onlineDevices = devices.filter(d => d.status === 'online').length;
            const totalDevices = devices.length;
            document.getElementById('deviceOnlineCount').textContent = onlineDevices;
            document.getElementById('totalDevices').textContent = `${totalDevices} ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î`;
            
            // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô broadcasts
            const totalBroadcasts = broadcasts.length;
            const today = new Date().toDateString();
            const todayBroadcasts = broadcasts.filter(b => 
                new Date(b.time).toDateString() === today
            ).length;
            document.getElementById('broadcastCount').textContent = totalBroadcasts;
            document.getElementById('todayBroadcasts').textContent = `${todayBroadcasts} ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ`;
            
            // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô notifications
            const totalNotifications = notifications.length;
            const unreadNotifications = notifications.filter(n => !n.read).length;
            document.getElementById('notificationCount').textContent = totalNotifications;
            document.getElementById('unreadNotifications').textContent = `${unreadNotifications} ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏≠‡πà‡∏≤‡∏ô`;
        }
        
        function updateBadges() {
            const unreadCount = notifications.filter(n => !n.read).length;
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏∏‡∏Å badge
            const badgeIds = ['headerBadge', 'actionBadge', 'bottomBadge'];
            badgeIds.forEach(badgeId => {
                const badge = document.getElementById(badgeId);
                if (unreadCount > 0) {
                    badge.textContent = unreadCount > 99 ? '99+' : unreadCount;
                    badge.style.display = 'flex';
                } else {
                    badge.style.display = 'none';
                }
            });
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï app icon badge
            updateAppIconBadge();
        }
        
        function updateAppIconBadge() {
            const unreadCount = notifications.filter(n => !n.read).length;
            const appIconBadge = document.getElementById('appIconBadge');
            
            if (unreadCount > 0) {
                appIconBadge.textContent = unreadCount > 99 ? '99+' : unreadCount;
                appIconBadge.style.display = 'flex';
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï title ‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
                document.title = `(${unreadCount}) ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á`;
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Badge API (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                if ('setAppBadge' in navigator) {
                    navigator.setAppBadge(unreadCount);
                }
            } else {
                appIconBadge.style.display = 'none';
                document.title = '‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á';
                
                if ('clearAppBadge' in navigator) {
                    navigator.clearAppBadge();
                }
            }
        }
        
        function updateConnectionStatus(status = 'online', message = '') {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            const connectionMessage = document.getElementById('connectionMessage');
            const connectionBar = document.getElementById('connectionBar');
            const indicator = document.getElementById('connectionIndicator');
            
            let dotClass = '';
            let textClass = '';
            let barClass = '';
            let indicatorClass = '';
            let defaultMessage = '';
            
            switch (status) {
                case 'online':
                    dotClass = 'bg-green-500 animate-pulse';
                    textClass = 'online';
                    barClass = 'bg-gradient-to-r from-green-500 to-blue-500';
                    indicatorClass = 'bg-green-500';
                    defaultMessage = '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
                    break;
                case 'warning':
                    dotClass = 'bg-yellow-500 animate-pulse';
                    textClass = 'warning';
                    barClass = 'bg-gradient-to-r from-yellow-500 to-orange-500';
                    indicatorClass = 'bg-yellow-500';
                    defaultMessage = '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô';
                    break;
                case 'offline':
                    dotClass = 'bg-red-500';
                    textClass = 'offline';
                    barClass = 'bg-gradient-to-r from-red-500 to-pink-500';
                    indicatorClass = 'bg-red-500';
                    defaultMessage = '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
                    break;
                case 'connecting':
                    dotClass = 'bg-blue-500 animate-pulse';
                    textClass = 'connecting';
                    barClass = 'bg-gradient-to-r from-blue-500 to-purple-500 animate-pulse';
                    indicatorClass = 'bg-blue-500';
                    defaultMessage = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå...';
                    break;
            }
            
            statusDot.className = `w-3 h-3 rounded-full mr-2 ${dotClass}`;
            statusText.className = `text-sm ${textClass}`;
            statusText.textContent = defaultMessage;
            connectionBar.className = `connection-bar ${barClass}`;
            indicator.className = `absolute -bottom-1 -right-1 w-4 h-4 rounded-full border-2 border-gray-900 ${indicatorClass}`;
            
            if (message) {
                connectionMessage.textContent = message;
            } else {
                connectionMessage.textContent = defaultMessage;
            }
            
            // ‡πÅ‡∏™‡∏î‡∏á connection bar
            connectionBar.classList.add('show');
            setTimeout(() => {
                connectionBar.classList.remove('show');
            }, 3000);
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï sync status
            document.getElementById('syncStatus').textContent = 
                status === 'online' ? '‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢' : 
                status === 'warning' ? '‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô' : 
                '‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
        }
        
        async function syncAllData() {
            if (!isOnline) {
                updateConnectionStatus('offline', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå');
                return;
            }
            
            updateConnectionStatus('connecting', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');
            
            try {
                // Sync ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                await Promise.all([
                    syncAlarmsFromServer(),
                    syncBroadcastsFromServer(),
                    getOnlineDevices(),
                    testConnection()
                ]);
                
                lastSync = Date.now();
                updateConnectionStatus('online', '‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                
                // ‡πÅ‡∏™‡∏î‡∏á notification ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
                const newNotifications = notifications.filter(n => !n.read).length;
                if (newNotifications > 0) {
                    showAlert('info', `‡∏°‡∏µ ${newNotifications} ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà`);
                }
                
            } catch (error) {
                console.error('Sync error:', error);
                updateConnectionStatus('warning', '‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô');
            }
        }
        
        async function syncAlarmsFromServer() {
            try {
                const payload = {
                    action: 'sync_alarms',
                    user_id: userId,
                    device_id: deviceId,
                    last_sync: localStorage.getItem('lastAlarmSync') || 0,
                    timestamp: Date.now()
                };
                
                const result = await callGoogleScript(payload);
                
                if (result.status === 'success' && result.alarms && result.alarms.length > 0) {
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏° alarms ‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå
                    result.alarms.forEach(serverAlarm => {
                        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ alarm ‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
                        if (!alarms.some(a => a.id === serverAlarm.id)) {
                            alarms.push({
                                ...serverAlarm,
                                synced: true
                            });
                        }
                    });
                    
                    localStorage.setItem('alarms', JSON.stringify(alarms));
                    localStorage.setItem('lastAlarmSync', Date.now());
                    
                    updateAlarmsList();
                    updateCounts();
                    
                    console.log(`‚úÖ Synced ${result.alarms.length} alarms from server`);
                }
            } catch (error) {
                console.log('‚ö†Ô∏è Sync alarms failed:', error);
            }
        }
        
        async function syncBroadcastsFromServer() {
            try {
                const payload = {
                    action: 'sync_broadcasts',
                    user_id: userId,
                    device_id: deviceId,
                    last_sync: localStorage.getItem('lastBroadcastSync') || 0,
                    timestamp: Date.now()
                };
                
                const result = await callGoogleScript(payload);
                
                if (result.status === 'success' && result.broadcasts && result.broadcasts.length > 0) {
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏° broadcasts ‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå
                    result.broadcasts.forEach(serverBroadcast => {
                        if (!broadcasts.some(b => b.id === serverBroadcast.id)) {
                            broadcasts.unshift(serverBroadcast);
                        }
                    });
                    
                    localStorage.setItem('broadcasts', JSON.stringify(broadcasts));
                    localStorage.setItem('lastBroadcastSync', Date.now());
                    
                    updateRecentBroadcasts();
                    updateCounts();
                    
                    console.log(`‚úÖ Synced ${result.broadcasts.length} broadcasts from server`);
                }
            } catch (error) {
                console.log('‚ö†Ô∏è Sync broadcasts failed:', error);
            }
        }
        
        function refreshAllData() {
            const refreshBtn = document.getElementById('refreshBtn');
            refreshBtn.classList.add('animate-spin');
            
            syncAllData();
            
            setTimeout(() => {
                refreshBtn.classList.remove('animate-spin');
            }, 1000);
        }
        
        // ============================================
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠
        // ============================================
        function getRepeatText(repeat) {
            const texts = {
                'none': '‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏ã‡πâ‡∏≥',
                'daily': '‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô',
                'weekly': '‡∏ó‡∏∏‡∏Å‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå',
                'monthly': '‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'
            };
            return texts[repeat] || repeat;
        }
        
        function showAlert(icon, title) {
            Swal.fire({
                icon: icon,
                title: title,
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                background: '#1f2937',
                color: '#e5e7eb'
            });
        }
        
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function scrollToForm() {
            document.getElementById('alarmFormSection').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }
        
        function scrollToBroadcast() {
            document.getElementById('broadcastSection').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }
        
        function showSettings() {
            Swal.fire({
                title: '‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö',
                html: `
                    <div class="text-left space-y-4">
                        <div>
                            <label class="block text-gray-400 text-sm mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                            <input type="text" id="settingsUserName" class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg" value="${userName}">
                        </div>
                        <div>
                            <label class="block text-gray-400 text-sm mb-2">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="checkbox" id="settingsNotificationSound" class="mr-2" checked>
                                    <span>‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="settingsNotificationVibrate" class="mr-2" ${platform.isMobile ? 'checked' : ''}>
                                    <span>‡∏™‡∏±‡πà‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="settingsNotificationPopup" class="mr-2" checked>
                                    <span>‡∏õ‡πä‡∏≠‡∏õ‡∏≠‡∏±‡∏û‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</span>
                                </label>
                            </div>
                        </div>
                        <div>
                            <label class="block text-gray-400 text-sm mb-2">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡∏¥‡∏á‡∏Ñ‡πå</label>
                            <select id="settingsSyncInterval" class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg">
                                <option value="10">‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</option>
                                <option value="30" selected>‡∏ó‡∏∏‡∏Å 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</option>
                                <option value="60">‡∏ó‡∏∏‡∏Å 1 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
                                <option value="300">‡∏ó‡∏∏‡∏Å 5 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
                            </select>
                        </div>
                        <div class="pt-4 border-t border-gray-700">
                            <button onclick="exportData()" class="w-full py-3 bg-gradient-to-r from-green-600 to-green-700 rounded-lg mb-2">
                                <i class="fas fa-download mr-2"></i>‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                            </button>
                            <button onclick="importData()" class="w-full py-3 bg-gradient-to-r from-blue-600 to-blue-700 rounded-lg mb-2">
                                <i class="fas fa-upload mr-2"></i>‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                            </button>
                            <button onclick="clearAllData()" class="w-full py-3 bg-gradient-to-r from-red-600 to-red-700 rounded-lg">
                                <i class="fas fa-trash mr-2"></i>‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                            </button>
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                background: '#1f2937',
                color: '#e5e7eb',
                width: '500px'
            }).then((result) => {
                if (result.isConfirmed) {
                    const newUserName = document.getElementById('settingsUserName').value;
                    if (newUserName && newUserName !== userName) {
                        userName = newUserName;
                        localStorage.setItem('userName', userName);
                        document.getElementById('userName').textContent = userName;
                        showAlert('success', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß');
                    }
                }
            });
        }
        
        function exportData() {
            const data = {
                alarms: alarms,
                notifications: notifications,
                broadcasts: broadcasts,
                user: {
                    id: userId,
                    name: userName,
                    device_id: deviceId
                },
                export_date: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `notification-system-backup-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showAlert('success', '‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        }
        
        function importData() {
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á input element ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = event => {
                    try {
                        const data = JSON.parse(event.target.result);
                        
                        Swal.fire({
                            title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                            html: `
                                <div class="text-left">
                                    <p class="mb-3">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå?</p>
                                    <div class="bg-gray-800 rounded-lg p-3 mb-3">
                                        <p class="text-sm"><i class="fas fa-bell mr-2"></i>${data.alarms?.length || 0} ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
                                        <p class="text-sm"><i class="fas fa-broadcast-tower mr-2"></i>${data.broadcasts?.length || 0} ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</p>
                                        <p class="text-sm"><i class="fas fa-history mr-2"></i>${data.notifications?.length || 0} ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</p>
                                    </div>
                                    <p class="text-xs text-gray-400">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ó‡∏±‡∏ö‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</p>
                                </div>
                            `,
                            icon: 'warning',
                            showCancelButton: true,
                            confirmButtonText: '‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤',
                            cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                            background: '#1f2937',
                            color: '#e5e7eb'
                        }).then((result) => {
                            if (result.isConfirmed) {
                                // ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                                if (data.alarms) alarms = data.alarms;
                                if (data.notifications) notifications = data.notifications;
                                if (data.broadcasts) broadcasts = data.broadcasts;
                                
                                localStorage.setItem('alarms', JSON.stringify(alarms));
                                localStorage.setItem('notifications', JSON.stringify(notifications));
                                localStorage.setItem('broadcasts', JSON.stringify(broadcasts));
                                
                                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
                                updateAlarmsList();
                                updateRecentBroadcasts();
                                updateCounts();
                                updateBadges();
                                
                                showAlert('success', '‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                            }
                        });
                    } catch (error) {
                        showAlert('error', '‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        function clearAllData() {
            Swal.fire({
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
                text: '‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: '‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                confirmButtonColor: '#ef4444',
                background: '#1f2937',
                color: '#e5e7eb'
            }).then((result) => {
                if (result.isConfirmed) {
                    // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                    alarms = [];
                    notifications = [];
                    broadcasts = [];
                    
                    localStorage.removeItem('alarms');
                    localStorage.removeItem('notifications');
                    localStorage.removeItem('broadcasts');
                    
                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
                    updateAlarmsList();
                    updateRecentBroadcasts();
                    updateCounts();
                    updateBadges();
                    
                    showAlert('success', '‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                }
            });
        }
        
        function exportAlarms() {
            if (alarms.length === 0) {
                showAlert('info', '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å');
                return;
            }
            
            const data = alarms.map(alarm => ({
                Title: alarm.title,
                Description: alarm.description,
                Date: alarm.date,
                Time: alarm.time,
                Repeat: getRepeatText(alarm.repeat),
                Status: alarm.triggered ? 'Triggered' : 'Pending',
                Created: new Date(alarm.created_at).toLocaleString('th-TH')
            }));
            
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Title,Description,Date,Time,Repeat,Status,Created\n";
            
            data.forEach(row => {
                const rowData = [
                    `"${row.Title}"`,
                    `"${row.Description}"`,
                    row.Date,
                    row.Time,
                    row.Repeat,
                    row.Status,
                    `"${row.Created}"`
                ];
                csvContent += rowData.join(",") + "\n";
            });
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `alarms-${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showAlert('success', '‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        }
        
        // ============================================
        // PWA Installation
        // ============================================
        function checkAppInstallation() {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô PWA ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (window.matchMedia('(display-mode: standalone)').matches) {
                isAppInstalled = true;
                console.log('üì± ‡πÅ‡∏≠‡∏õ‡∏ñ‡∏π‡∏Å‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß (Standalone Mode)');
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï
            window.addEventListener('appinstalled', (event) => {
                isAppInstalled = true;
                console.log('‚úÖ ‡πÅ‡∏≠‡∏õ‡∏ñ‡∏π‡∏Å‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß');
                document.getElementById('installPrompt').style.display = 'none';
                showAlert('success', '‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß');
            });
            
            // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ
            window.addEventListener('beforeinstallprompt', (event) => {
                event.preventDefault();
                deferredPrompt = event;
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á
                if (!isAppInstalled) {
                    setTimeout(() => {
                        document.getElementById('installPrompt').style.display = 'block';
                    }, 5000);
                }
            });
        }
        
        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('‚úÖ ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ');
                        isAppInstalled = true;
                        showAlert('success', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô...');
                    } else {
                        console.log('‚ùå ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ');
                    }
                    deferredPrompt = null;
                });
            } else {
                showAlert('info', '‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ');
            }
        }
        
        function dismissInstallPrompt() {
            document.getElementById('installPrompt').style.display = 'none';
        }
        
        // ============================================
        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô
        // ============================================
        document.addEventListener('DOMContentLoaded', initApp);
        
        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏õ
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'visible') {
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏õ
                updateBadges();
                updateAppIconBadge();
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï device status
                updateDeviceStatus('online');
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÉ‡∏´‡∏°‡πà
                checkForNewBroadcasts();
                
                // Sync ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                syncAllData();
            }
        });
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏¢‡∏∞
        setInterval(() => {
            if (document.visibilityState === 'visible') {
                updateBadges();
                updateAppIconBadge();
                updateDeviceList();
            }
        }, 30000); // ‡∏ó‡∏∏‡∏Å 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏¢‡∏∞
        setInterval(() => {
            const wasOnline = isOnline;
            isOnline = navigator.onLine;
            
            if (wasOnline && !isOnline) {
                updateConnectionStatus('offline', '‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï');
            } else if (!wasOnline && isOnline) {
                updateConnectionStatus('connecting', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï...');
                setTimeout(() => syncAllData(), 1000);
            }
        }, 10000); // ‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        
        // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
        window.addEventListener('beforeunload', function(e) {
            const hasUnsavedAlarms = alarms.some(alarm => !alarm.synced);
            const hasUnsavedNotifications = notifications.some(notif => !notif.read);
            
            if (hasUnsavedAlarms || hasUnsavedNotifications) {
                e.preventDefault();
                e.returnValue = '‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?';
                return e.returnValue;
            }
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + S: Save/Sync
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                refreshAllData();
            }
            
            // Ctrl/Cmd + N: New Alarm
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                scrollToForm();
                document.getElementById('alarmTitle').focus();
            }
            
            // Ctrl/Cmd + B: Broadcast
            if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
                e.preventDefault();
                scrollToBroadcast();
                document.getElementById('broadcastTitle').focus();
            }
            
            // Ctrl/Cmd + L: Notification Panel
            if ((e.ctrlKey || e.metaKey) && e.key === 'l') {
                e.preventDefault();
                openNotificationPanel();
            }
            
            // Escape: Close panels
            if (e.key === 'Escape') {
                closeNotificationPanel();
                closeDesktopNotification();
            }
            
            // F5: Refresh
            if (e.key === 'F5') {
                e.preventDefault();
                refreshAllData();
            }
        });
        
        console.log('üéâ Notification System initialized successfully!');
    </script>
</body>
</html>
