<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏£‡∏ß‡∏°‡∏®‡∏π‡∏ô‡∏¢‡πå</title>
    <meta name="theme-color" content="#121826">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="/manifest.json">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        body {
            background-color: #121826;
            color: #e5e7eb;
            font-family: 'Sarabun', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Prompt', sans-serif;
        }
        
        /* Mobile app style containers */
        .app-container {
            max-width: 480px;
            margin: 0 auto;
            background: #121826;
            min-height: 100vh;
            position: relative;
        }
        
        /* iOS-style notifications */
        .ios-notification {
            background: rgba(40, 40, 40, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 14px;
            padding: 16px;
            margin: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .ios-notification::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3B82F6, #8B5CF6);
        }
        
        /* iOS-style buttons */
        .ios-btn {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px 20px;
            border: none;
            color: white;
            font-weight: 500;
            transition: all 0.2s;
            backdrop-filter: blur(10px);
        }
        
        .ios-btn:active {
            transform: scale(0.98);
            background: rgba(255, 255, 255, 0.2);
        }
        
        .ios-btn-primary {
            background: linear-gradient(135deg, #3B82F6, #1D4ED8);
        }
        
        /* Floating notification panel */
        .notification-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
        }
        
        .notification-panel.active {
            transform: translateY(0);
        }
        
        /* Message bubbles */
        .message-bubble {
            background: linear-gradient(135deg, #3B82F6, #8B5CF6);
            color: white;
            border-radius: 18px;
            border-bottom-right-radius: 4px;
            padding: 12px 16px;
            max-width: 80%;
            margin: 8px 0;
            animation: fadeInUp 0.3s ease-out;
        }
        
        .message-bubble-incoming {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 18px;
            border-bottom-left-radius: 4px;
        }
        
        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Status indicators */
        .status-connected { color: #10b981; }
        .status-disconnected { color: #ef4444; }
        .status-connecting { color: #f59e0b; }
        
        /* Notification badge */
        .notification-badge {
            background-color: #FF3B30;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 12px;
            font-weight: bold;
            position: absolute;
            top: -5px;
            right: -5px;
            min-width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Mobile navigation */
        .mobile-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(30, 30, 40, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: 12px 0;
            z-index: 50;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #9ca3af;
            transition: all 0.2s;
        }
        
        .nav-item.active {
            color: #3B82F6;
        }
        
        .nav-item:active {
            transform: scale(0.95);
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }
        
        /* Swipe to refresh */
        .pull-to-refresh {
            text-align: center;
            padding: 20px;
            color: #9ca3af;
        }
        
        /* iOS-style switches */
        .ios-switch {
            position: relative;
            display: inline-block;
            width: 52px;
            height: 32px;
        }
        
        .ios-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .ios-switch-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #4b5563;
            transition: .4s;
            border-radius: 34px;
        }
        
        .ios-switch-slider:before {
            position: absolute;
            content: "";
            height: 24px;
            width: 24px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .ios-switch-slider {
            background-color: #3B82F6;
        }
        
        input:checked + .ios-switch-slider:before {
            transform: translateX(20px);
        }
        
        /* Vibration effect */
        @keyframes vibrate {
            0% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            50% { transform: translateX(2px); }
            75% { transform: translateX(-2px); }
            100% { transform: translateX(0); }
        }
        
        .vibrate {
            animation: vibrate 0.3s linear;
        }
        
        /* Mobile app launch animation */
        .app-launch {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #121826, #1f2937);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.5s ease-out;
        }
        
        .app-icon-large {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- App Launch Screen -->
    <div id="appLaunch" class="app-launch">
        <div class="app-icon-large">
            <i class="fas fa-bell"></i>
        </div>
        <h1 class="text-2xl font-bold mt-4 mb-2">‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏£‡∏ß‡∏°‡∏®‡∏π‡∏ô‡∏¢‡πå</h1>
        <p class="text-gray-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
        <div class="mt-8 w-48 h-1 bg-gray-700 rounded-full overflow-hidden">
            <div id="loadingBar" class="h-full bg-blue-500" style="width: 0%"></div>
        </div>
    </div>
    
    <!-- iOS Style Push Notification -->
    <div id="pushNotification" class="fixed top-4 left-4 right-4 z-50 ios-notification hidden" style="transform: translateY(-100%); transition: transform 0.3s ease-out">
        <div class="flex items-start">
            <div class="flex-shrink-0 mr-3">
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center">
                    <i class="fas fa-bell text-white"></i>
                </div>
            </div>
            <div class="flex-1">
                <div class="flex justify-between items-start">
                    <h3 id="pushTitle" class="font-bold text-white">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
                    <span id="pushTime" class="text-xs text-gray-400">‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</span>
                </div>
                <p id="pushMessage" class="text-gray-300 text-sm mt-1">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
            </div>
            <button onclick="closePushNotification()" class="ml-2 text-gray-400 hover:text-white">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="mt-3 flex space-x-2">
            <button onclick="action1()" class="flex-1 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm">
                ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
            </button>
            <button onclick="closePushNotification()" class="flex-1 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm">
                ‡∏õ‡∏¥‡∏î
            </button>
        </div>
    </div>
    
    <!-- Notification Panel -->
    <div id="notificationPanel" class="notification-panel">
        <div class="p-4 border-b border-gray-800">
            <div class="flex items-center justify-between">
                <h2 class="text-xl font-bold">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h2>
                <button onclick="closeNotificationPanel()" class="p-2 rounded-full bg-gray-800">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div id="notificationList" class="flex-1 overflow-y-auto p-4">
            <!-- Notifications will be loaded here -->
        </div>
    </div>
    
    <!-- Main App Container -->
    <div class="app-container pb-20">
        <!-- Header -->
        <div class="sticky top-0 z-30 bg-gray-900/95 backdrop-blur-lg border-b border-gray-800">
            <div class="flex items-center justify-between p-4">
                <div class="flex items-center">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center mr-3">
                        <i class="fas fa-bell text-white"></i>
                    </div>
                    <div>
                        <h1 class="font-bold text-lg">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h1>
                        <div class="flex items-center">
                            <div id="statusDot" class="w-2 h-2 rounded-full bg-green-500 mr-2"></div>
                            <span id="statusText" class="text-xs text-gray-400">‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</span>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button onclick="openNotificationPanel()" class="relative">
                        <i class="fas fa-bell text-xl text-gray-300"></i>
                        <div id="headerBadge" class="notification-badge hidden">0</div>
                    </button>
                    <button onclick="refreshData()" class="p-2 rounded-full bg-gray-800">
                        <i class="fas fa-sync-alt text-gray-300"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Current Time Display -->
        <div class="p-4">
            <div class="ios-notification">
                <div class="text-center">
                    <div id="currentTime" class="text-3xl font-bold mb-2">--:--:--</div>
                    <div id="currentDate" class="text-gray-400">-</div>
                    <div class="mt-4 flex justify-between items-center">
                        <div class="text-left">
                            <div class="text-sm text-gray-400">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</div>
                            <div id="nextAlarmTime" class="font-medium">‡πÑ‡∏°‡πà‡∏°‡∏µ</div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm text-gray-400">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                            <div id="totalAlarms" class="font-medium">0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="px-4 mb-4">
            <h2 class="text-lg font-bold mb-3">‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡πà‡∏ß‡∏ô</h2>
            <div class="grid grid-cols-2 gap-3">
                <button onclick="scrollToForm()" class="ios-btn flex flex-col items-center p-4">
                    <i class="fas fa-plus-circle text-blue-400 text-2xl mb-2"></i>
                    <span class="text-sm font-medium">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</span>
                </button>
                <button onclick="openNotificationPanel()" class="ios-btn flex flex-col items-center p-4">
                    <i class="fas fa-bell text-yellow-400 text-2xl mb-2"></i>
                    <span class="text-sm font-medium">‡∏î‡∏π‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</span>
                    <div id="quickBadge" class="notification-badge hidden">0</div>
                </button>
                <button onclick="scrollToBroadcast()" class="ios-btn flex flex-col items-center p-4">
                    <i class="fas fa-broadcast-tower text-purple-400 text-2xl mb-2"></i>
                    <span class="text-sm font-medium">‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</span>
                </button>
                <button onclick="testPushNotification()" class="ios-btn flex flex-col items-center p-4">
                    <i class="fas fa-vibrate text-green-400 text-2xl mb-2"></i>
                    <span class="text-sm font-medium">‡∏ó‡∏î‡∏™‡∏≠‡∏ö</span>
                </button>
            </div>
        </div>
        
        <!-- Recent Alarms -->
        <div class="px-4 mb-6">
            <div class="flex justify-between items-center mb-3">
                <h2 class="text-lg font-bold">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h2>
                <button onclick="scrollToAlarms()" class="text-blue-400 text-sm">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
            </div>
            <div id="recentAlarms" class="space-y-3">
                <!-- Recent alarms will be loaded here -->
            </div>
        </div>
        
        <!-- Add Alarm Form -->
        <div id="addAlarmSection" class="p-4 bg-gray-900 mx-4 rounded-2xl mb-6">
            <h2 class="text-lg font-bold mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà</h2>
            <form id="alarmForm" class="space-y-4">
                <div>
                    <label class="block text-gray-400 text-sm mb-2">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</label>
                    <input 
                        type="text" 
                        id="title" 
                        class="w-full p-3 bg-gray-800 border border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏ó‡∏µ‡∏°, ‡∏ô‡∏±‡∏î‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå"
                        required
                    >
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-400 text-sm mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                        <input 
                            type="date" 
                            id="date" 
                            class="w-full p-3 bg-gray-800 border border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            required
                        >
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm mb-2">‡πÄ‡∏ß‡∏•‡∏≤</label>
                        <input 
                            type="time" 
                            id="time" 
                            class="w-full p-3 bg-gray-800 border border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            required
                        >
                    </div>
                </div>
                
                <div>
                    <label class="block text-gray-400 text-sm mb-2">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                    <textarea 
                        id="description" 
                        rows="2"
                        class="w-full p-3 bg-gray-800 border border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô"
                    ></textarea>
                </div>
                
                <div>
                    <label class="block text-gray-400 text-sm mb-3">‡∏ó‡∏≥‡∏ã‡πâ‡∏≥</label>
                    <div class="flex flex-wrap gap-2">
                        <button type="button" onclick="setRepeat('none')" class="px-4 py-2 bg-gray-800 rounded-lg text-sm" id="repeatNone">‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏ã‡πâ‡∏≥</button>
                        <button type="button" onclick="setRepeat('daily')" class="px-4 py-2 bg-gray-800 rounded-lg text-sm" id="repeatDaily">‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô</button>
                        <button type="button" onclick="setRepeat('weekly')" class="px-4 py-2 bg-gray-800 rounded-lg text-sm" id="repeatWeekly">‡∏ó‡∏∏‡∏Å‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</button>
                        <button type="button" onclick="setRepeat('monthly')" class="px-4 py-2 bg-gray-800 rounded-lg text-sm" id="repeatMonthly">‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
                    </div>
                </div>
                
                <div class="pt-4">
                    <button type="submit" class="w-full ios-btn ios-btn-primary py-3 rounded-xl">
                        <i class="fas fa-plus-circle mr-2"></i>‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                    </button>
                </div>
            </form>
        </div>
        
        <!-- All Alarms Section -->
        <div id="allAlarmsSection" class="px-4 mb-6">
            <h2 class="text-lg font-bold mb-3">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
            <div id="allAlarms" class="space-y-3">
                <!-- All alarms will be loaded here -->
            </div>
        </div>
        
        <!-- Broadcast Section -->
        <div id="broadcastSection" class="p-4 bg-purple-900/30 mx-4 rounded-2xl mb-6">
            <h2 class="text-lg font-bold mb-4 text-purple-300">
                <i class="fas fa-broadcast-tower mr-2"></i>‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏î‡πà‡∏ß‡∏ô
            </h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-gray-400 text-sm mb-2">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</label>
                    <input 
                        type="text" 
                        id="broadcastTitle" 
                        class="w-full p-3 bg-gray-800 border border-gray-700 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                        placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏î‡πà‡∏ß‡∏ô, ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß"
                    >
                </div>
                <div>
                    <label class="block text-gray-400 text-sm mb-2">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</label>
                    <textarea 
                        id="broadcastMessage" 
                        rows="2"
                        class="w-full p-3 bg-gray-800 border border-gray-700 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                        placeholder="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏î‡πà‡∏ß‡∏ô"
                    ></textarea>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="sendBroadcast()" class="ios-btn bg-purple-600 hover:bg-purple-700">
                        <i class="fas fa-paper-plane mr-2"></i>‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®
                    </button>
                    <button onclick="clearBroadcastForm()" class="ios-btn bg-gray-800 hover:bg-gray-700">
                        <i class="fas fa-trash mr-2"></i>‡∏•‡πâ‡∏≤‡∏á
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Settings -->
        <div class="p-4 mb-24">
            <h2 class="text-lg font-bold mb-4">‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h2>
            <div class="space-y-4">
                <div class="ios-notification">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h3 class="font-bold">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö Push</h3>
                            <p class="text-sm text-gray-400">‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö Mobile App</p>
                        </div>
                        <label class="ios-switch">
                            <input type="checkbox" id="pushToggle" checked>
                            <span class="ios-switch-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h3 class="font-bold">‡∏™‡∏±‡πà‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
                            <p class="text-sm text-gray-400">‡∏™‡∏±‡πà‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
                        </div>
                        <label class="ios-switch">
                            <input type="checkbox" id="vibrationToggle" checked>
                            <span class="ios-switch-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-bold">‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
                            <p class="text-sm text-gray-400">‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
                        </div>
                        <label class="ios-switch">
                            <input type="checkbox" id="soundToggle" checked>
                            <span class="ios-switch-slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="ios-notification">
                    <div class="space-y-3">
                        <button onclick="requestNotificationPermission()" class="w-full ios-btn">
                            <i class="fas fa-bell mr-2"></i>‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                        </button>
                        <button onclick="installPWA()" class="w-full ios-btn">
                            <i class="fas fa-download mr-2"></i>‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏≠‡∏õ
                        </button>
                        <button onclick="clearAllAlarms()" class="w-full ios-btn bg-red-900/30 hover:bg-red-800/50">
                            <i class="fas fa-trash mr-2"></i>‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Mobile Navigation -->
        <div class="mobile-nav">
            <div class="flex justify-around">
                <button onclick="scrollToTop()" class="nav-item">
                    <i class="fas fa-home text-xl mb-1"></i>
                    <span class="text-xs">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</span>
                </button>
                <button onclick="scrollToForm()" class="nav-item">
                    <i class="fas fa-plus text-xl mb-1"></i>
                    <span class="text-xs">‡πÄ‡∏û‡∏¥‡πà‡∏°</span>
                </button>
                <button onclick="openNotificationPanel()" class="nav-item relative">
                    <i class="fas fa-bell text-xl mb-1"></i>
                    <span class="text-xs">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</span>
                    <div id="navBadge" class="notification-badge hidden">0</div>
                </button>
                <button onclick="scrollToBroadcast()" class="nav-item">
                    <i class="fas fa-broadcast-tower text-xl mb-1"></i>
                    <span class="text-xs">‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</span>
                </button>
                <button onclick="scrollToSettings()" class="nav-item">
                    <i class="fas fa-cog text-xl mb-1"></i>
                    <span class="text-xs">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
    
    <!-- Main Application Script -->
    <script>
        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwpOYJ_pB6Llu9bd7RJABMd0awxu09oVFPB1cK4zsq3-aBYze5EpSHTSGgO1EcSJ3DwpQ/exec";
        let alarms = JSON.parse(localStorage.getItem('alarms')) || [];
        let notifications = JSON.parse(localStorage.getItem('notifications')) || [];
        let userId = localStorage.getItem('userId') || 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        let settings = JSON.parse(localStorage.getItem('notificationSettings')) || {
            pushEnabled: true,
            vibrationEnabled: true,
            soundEnabled: true,
            notificationPermission: 'default'
        };
        
        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏≠‡∏õ
        async function initApp() {
            console.log('üöÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô Mobile App...');
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            if (!localStorage.getItem('userId')) {
                localStorage.setItem('userId', userId);
            }
            localStorage.setItem('notificationSettings', JSON.stringify(settings));
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').min = today;
            document.getElementById('date').value = today;
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤)
            const nextHour = new Date();
            nextHour.setHours(nextHour.getHours() + 1);
            document.getElementById('time').value = `${nextHour.getHours().toString().padStart(2, '0')}:00`;
            
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            updateCurrentTime();
            loadAlarms();
            loadNotifications();
            updateBadges();
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå
            setInterval(updateCurrentTime, 1000);
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            setInterval(checkAlarms, 1000);
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ó‡∏∏‡∏Å 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            setInterval(checkConnection, 30000);
            
            // ‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            setTimeout(() => {
                if (Notification.permission === 'default') {
                    requestNotificationPermission();
                }
            }, 3000);
            
            // ‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
            simulateLoading();
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
            checkConnection();
            
            console.log('‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö Mobile App ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
        }
        
        // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î
        function simulateLoading() {
            let progress = 0;
            const loadingInterval = setInterval(() => {
                progress += 10;
                document.getElementById('loadingBar').style.width = progress + '%';
                
                if (progress >= 100) {
                    clearInterval(loadingInterval);
                    setTimeout(() => {
                        document.getElementById('appLaunch').style.opacity = '0';
                        setTimeout(() => {
                            document.getElementById('appLaunch').style.display = 'none';
                        }, 500);
                    }, 300);
                }
            }, 200);
        }
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        function updateCurrentTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('th-TH', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('currentDate').textContent = now.toLocaleDateString('th-TH', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        function loadAlarms() {
            alarms = JSON.parse(localStorage.getItem('alarms')) || [];
            
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤
            alarms.sort((a, b) => new Date(a.datetime) - new Date(b.datetime));
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            document.getElementById('totalAlarms').textContent = alarms.length;
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 3 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)
            displayRecentAlarms();
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            displayAllAlarms();
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
            updateNextAlarm();
        }
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
        function displayRecentAlarms() {
            const recentAlarmsContainer = document.getElementById('recentAlarms');
            const recentAlarms = alarms
                .filter(alarm => !alarm.triggered)
                .slice(0, 3);
            
            if (recentAlarms.length === 0) {
                recentAlarmsContainer.innerHTML = `
                    <div class="ios-notification text-center py-6">
                        <i class="fas fa-clock text-3xl text-gray-500 mb-3"></i>
                        <p class="text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
                    </div>
                `;
                return;
            }
            
            recentAlarmsContainer.innerHTML = '';
            recentAlarms.forEach(alarm => {
                const alarmDate = new Date(alarm.datetime);
                const alarmElement = document.createElement('div');
                alarmElement.className = 'ios-notification';
                alarmElement.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-bold">${alarm.title}</h3>
                            <p class="text-sm text-gray-400 mt-1">${alarm.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î'}</p>
                        </div>
                        <div class="text-right">
                            <div class="text-sm font-medium">${alarmDate.toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'})}</div>
                            <div class="text-xs text-gray-500">${alarmDate.toLocaleDateString('th-TH', {day: 'numeric', month: 'short'})}</div>
                        </div>
                    </div>
                    <div class="mt-3 flex items-center justify-between">
                        <span class="text-xs px-2 py-1 bg-blue-900/30 text-blue-300 rounded">${getRepeatText(alarm.repeat)}</span>
                        <button onclick="deleteAlarm('${alarm.id}')" class="text-xs text-red-400 hover:text-red-300">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                recentAlarmsContainer.appendChild(alarmElement);
            });
        }
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        function displayAllAlarms() {
            const allAlarmsContainer = document.getElementById('allAlarms');
            const activeAlarms = alarms.filter(alarm => !alarm.triggered);
            
            if (activeAlarms.length === 0) {
                allAlarmsContainer.innerHTML = `
                    <div class="ios-notification text-center py-6">
                        <i class="fas fa-clock text-3xl text-gray-500 mb-3"></i>
                        <p class="text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
                    </div>
                `;
                return;
            }
            
            allAlarmsContainer.innerHTML = '';
            activeAlarms.forEach(alarm => {
                const alarmDate = new Date(alarm.datetime);
                const now = new Date();
                const timeDiff = alarmDate - now;
                const hoursDiff = Math.floor(timeDiff / (1000 * 60 * 60));
                
                let timeBadge = '';
                if (hoursDiff < 24) {
                    timeBadge = `<span class="text-xs px-2 py-1 bg-red-900/30 text-red-300 rounded">‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ</span>`;
                } else if (hoursDiff < 168) {
                    timeBadge = `<span class="text-xs px-2 py-1 bg-yellow-900/30 text-yellow-300 rounded">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</span>`;
                }
                
                const alarmElement = document.createElement('div');
                alarmElement.className = 'ios-notification';
                alarmElement.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h3 class="font-bold">${alarm.title}</h3>
                            <p class="text-sm text-gray-400 mt-1">${alarm.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î'}</p>
                        </div>
                        <div class="text-right ml-4">
                            <div class="text-sm font-medium">${alarmDate.toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'})}</div>
                            <div class="text-xs text-gray-500">${alarmDate.toLocaleDateString('th-TH', {day: 'numeric', month: 'short'})}</div>
                        </div>
                    </div>
                    <div class="mt-3 flex items-center justify-between">
                        <div class="flex space-x-2">
                            <span class="text-xs px-2 py-1 bg-blue-900/30 text-blue-300 rounded">${getRepeatText(alarm.repeat)}</span>
                            ${timeBadge}
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="triggerAlarmNow('${alarm.id}')" class="text-xs px-2 py-1 bg-green-900/30 text-green-300 rounded hover:bg-green-800/50">
                                <i class="fas fa-play mr-1"></i>‡∏ó‡∏î‡∏™‡∏≠‡∏ö
                            </button>
                            <button onclick="deleteAlarm('${alarm.id}')" class="text-xs px-2 py-1 bg-red-900/30 text-red-300 rounded hover:bg-red-800/50">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                allAlarmsContainer.appendChild(alarmElement);
            });
        }
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
        function updateNextAlarm() {
            const now = new Date();
            const upcomingAlarms = alarms
                .filter(alarm => !alarm.triggered && new Date(alarm.datetime) > now)
                .sort((a, b) => new Date(a.datetime) - new Date(b.datetime));
            
            if (upcomingAlarms.length > 0) {
                const nextAlarm = upcomingAlarms[0];
                const nextAlarmDate = new Date(nextAlarm.datetime);
                document.getElementById('nextAlarmTime').textContent = 
                    `${nextAlarmDate.toLocaleDateString('th-TH', {day: 'numeric', month: 'short'})} ${nextAlarmDate.toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'})}`;
            } else {
                document.getElementById('nextAlarmTime').textContent = '‡πÑ‡∏°‡πà‡∏°‡∏µ';
            }
        }
        
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏ã‡πâ‡∏≥
        function setRepeat(repeatValue) {
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            ['none', 'daily', 'weekly', 'monthly'].forEach(type => {
                const btn = document.getElementById(`repeat${type.charAt(0).toUpperCase() + type.slice(1)}`);
                btn.className = 'px-4 py-2 bg-gray-800 rounded-lg text-sm';
            });
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            const selectedBtn = document.getElementById(`repeat${repeatValue.charAt(0).toUpperCase() + repeatValue.slice(1)}`);
            selectedBtn.className = 'px-4 py-2 bg-blue-600 rounded-lg text-sm';
            
            // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            window.selectedRepeat = repeatValue;
        }
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà
        document.getElementById('alarmForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const title = document.getElementById('title').value.trim();
            const description = document.getElementById('description').value.trim();
            const date = document.getElementById('date').value;
            const time = document.getElementById('time').value;
            const repeat = window.selectedRepeat || 'none';
            
            if (!title || !date || !time) {
                showAlert('error', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠, ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤');
                return;
            }
            
            const datetime = new Date(`${date}T${time}:00`);
            
            if (datetime <= new Date()) {
                showAlert('warning', '‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï');
                return;
            }
            
            const alarm = {
                id: 'alarm_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                title,
                description,
                date,
                time,
                datetime: datetime.toISOString(),
                repeat,
                triggered: false,
                synced: false,
                created: new Date().toISOString()
            };
            
            alarms.push(alarm);
            localStorage.setItem('alarms', JSON.stringify(alarms));
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheets
            await saveToGoogleSheets(alarm);
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
            loadAlarms();
            updateBadges();
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.getElementById('alarmForm').reset();
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
            const nextHour = new Date();
            nextHour.setHours(nextHour.getHours() + 1);
            document.getElementById('time').value = `${nextHour.getHours().toString().padStart(2, '0')}:00`;
            setRepeat('none');
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
            showAlert('success', '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', `‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô "${title}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
            
            // ‡∏™‡∏±‡πà‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î)
            if (settings.vibrationEnabled && navigator.vibrate) {
                navigator.vibrate([100, 50, 100]);
            }
        });
        
        // ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        async function deleteAlarm(alarmId) {
            const alarm = alarms.find(a => a.id === alarmId);
            if (!alarm) return;
            
            const result = await Swal.fire({
                icon: 'warning',
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö',
                html: `‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô<br><strong>"${alarm.title}"</strong>?`,
                showCancelButton: true,
                confirmButtonText: '‡∏•‡∏ö',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                background: '#1f2937',
                color: '#e5e7eb'
            });
            
            if (!result.isConfirmed) return;
            
            // ‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            alarms = alarms.filter(a => a.id !== alarmId);
            localStorage.setItem('alarms', JSON.stringify(alarms));
            
            // ‡∏•‡∏ö‡∏à‡∏≤‡∏Å Google Sheets ‡∏ñ‡πâ‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ
            if (alarm.synced) {
                await deleteFromGoogleSheets(alarm.id);
            }
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
            loadAlarms();
            updateBadges();
            
            showAlert('success', '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        }
        
        // ‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        async function clearAllAlarms() {
            if (alarms.length === 0) {
                showAlert('info', '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö');
                return;
            }
            
            const result = await Swal.fire({
                icon: 'warning',
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
                html: `‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <strong>${alarms.length}</strong> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£?`,
                showCancelButton: true,
                confirmButtonText: '‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                background: '#1f2937',
                color: '#e5e7eb'
            });
            
            if (!result.isConfirmed) return;
            
            // ‡∏•‡∏ö‡∏à‡∏≤‡∏Å Google Sheets
            for (const alarm of alarms.filter(a => a.synced)) {
                await deleteFromGoogleSheets(alarm.id);
            }
            
            // ‡∏•‡∏ö‡∏à‡∏≤‡∏Å localStorage
            alarms = [];
            localStorage.setItem('alarms', JSON.stringify(alarms));
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
            loadAlarms();
            updateBadges();
            
            showAlert('success', '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        }
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        function checkAlarms() {
            const now = new Date();
            
            alarms.forEach((alarm, index) => {
                if (!alarm.triggered && new Date(alarm.datetime) <= now) {
                    triggerAlarm(alarm.id);
                }
            });
        }
        
        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        function triggerAlarm(alarmId) {
            const alarmIndex = alarms.findIndex(a => a.id === alarmId);
            if (alarmIndex === -1) return;
            
            const alarm = alarms[alarmIndex];
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
            alarms[alarmIndex].triggered = true;
            alarms[alarmIndex].triggered_at = new Date().toISOString();
            localStorage.setItem('alarms', JSON.stringify(alarms));
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            addNotification({
                type: 'alarm',
                title: alarm.title,
                message: alarm.description || '‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏∂‡∏á‡πÅ‡∏•‡πâ‡∏ß!',
                timestamp: new Date().toISOString(),
                alarmId: alarm.id
            });
            
            // ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            sendPushNotification(alarm.title, alarm.description || '‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏∂‡∏á‡πÅ‡∏•‡πâ‡∏ß!', 'alarm');
            
            // ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏ã‡πâ‡∏≥ ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà
            if (alarm.repeat !== 'none') {
                scheduleNextRepeatingAlarm(alarm);
            }
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
            loadAlarms();
            updateBadges();
        }
        
        // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        function triggerAlarmNow(alarmId) {
            const alarm = alarms.find(a => a.id === alarmId);
            if (!alarm) return;
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö
            sendPushNotification(alarm.title, alarm.description || '‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', 'test');
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            addNotification({
                type: 'test',
                title: `‡∏ó‡∏î‡∏™‡∏≠‡∏ö: ${alarm.title}`,
                message: alarm.description || '‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô',
                timestamp: new Date().toISOString()
            });
            
            showAlert('success', '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        }
        
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≥‡∏ã‡πâ‡∏≥‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ
        function scheduleNextRepeatingAlarm(alarm) {
            const alarmDate = new Date(alarm.datetime);
            
            switch (alarm.repeat) {
                case 'daily':
                    alarmDate.setDate(alarmDate.getDate() + 1);
                    break;
                case 'weekly':
                    alarmDate.setDate(alarmDate.getDate() + 7);
                    break;
                case 'monthly':
                    alarmDate.setMonth(alarmDate.getMonth() + 1);
                    break;
            }
            
            const newAlarm = {
                ...alarm,
                id: 'alarm_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                datetime: alarmDate.toISOString(),
                triggered: false,
                synced: false
            };
            
            alarms.push(newAlarm);
            localStorage.setItem('alarms', JSON.stringify(alarms));
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheets
            saveToGoogleSheets(newAlarm);
        }
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
        function addNotification(notification) {
            notifications.unshift(notification);
            if (notifications.length > 100) {
                notifications = notifications.slice(0, 100);
            }
            localStorage.setItem('notifications', JSON.stringify(notifications));
            updateBadges();
        }
        
        // ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        function loadNotifications() {
            notifications = JSON.parse(localStorage.getItem('notifications')) || [];
            updateBadges();
        }
        
        // ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ú‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        function openNotificationPanel() {
            document.getElementById('notificationPanel').classList.add('active');
            renderNotificationList();
        }
        
        // ‡∏õ‡∏¥‡∏î‡πÅ‡∏ú‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        function closeNotificationPanel() {
            document.getElementById('notificationPanel').classList.remove('active');
        }
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        function renderNotificationList() {
            const container = document.getElementById('notificationList');
            container.innerHTML = '';
            
            if (notifications.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-10">
                        <i class="fas fa-bell-slash text-4xl text-gray-500 mb-3"></i>
                        <p class="text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
                    </div>
                `;
                return;
            }
            
            notifications.forEach(notification => {
                const time = new Date(notification.timestamp);
                const notificationElement = document.createElement('div');
                notificationElement.className = 'ios-notification mb-3';
                notificationElement.innerHTML = `
                    <div class="flex items-start">
                        <div class="flex-shrink-0 mr-3">
                            <div class="w-8 h-8 rounded-full ${notification.type === 'alarm' ? 'bg-blue-600' : 'bg-purple-600'} flex items-center justify-center">
                                <i class="fas fa-${notification.type === 'alarm' ? 'clock' : 'broadcast-tower'} text-white text-sm"></i>
                            </div>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-bold">${notification.title}</h3>
                            <p class="text-sm text-gray-400 mt-1">${notification.message}</p>
                            <p class="text-xs text-gray-500 mt-2">${time.toLocaleDateString('th-TH')} ${time.toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'})}</p>
                        </div>
                    </div>
                `;
                container.appendChild(notificationElement);
            });
        }
        
        // ‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®
        async function sendBroadcast() {
            const title = document.getElementById('broadcastTitle').value.trim();
            const message = document.getElementById('broadcastMessage').value.trim();
            
            if (!title || !message) {
                showAlert('error', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®');
                return;
            }
            
            const result = await Swal.fire({
                icon: 'question',
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®',
                html: `‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®<br><strong>"${title}"</strong><br>‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô?`,
                showCancelButton: true,
                confirmButtonText: '‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                background: '#1f2937',
                color: '#e5e7eb'
            });
            
            if (!result.isConfirmed) return;
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheets
            await saveBroadcastToGoogleSheets(title, message);
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            addNotification({
                type: 'broadcast',
                title: `üì¢ ${title}`,
                message: message,
                timestamp: new Date().toISOString()
            });
            
            // ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            sendPushNotification(`üì¢ ${title}`, message, 'broadcast');
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
            clearBroadcastForm();
            
            showAlert('success', '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        }
        
        // ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®
        function clearBroadcastForm() {
            document.getElementById('broadcastTitle').value = '';
            document.getElementById('broadcastMessage').value = '';
        }
        
        // ‡∏™‡πà‡∏á Push Notification
        function sendPushNotification(title, message, type = 'info') {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
            if (!settings.pushEnabled) return;
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå
            if ('Notification' in window && Notification.permission === 'granted') {
                try {
                    const notification = new Notification(`üîî ${title}`, {
                        body: message,
                        icon: 'https://cdn-icons-png.flaticon.com/512/565/565422.png',
                        badge: 'https://cdn-icons-png.flaticon.com/512/565/565422.png',
                        tag: 'notification-' + Date.now(),
                        requireInteraction: true,
                        vibrate: settings.vibrationEnabled ? [200, 100, 200] : []
                    });
                    
                    notification.onclick = function() {
                        window.focus();
                        this.close();
                    };
                } catch (error) {
                    console.log('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ:', error);
                }
            }
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ
            showInAppPushNotification(title, message, type);
            
            // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î)
            if (settings.soundEnabled) {
                playNotificationSound();
            }
            
            // ‡∏™‡∏±‡πà‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î)
            if (settings.vibrationEnabled && navigator.vibrate) {
                navigator.vibrate([200, 100, 200]);
            }
        }
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ
        function showInAppPushNotification(title, message, type) {
            const pushNotification = document.getElementById('pushNotification');
            document.getElementById('pushTitle').textContent = title;
            document.getElementById('pushMessage').textContent = message;
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
            const borderClass = type === 'alarm' ? 'from-blue-500 to-purple-600' : 
                               type === 'broadcast' ? 'from-purple-500 to-pink-600' : 
                               'from-green-500 to-blue-600';
            
            pushNotification.querySelector('.bg-gradient-to-br').className = 
                `w-10 h-10 rounded-full bg-gradient-to-br ${borderClass} flex items-center justify-center`;
            
            pushNotification.classList.remove('hidden');
            setTimeout(() => {
                pushNotification.style.transform = 'translateY(0)';
            }, 100);
            
            // ‡∏õ‡∏¥‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            setTimeout(() => {
                closePushNotification();
            }, 10000);
        }
        
        // ‡∏õ‡∏¥‡∏î Push Notification
        function closePushNotification() {
            const pushNotification = document.getElementById('pushNotification');
            pushNotification.style.transform = 'translateY(-100%)';
            setTimeout(() => {
                pushNotification.classList.add('hidden');
            }, 300);
        }
        
        // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Push Notification
        function testPushNotification() {
            sendPushNotification(
                '‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', 
                '‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö Mobile App', 
                'test'
            );
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            addNotification({
                type: 'test',
                title: '‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô',
                message: '‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô',
                timestamp: new Date().toISOString()
            });
        }
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏ö‡∏î‡∏à‡πå
        function updateBadges() {
            const unreadCount = notifications.length;
            
            // ‡πÅ‡∏ö‡∏î‡∏à‡πå‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ö‡∏ô‡∏≥‡∏ó‡∏≤‡∏á
            const navBadge = document.getElementById('navBadge');
            if (unreadCount > 0) {
                navBadge.textContent = unreadCount > 99 ? '99+' : unreadCount;
                navBadge.classList.remove('hidden');
            } else {
                navBadge.classList.add('hidden');
            }
            
            // ‡πÅ‡∏ö‡∏î‡∏à‡πå‡πÉ‡∏ô‡πÄ‡∏Æ‡∏î‡πÄ‡∏î‡∏≠‡∏£‡πå
            const headerBadge = document.getElementById('headerBadge');
            if (unreadCount > 0) {
                headerBadge.textContent = unreadCount > 99 ? '99+' : unreadCount;
                headerBadge.classList.remove('hidden');
            } else {
                headerBadge.classList.add('hidden');
            }
            
            // ‡πÅ‡∏ö‡∏î‡∏à‡πå‡πÉ‡∏ô Quick Actions
            const quickBadge = document.getElementById('quickBadge');
            if (unreadCount > 0) {
                quickBadge.textContent = unreadCount > 99 ? '99+' : unreadCount;
                quickBadge.classList.remove('hidden');
            } else {
                quickBadge.classList.add('hidden');
            }
        }
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
        async function checkConnection() {
            try {
                const params = new URLSearchParams({
                    action: 'test',
                    test: 'connection',
                    user_id: userId
                });
                
                const response = await fetch(`${GOOGLE_SCRIPT_URL}?${params.toString()}`, {timeout: 5000});
                
                if (response.ok) {
                    document.getElementById('statusDot').className = 'w-2 h-2 rounded-full bg-green-500 mr-2';
                    document.getElementById('statusText').textContent = '‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå';
                    document.getElementById('statusText').className = 'text-xs text-green-400';
                } else {
                    throw new Error('Connection failed');
                }
            } catch (error) {
                document.getElementById('statusDot').className = 'w-2 h-2 rounded-full bg-red-500 mr-2';
                document.getElementById('statusText').textContent = '‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå';
                document.getElementById('statusText').className = 'text-xs text-red-400';
            }
        }
        
        // ‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        function requestNotificationPermission() {
            if (!('Notification' in window)) {
                showAlert('info', '‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö', '‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô');
                return;
            }
            
            if (Notification.permission === 'granted') {
                showAlert('success', '‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÅ‡∏•‡πâ‡∏ß', '‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß');
                return;
            }
            
            if (Notification.permission === 'denied') {
                showAlert('warning', '‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò', '‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå');
                return;
            }
            
            Notification.requestPermission().then(permission => {
                settings.notificationPermission = permission;
                localStorage.setItem('notificationSettings', JSON.stringify(settings));
                
                if (permission === 'granted') {
                    showAlert('success', '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß');
                    // ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö
                    setTimeout(() => testPushNotification(), 1000);
                } else {
                    showAlert('warning', '‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò', '‡∏Ñ‡∏∏‡∏ì‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô');
                }
            });
        }
        
        // ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô PWA
        function installPWA() {
            if (!window.deferredPrompt) {
                showAlert('info', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ‡πÑ‡∏î‡πâ‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏Ç‡∏≠‡∏á‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå');
                return;
            }
            
            window.deferredPrompt.prompt();
            window.deferredPrompt.userChoice.then(choiceResult => {
                if (choiceResult.outcome === 'accepted') {
                    showAlert('success', '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡πÅ‡∏≠‡∏õ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á...');
                }
                window.deferredPrompt = null;
            });
        }
        
        // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        function refreshData() {
            loadAlarms();
            loadNotifications();
            checkConnection();
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡∏ô‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
            const refreshBtn = document.querySelector('[onclick="refreshData()"]');
            refreshBtn.classList.add('animate-spin');
            setTimeout(() => {
                refreshBtn.classList.remove('animate-spin');
            }, 1000);
            
            showAlert('success', '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        }
        
        // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        function playNotificationSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.1);
                gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                console.log("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏î‡πâ:", e);
            }
        }
        
        // ‡πÅ‡∏™‡∏î‡∏á Alert
        function showAlert(icon, title, text) {
            Swal.fire({
                icon,
                title,
                text,
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                background: '#1f2937',
                color: '#e5e7eb'
            });
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠
        function getRepeatText(repeatValue) {
            const repeatMap = {
                'none': '‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏ã‡πâ‡∏≥',
                'daily': '‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô',
                'weekly': '‡∏ó‡∏∏‡∏Å‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå',
                'monthly': '‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'
            };
            return repeatMap[repeatValue] || repeatValue;
        }
        
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function scrollToForm() {
            document.getElementById('addAlarmSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        function scrollToAlarms() {
            document.getElementById('allAlarmsSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        function scrollToBroadcast() {
            document.getElementById('broadcastSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        function scrollToSettings() {
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheets
        async function saveToGoogleSheets(alarmData) {
            try {
                const payload = {
                    action: 'add',
                    date: alarmData.date,
                    time: alarmData.time,
                    title: alarmData.title,
                    description: alarmData.description || '',
                    repeat: alarmData.repeat,
                    status: 'created',
                    user_id: userId,
                    alarm_id: alarmData.id
                };
                
                const params = new URLSearchParams();
                for (const key in payload) {
                    params.append(key, payload[key]);
                }
                
                const response = await fetch(`${GOOGLE_SCRIPT_URL}?${params.toString()}`);
                
                if (response.ok) {
                    const alarmIndex = alarms.findIndex(a => a.id === alarmData.id);
                    if (alarmIndex !== -1) {
                        alarms[alarmIndex].synced = true;
                        localStorage.setItem('alarms', JSON.stringify(alarms));
                    }
                    return true;
                }
            } catch (error) {
                console.error('Error saving to Google Sheets:', error);
            }
            return false;
        }
        
        async function deleteFromGoogleSheets(alarmId) {
            try {
                const params = new URLSearchParams({
                    action: 'delete',
                    alarm_id: alarmId,
                    user_id: userId
                });
                
                const response = await fetch(`${GOOGLE_SCRIPT_URL}?${params.toString()}`);
                return response.ok;
            } catch (error) {
                console.error('Error deleting from Google Sheets:', error);
                return false;
            }
        }
        
        async function saveBroadcastToGoogleSheets(title, message) {
            try {
                const payload = {
                    action: 'add',
                    date: new Date().toLocaleDateString('th-TH'),
                    time: new Date().toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'}),
                    title: `üì¢ ${title}`,
                    description: message,
                    status: 'broadcast',
                    user_id: userId,
                    alarm_id: 'broadcast_' + Date.now()
                };
                
                const params = new URLSearchParams();
                for (const key in payload) {
                    params.append(key, payload[key]);
                }
                
                const response = await fetch(`${GOOGLE_SCRIPT_URL}?${params.toString()}`);
                return response.ok;
            } catch (error) {
                console.error('Error saving broadcast to Google Sheets:', error);
                return false;
            }
        }
        
        // PWA Installation
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            window.deferredPrompt = e;
        });
        
        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏≠‡∏õ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à
        document.addEventListener('DOMContentLoaded', initApp);
        
        // Service Worker Registration ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(registration => {
                    console.log('ServiceWorker registered:', registration);
                }).catch(error => {
                    console.log('ServiceWorker registration failed:', error);
                });
            });
        }
    </script>
</body>
</html>
