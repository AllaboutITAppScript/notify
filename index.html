<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì± ‡πÅ‡∏≠‡∏õ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</title>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-messaging-compat.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <style>
        :root {
            --primary: #2196F3;
            --secondary: #1976D2;
            --success: #4CAF50;
            --warning: #FF9800;
            --danger: #f44336;
            --dark: #2C3E50;
            --light: #ECF0F1;
            --notification-badge: #FF5252;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Kanit', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--dark) 0%, #34495E 100%);
            color: #333;
            min-height: 100vh;
        }
        
        /* Header with Notification Bell */
        .app-header {
            background: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .app-logo {
            width: 40px;
            height: 40px;
            background: var(--primary);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }
        
        .app-title h1 {
            color: var(--dark);
            font-size: 1.5rem;
        }
        
        .app-title p {
            color: #666;
            font-size: 0.9rem;
        }
        
        /* Notification Bell */
        .notification-bell {
            position: relative;
            cursor: pointer;
        }
        
        .bell-icon {
            font-size: 1.8rem;
            color: var(--dark);
            transition: transform 0.3s;
        }
        
        .bell-icon:hover {
            transform: scale(1.1);
            color: var(--primary);
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--notification-badge);
            color: white;
            font-size: 0.7rem;
            font-weight: bold;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        /* Notification Panel */
        .notification-panel {
            position: fixed;
            top: 70px;
            right: 20px;
            width: 350px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 999;
            display: none;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .notification-panel.show {
            display: block;
            animation: slideDown 0.3s;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .panel-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .panel-header h3 {
            color: var(--dark);
        }
        
        .notification-list {
            padding: 10px;
        }
        
        .notification-item {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            background: var(--light);
            border-left: 4px solid var(--primary);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .notification-item:hover {
            background: #e3f2fd;
            transform: translateX(5px);
        }
        
        .notification-item.unread {
            background: #e8f5e8;
            border-left-color: var(--success);
        }
        
        .notification-item.important {
            background: #ffebee;
            border-left-color: var(--danger);
        }
        
        .notification-time {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }
        
        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Status Cards */
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card h2 {
            color: var(--primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card h2 i {
            background: var(--primary);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        
        .status-item:last-child {
            border-bottom: none;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 10px;
        }
        
        .status-dot.active {
            background: var(--success);
            animation: blink 2s infinite;
        }
        
        .status-dot.inactive {
            background: var(--danger);
        }
        
        .status-dot.waiting {
            background: var(--warning);
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Notification Form */
        .notification-form {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 25px 0;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .form-control {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }
        
        /* Buttons */
        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            background: #d32f2f;
            transform: translateY(-2px);
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-warning:hover {
            background: #e68900;
            transform: translateY(-2px);
        }
        
        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 25px;
        }
        
        /* Notification History */
        .notification-history {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 25px 0;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            max-height: 500px;
            overflow-y: auto;
        }
        
        .history-item {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid var(--primary);
        }
        
        .history-item.sent {
            border-left-color: var(--success);
        }
        
        .history-item.failed {
            border-left-color: var(--danger);
        }
        
        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
        }
        
        .toast {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 15px;
            animation: slideUp 0.3s;
            border-left: 5px solid var(--success);
            min-width: 300px;
        }
        
        .toast.error {
            border-left-color: var(--danger);
        }
        
        .toast.warning {
            border-left-color: var(--warning);
        }
        
        .toast.info {
            border-left-color: var(--primary);
        }
        
        @keyframes slideUp {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* Footer */
        .app-footer {
            text-align: center;
            color: white;
            padding: 30px 20px;
            margin-top: 40px;
            background: rgba(0,0,0,0.2);
            border-radius: 15px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .notification-panel {
                width: calc(100% - 40px);
                right: 10px;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Header with Notification Bell -->
    <header class="app-header">
        <div class="header-left">
            <div class="app-logo">
                <i class="fas fa-bell"></i>
            </div>
            <div class="app-title">
                <h1>‡πÅ‡∏≠‡∏õ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</h1>
                <p>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πâ‡∏õ‡∏¥‡∏î‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå</p>
            </div>
        </div>
        
        <div class="notification-bell" id="notificationBell">
            <i class="fas fa-bell bell-icon"></i>
            <div class="notification-badge" id="notificationBadge">0</div>
        </div>
        
        <!-- Notification Panel -->
        <div class="notification-panel" id="notificationPanel">
            <div class="panel-header">
                <h3><i class="fas fa-bell"></i> ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                <button class="btn btn-danger" id="clearAllBtn" style="padding: 5px 10px; font-size: 0.9rem;">
                    <i class="fas fa-trash"></i> ‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>
            </div>
            <div class="notification-list" id="notificationList">
                <div class="notification-item unread">
                    <strong>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡πÅ‡∏≠‡∏õ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô!</strong>
                    <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏∞‡∏î‡∏¥‡πà‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
                    <div class="notification-time">‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <!-- Status Cards -->
        <div class="status-grid">
            <div class="card">
                <h2><i class="fas fa-cogs"></i> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏ö‡∏ö</h2>
                <div class="status-item">
                    <span>‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:</span>
                    <div style="display: flex; align-items: center;">
                        <div class="status-dot" id="notificationStatus"></div>
                        <span id="notificationStatusText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</span>
                    </div>
                </div>
                <div class="status-item">
                    <span>‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå:</span>
                    <div style="display: flex; align-items: center;">
                        <div class="status-dot" id="serverStatus"></div>
                        <span id="serverStatusText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</span>
                    </div>
                </div>
                <div class="status-item">
                    <span>Firebase:</span>
                    <div style="display: flex; align-items: center;">
                        <div class="status-dot" id="firebaseStatus"></div>
                        <span id="firebaseStatusText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</span>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-chart-bar"></i> ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</h2>
                <div class="status-item">
                    <span>‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
                    <span id="totalNotifications">0</span>
                </div>
                <div class="status-item">
                    <span>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô:</span>
                    <span id="unreadNotifications">0</span>
                </div>
                <div class="status-item">
                    <span>‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß:</span>
                    <span id="sentNotifications">0</span>
                </div>
            </div>
        </div>

        <!-- Notification Form -->
        <div class="notification-form">
            <h2><i class="fas fa-plus-circle"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà</h2>
            
            <div class="form-group">
                <label for="notificationTitle"><i class="fas fa-heading"></i> ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠:</label>
                <input type="text" id="notificationTitle" class="form-control" 
                       placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç" 
                       value="‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô">
            </div>
            
            <div class="form-group">
                <label for="notificationMessage"><i class="fas fa-comment-alt"></i> ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°:</label>
                <textarea id="notificationMessage" class="form-control" rows="3" 
                          placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà...">
‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô ‡∏à‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏°‡πâ‡∏õ‡∏¥‡∏î‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß</textarea>
            </div>
            
            <div class="form-group">
                <label for="scheduleTime"><i class="fas fa-clock"></i> ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ô‡∏≤‡∏ó‡∏µ):</label>
                <input type="number" id="scheduleTime" class="form-control" 
                       min="1" max="10080" value="2" 
                       placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏≤‡∏ó‡∏µ">
                <small style="color: #666; margin-top: 5px; display: block;">
                    <i class="fas fa-info-circle"></i> ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: 2 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö
                </small>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-success" id="scheduleBtn">
                    <i class="fas fa-clock"></i> ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                </button>
                <button class="btn btn-primary" id="sendNowBtn">
                    <i class="fas fa-paper-plane"></i> ‡∏™‡πà‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                </button>
                <button class="btn btn-warning" id="requestPermissionBtn">
                    <i class="fas fa-hand-paper"></i> ‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï
                </button>
            </div>
        </div>

        <!-- Notification History -->
        <div class="notification-history">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2><i class="fas fa-history"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h2>
                <button class="btn btn-danger" id="clearHistoryBtn" style="padding: 8px 15px;">
                    <i class="fas fa-trash-alt"></i> ‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
                </button>
            </div>
            
            <div id="notificationHistory">
                <!-- History items will be added here -->
            </div>
        </div>

        <!-- Instructions -->
        <div class="card">
            <h2><i class="fas fa-graduation-cap"></i> ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏¥‡∏î Browser</h2>
            <div style="margin-top: 15px;">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                    <div style="width: 30px; height: 30px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center;">1</div>
                    <span>‡∏Ñ‡∏•‡∏¥‡∏Å "‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</span>
                </div>
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                    <div style="width: 30px; height: 30px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center;">2</div>
                    <span>‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô 2 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏à‡∏≤‡∏Å‡∏ô‡∏µ‡πâ</span>
                </div>
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                    <div style="width: 30px; height: 30px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center;">3</div>
                    <span><strong>‡∏õ‡∏¥‡∏î‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</strong> (‡∏ó‡∏∏‡∏Å‡πÅ‡∏ó‡πá‡∏ö‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á)</span>
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <div style="width: 30px; height: 30px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center;">4</div>
                    <span>‡∏£‡∏≠ 2 ‡∏ô‡∏≤‡∏ó‡∏µ ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏°‡πâ‡∏õ‡∏¥‡∏î Browser ‡πÅ‡∏•‡πâ‡∏ß!</span>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="app-footer">
            <h3>‡πÅ‡∏≠‡∏õ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</h3>
            <p>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πâ‡∏õ‡∏¥‡∏î‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå ‚Ä¢ ‡πÉ‡∏ä‡πâ Firebase Cloud Messaging</p>
            <p style="margin-top: 10px; font-size: 0.9rem; opacity: 0.8;">
                <i class="fas fa-info-circle"></i> ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ HTTPS ‡πÅ‡∏•‡∏∞‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            </p>
        </footer>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Audio for Notification -->
    <audio id="notificationSound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3" type="audio/mpeg">
    </audio>

    <!-- Firebase Config -->
    <script src="firebase-config.js"></script>

    <!-- Main JavaScript -->
    <script>
        // Global Variables
        let notifications = [];
        let unreadCount = 0;
        let firebaseMessaging = null;
        let serviceWorkerRegistration = null;
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeApp);
        
        async function initializeApp() {
            console.log('üöÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏≠‡∏õ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô...');
            
            // Setup event listeners
            setupEventListeners();
            
            // Check notification permission
            await checkNotificationPermission();
            
            // Initialize Firebase
            await initializeFirebase();
            
            // Load notifications from storage
            await loadNotifications();
            
            // Update UI
            updateNotificationUI();
            
            // Register service worker
            await registerServiceWorker();
            
            // Start checking for server status
            checkServerStatus();
            
            // Update badge count
            updateBadgeCount();
            
            // Test sound
            setTimeout(() => {
                playNotificationSound();
            }, 1000);
            
            console.log('‚úÖ ‡πÅ‡∏≠‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß');
            showToast('‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö!', 'success', '‡πÅ‡∏≠‡∏õ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß');
        }
        
        function setupEventListeners() {
            // Notification bell
            document.getElementById('notificationBell').addEventListener('click', toggleNotificationPanel);
            
            // Buttons
            document.getElementById('scheduleBtn').addEventListener('click', scheduleNotification);
            document.getElementById('sendNowBtn').addEventListener('click', sendImmediateNotification);
            document.getElementById('requestPermissionBtn').addEventListener('click', requestNotificationPermission);
            document.getElementById('clearAllBtn').addEventListener('click', clearAllNotifications);
            document.getElementById('clearHistoryBtn').addEventListener('click', clearHistory);
            
            // Close notification panel when clicking outside
            document.addEventListener('click', (e) => {
                const panel = document.getElementById('notificationPanel');
                const bell = document.getElementById('notificationBell');
                
                if (!panel.contains(e.target) && !bell.contains(e.target)) {
                    panel.classList.remove('show');
                }
            });
        }
        
        // Toggle notification panel
        function toggleNotificationPanel() {
            const panel = document.getElementById('notificationPanel');
            panel.classList.toggle('show');
            
            // Mark all as read when opening panel
            if (panel.classList.contains('show')) {
                markAllAsRead();
            }
        }
        
        // Check notification permission
        async function checkNotificationPermission() {
            const statusDot = document.getElementById('notificationStatus');
            const statusText = document.getElementById('notificationStatusText');
            
            if (!('Notification' in window)) {
                statusDot.className = 'status-dot inactive';
                statusText.textContent = '‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö';
                return false;
            }
            
            const permission = Notification.permission;
            
            switch(permission) {
                case 'granted':
                    statusDot.className = 'status-dot active';
                    statusText.textContent = '‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÅ‡∏•‡πâ‡∏ß';
                    return true;
                case 'denied':
                    statusDot.className = 'status-dot inactive';
                    statusText.textContent = '‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÅ‡∏•‡πâ‡∏ß';
                    return false;
                default:
                    statusDot.className = 'status-dot waiting';
                    statusText.textContent = '‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï';
                    return false;
            }
        }
        
        // Request notification permission
        async function requestNotificationPermission() {
            if (!('Notification' in window)) {
                showToast('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', 'error');
                return false;
            }
            
            try {
                const permission = await Notification.requestPermission();
                
                // Update UI
                await checkNotificationPermission();
                
                if (permission === 'granted') {
                    showToast('‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß!', 'success');
                    
                    // Initialize Firebase messaging
                    if (firebaseMessaging) {
                        await setupFirebaseMessaging();
                    }
                    
                    return true;
                } else {
                    showToast('‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò', 'warning');
                    return false;
                }
            } catch (error) {
                console.error('‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:', error);
                showToast('‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', 'error');
                return false;
            }
        }
        
        // Initialize Firebase
        async function initializeFirebase() {
            try {
                const firebaseStatus = document.getElementById('firebaseStatus');
                const firebaseStatusText = document.getElementById('firebaseStatusText');
                
                if (!firebaseConfig) {
                    firebaseStatus.className = 'status-dot inactive';
                    firebaseStatusText.textContent = '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤';
                    showToast('‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase', 'warning');
                    return;
                }
                
                // Initialize Firebase
                firebase.initializeApp(firebaseConfig);
                
                // Get messaging instance
                firebaseMessaging = firebase.messaging();
                
                firebaseStatus.className = 'status-dot active';
                firebaseStatusText.textContent = '‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
                
                console.log('‚úÖ Firebase ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                
                // Setup Firebase messaging
                await setupFirebaseMessaging();
                
            } catch (error) {
                console.error('Firebase initialization error:', error);
                const firebaseStatus = document.getElementById('firebaseStatus');
                const firebaseStatusText = document.getElementById('firebaseStatusText');
                firebaseStatus.className = 'status-dot inactive';
                firebaseStatusText.textContent = '‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î';
            }
        }
        
        // Setup Firebase Messaging
        async function setupFirebaseMessaging() {
            if (!firebaseMessaging) return;
            
            try {
                // Request permission and get token
                const token = await firebaseMessaging.getToken({
                    vapidKey: firebaseConfig.vapidKey
                });
                
                if (token) {
                    console.log('Firebase Token:', token);
                    
                    // Save token to server (in real app)
                    await saveTokenToServer(token);
                    
                    // Listen for messages
                    firebaseMessaging.onMessage((payload) => {
                        console.log('Message received:', payload);
                        handlePushNotification(payload);
                    });
                    
                    return token;
                }
            } catch (error) {
                console.error('Firebase Messaging error:', error);
            }
        }
        
        // Save token to server
        async function saveTokenToServer(token) {
            try {
                // In production, send to your server
                localStorage.setItem('fcm_token', token);
                console.log('Token saved:', token);
            } catch (error) {
                console.error('Save token error:', error);
            }
        }
        
        // Schedule notification
        async function scheduleNotification() {
            const title = document.getElementById('notificationTitle').value.trim();
            const message = document.getElementById('notificationMessage').value.trim();
            const minutes = parseInt(document.getElementById('scheduleTime').value);
            
            // Validation
            if (!title || !message) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°', 'warning');
                return;
            }
            
            if (isNaN(minutes) || minutes < 1 || minutes > 10080) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 1-10080 ‡∏ô‡∏≤‡∏ó‡∏µ', 'warning');
                return;
            }
            
            // Create notification object
            const notification = {
                id: 'notification-' + Date.now(),
                title: title,
                message: message,
                type: 'scheduled',
                minutes: minutes,
                scheduledTime: Date.now() + (minutes * 60000),
                createdAt: Date.now(),
                status: 'scheduled',
                read: false
            };
            
            // Add to notifications array
            notifications.unshift(notification);
            
            // Save to storage
            await saveNotifications();
            
            // Update UI
            updateNotificationUI();
            
            // Show confirmation
            const timeString = new Date(notification.scheduledTime).toLocaleTimeString('th-TH', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            showToast(
                '‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 
                'success',
                `‡∏à‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡∏≠‡∏µ‡∏Å ${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ (${timeString})`
            );
            
            // Add to history
            addToHistory({
                id: notification.id,
                title: '‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô',
                message: `"${title}" ‡πÉ‡∏ô‡∏≠‡∏µ‡∏Å ${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ`,
                time: new Date().toLocaleTimeString('th-TH'),
                status: 'scheduled'
            });
            
            // Send to server for scheduling (in production)
            await sendToServer(notification);
        }
        
        // Send immediate notification
        async function sendImmediateNotification() {
            const title = document.getElementById('notificationTitle').value.trim() || '‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô';
            const message = document.getElementById('notificationMessage').value.trim() || '‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô';
            
            // Check permission
            if (Notification.permission !== 'granted') {
                const granted = await requestNotificationPermission();
                if (!granted) return;
            }
            
            // Create notification
            const notification = {
                id: 'immediate-' + Date.now(),
                title: title,
                message: message,
                type: 'immediate',
                createdAt: Date.now(),
                status: 'sent',
                read: false
            };
            
            // Add to notifications
            notifications.unshift(notification);
            
            // Save
            await saveNotifications();
            
            // Update UI
            updateNotificationUI();
            
            // Send notification
            if (serviceWorkerRegistration) {
                // Send through service worker
                serviceWorkerRegistration.showNotification(title, {
                    body: message,
                    icon: '/icons/icon-192x192.png',
                    badge: '/icons/icon-96x96.png',
                    tag: notification.id,
                    requireInteraction: true,
                    actions: [
                        {
                            action: 'view',
                            title: '‡∏î‡∏π'
                        },
                        {
                            action: 'close',
                            title: '‡∏õ‡∏¥‡∏î'
                        }
                    ]
                });
            } else if (Notification.permission === 'granted') {
                // Fallback to regular notification
                new Notification(title, {
                    body: message,
                    icon: '/icons/icon-192x192.png'
                });
            }
            
            // Play sound
            playNotificationSound();
            
            // Show toast
            showToast('‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß!', 'success');
            
            // Add to history
            addToHistory({
                id: notification.id,
                title: '‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ',
                message: `"${title}"`,
                time: new Date().toLocaleTimeString('th-TH'),
                status: 'sent'
            });
        }
        
        // Handle push notification
        function handlePushNotification(payload) {
            console.log('Received push:', payload);
            
            const notification = {
                id: payload.data?.id || 'push-' + Date.now(),
                title: payload.notification?.title || '‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà',
                message: payload.notification?.body || '‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà',
                type: 'push',
                createdAt: Date.now(),
                status: 'received',
                read: false
            };
            
            // Add to notifications
            notifications.unshift(notification);
            
            // Save
            saveNotifications();
            
            // Update UI
            updateNotificationUI();
            
            // Play sound
            playNotificationSound();
            
            // Show toast
            showToast(notification.title, 'info', notification.message);
            
            // Update badge
            updateBadgeCount();
            
            // Vibrate if supported
            if ('vibrate' in navigator) {
                navigator.vibrate([200, 100, 200]);
            }
        }
        
        // Update notification UI
        function updateNotificationUI() {
            updateNotificationList();
            updateNotificationStats();
            updateBadgeCount();
        }
        
        // Update notification list
        function updateNotificationList() {
            const list = document.getElementById('notificationList');
            const history = document.getElementById('notificationHistory');
            
            // Clear lists
            list.innerHTML = '';
            history.innerHTML = '';
            
            if (notifications.length === 0) {
                list.innerHTML = `
                    <div class="notification-item">
                        <strong>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</strong>
                        <p>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì!</p>
                    </div>
                `;
                
                history.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: #666;">
                        <i class="fas fa-history fa-2x" style="margin-bottom: 10px; display: block;"></i>
                        ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                    </div>
                `;
                
                return;
            }
            
            // Show last 10 notifications in panel
            const recentNotifications = notifications.slice(0, 10);
            
            recentNotifications.forEach(notification => {
                const time = new Date(notification.createdAt).toLocaleTimeString('th-TH', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const item = document.createElement('div');
                item.className = `notification-item ${notification.read ? '' : 'unread'}`;
                item.innerHTML = `
                    <strong>${notification.title}</strong>
                    <p>${notification.message}</p>
                    <div class="notification-time">${time}</div>
                `;
                
                item.addEventListener('click', () => {
                    markAsRead(notification.id);
                });
                
                list.appendChild(item);
            });
            
            // Show all in history
            notifications.forEach(notification => {
                const time = new Date(notification.createdAt).toLocaleTimeString('th-TH', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const item = document.createElement('div');
                item.className = `history-item ${notification.status}`;
                item.innerHTML = `
                    <strong>${notification.title}</strong>
                    <p>${notification.message}</p>
                    <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                        <span style="font-size: 0.8rem; color: #666;">${time}</span>
                        <span style="font-size: 0.8rem; color: ${notification.status === 'sent' ? 'green' : 'orange'};">
                            ${notification.status === 'scheduled' ? '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£' : '‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß'}
                        </span>
                    </div>
                `;
                
                history.appendChild(item);
            });
        }
        
        // Update notification statistics
        function updateNotificationStats() {
            const total = notifications.length;
            const unread = notifications.filter(n => !n.read).length;
            const sent = notifications.filter(n => n.status === 'sent').length;
            
            document.getElementById('totalNotifications').textContent = total;
            document.getElementById('unreadNotifications').textContent = unread;
            document.getElementById('sentNotifications').textContent = sent;
        }
        
        // Update badge count
        function updateBadgeCount() {
            const unread = notifications.filter(n => !n.read).length;
            const badge = document.getElementById('notificationBadge');
            
            badge.textContent = unread > 99 ? '99+' : unread;
            
            // Update browser badge if supported
            if ('setAppBadge' in navigator) {
                navigator.setAppBadge(unread).catch(console.error);
            }
            
            // Update title
            document.title = unread > 0 ? `(${unread}) ‡πÅ‡∏≠‡∏õ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô` : '‡πÅ‡∏≠‡∏õ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô';
        }
        
        // Mark notification as read
        function markAsRead(id) {
            const notification = notifications.find(n => n.id === id);
            if (notification && !notification.read) {
                notification.read = true;
                saveNotifications();
                updateNotificationUI();
            }
        }
        
        // Mark all as read
        function markAllAsRead() {
            notifications.forEach(notification => {
                notification.read = true;
            });
            
            saveNotifications();
            updateNotificationUI();
        }
        
        // Clear all notifications
        async function clearAllNotifications() {
            if (notifications.length === 0) return;
            
            if (confirm('‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                notifications = [];
                await saveNotifications();
                updateNotificationUI();
                showToast('‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß', 'info');
            }
        }
        
        // Clear history
        async function clearHistory() {
            if (notifications.length === 0) return;
            
            if (confirm('‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                notifications = [];
                await saveNotifications();
                updateNotificationUI();
                showToast('‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß', 'info');
            }
        }
        
        // Add to history
        function addToHistory(data) {
            const historyItem = {
                id: data.id,
                title: data.title,
                message: data.message,
                time: data.time,
                status: data.status
            };
            
            // In production, save to server
            console.log('Added to history:', historyItem);
        }
        
        // Send to server
        async function sendToServer(notification) {
            try {
                // In production, send to your Node.js server
                const response = await fetch('http://localhost:3000/api/schedule', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(notification)
                });
                
                if (response.ok) {
                    console.log('Notification scheduled on server');
                }
            } catch (error) {
                console.error('Send to server error:', error);
            }
        }
        
        // Check server status
        async function checkServerStatus() {
            const statusDot = document.getElementById('serverStatus');
            const statusText = document.getElementById('serverStatusText');
            
            try {
                // Check if server is running
                const response = await fetch('http://localhost:3000/health', {
                    method: 'GET',
                    mode: 'no-cors'
                });
                
                statusDot.className = 'status-dot active';
                statusText.textContent = '‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
            } catch (error) {
                statusDot.className = 'status-dot inactive';
                statusText.textContent = '‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
            }
        }
        
        // Register service worker
        async function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                try {
                    serviceWorkerRegistration = await navigator.serviceWorker.register('service-worker.js');
                    console.log('Service Worker registered');
                    
                    // Also register Firebase service worker
                    await navigator.serviceWorker.register('firebase-messaging-sw.js');
                    console.log('Firebase Service Worker registered');
                    
                } catch (error) {
                    console.error('Service Worker registration failed:', error);
                }
            }
        }
        
        // Load notifications from storage
        async function loadNotifications() {
            try {
                const saved = localStorage.getItem('notifications');
                if (saved) {
                    notifications = JSON.parse(saved);
                }
            } catch (error) {
                console.error('Load notifications error:', error);
                notifications = [];
            }
        }
        
        // Save notifications to storage
        async function saveNotifications() {
            try {
                localStorage.setItem('notifications', JSON.stringify(notifications));
            } catch (error) {
                console.error('Save notifications error:', error);
            }
        }
        
        // Play notification sound
        function playNotificationSound() {
            try {
                const audio = document.getElementById('notificationSound');
                audio.currentTime = 0;
                audio.play().catch(e => console.log('Cannot play sound:', e));
            } catch (error) {
                console.log('Play sound error:', error);
            }
        }
        
        // Show toast notification
        function showToast(title, type = 'info', message = '') {
            const container = document.getElementById('toastContainer');
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-times-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            
            toast.innerHTML = `
                <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--${type}); display: flex; align-items: center; justify-content: center; color: white;">
                    <i class="fas ${icons[type] || 'fa-info-circle'}"></i>
                </div>
                <div style="flex: 1;">
                    <strong>${title}</strong>
                    ${message ? `<div style="font-size: 0.9rem; margin-top: 5px; color: #666;">${message}</div>` : ''}
                </div>
                <button class="toast-close" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #999; padding: 5px;">&times;</button>
            `;
            
            container.appendChild(toast);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.style.opacity = '0';
                    setTimeout(() => {
                        if (toast.parentNode) toast.parentNode.removeChild(toast);
                    }, 300);
                }
            }, 5000);
            
            // Close button
            toast.querySelector('.toast-close').addEventListener('click', () => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    if (toast.parentNode) toast.parentNode.removeChild(toast);
                }, 300);
            });
        }
    </script>
</body>
</html>
