<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏£‡∏ß‡∏°‡∏®‡∏π‡∏ô‡∏¢‡πå</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <style>
        body {
            background-color: #121826;
            color: #e5e7eb;
            font-family: 'Sarabun', sans-serif;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Prompt', sans-serif;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .slide-in {
            animation: slideInRight 0.3s ease-out;
        }
        
        .status-connected { color: #10b981; }
        .status-disconnected { color: #ef4444; }
        .status-connecting { color: #f59e0b; }
        
        /* iOS-like notification badge */
        .notification-badge {
            background-color: #FF3B30;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 12px;
            font-weight: bold;
            position: absolute;
            top: -5px;
            right: -5px;
            min-width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Mobile app style */
        @media (max-width: 768px) {
            .container {
                padding-left: 16px;
                padding-right: 16px;
            }
            
            .mobile-hidden {
                display: none !important;
            }
        }
        
        /* App icon for mobile */
        .app-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        /* Broadcast section styling */
        .broadcast-section {
            background: linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%);
        }
        
        /* FAB for mobile */
        .fab {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
            z-index: 40;
            border: none;
            cursor: pointer;
        }
        
        /* Custom Swal2 styles */
        .swal2-popup {
            font-family: 'Sarabun', sans-serif !important;
            border-radius: 1rem !important;
            background-color: #1f2937 !important;
            color: #e5e7eb !important;
        }
        
        .swal2-title {
            font-family: 'Prompt', sans-serif !important;
            color: #e5e7eb !important;
        }
        
        .swal2-html-container {
            color: #9ca3af !important;
        }
        
        .swal2-confirm {
            background-color: #3b82f6 !important;
        }
        
        .swal2-cancel {
            background-color: #6b7280 !important;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1f2937;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
    
    <!-- Floating Action Button for Mobile -->
    <button id="fabNotification" class="fab md:hidden">
        <i class="fas fa-bell"></i>
        <div id="fabBadge" class="notification-badge hidden">0</div>
    </button>
    
    <!-- App Icon for Mobile (PWA) -->
    <div id="appIcon" class="fixed bottom-6 right-6 z-50 app-icon mobile-hidden">
        <i class="fas fa-bell"></i>
        <div id="mobileBadge" class="notification-badge hidden">0</div>
    </div>
    
    <!-- Install Prompt for PWA -->
    <div id="installPrompt" class="hidden fixed bottom-20 right-6 bg-gray-800 rounded-xl p-4 shadow-2xl max-w-xs border border-gray-700 z-50">
        <div class="flex items-center mb-3">
            <div class="app-icon mr-3">
                <i class="fas fa-bell"></i>
            </div>
            <div>
                <h4 class="font-bold text-white">‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏≠‡∏õ</h4>
                <p class="text-gray-400 text-sm">‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï</p>
            </div>
        </div>
        <div class="flex space-x-2">
            <button id="installBtn" class="flex-1 bg-blue-600 hover:bg-blue-500 text-white py-2 rounded-lg text-sm">
                ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á
            </button>
            <button id="closeInstallBtn" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm">
                ‡∏õ‡∏¥‡∏î
            </button>
        </div>
    </div>
    
    <!-- Mobile Navigation -->
    <div id="mobileNav" class="md:hidden fixed bottom-0 left-0 right-0 bg-gray-900 border-t border-gray-800 z-40">
        <div class="flex justify-around p-3">
            <button class="flex flex-col items-center text-gray-400 hover:text-white" onclick="scrollToForm()">
                <i class="fas fa-clock text-xl mb-1"></i>
                <span class="text-xs">‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤</span>
            </button>
            <button class="flex flex-col items-center text-gray-400 hover:text-white" onclick="scrollToAlarms()">
                <i class="fas fa-list text-xl mb-1"></i>
                <span class="text-xs">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
            </button>
            <button id="mobileNotificationBtn" class="flex flex-col items-center text-gray-400 hover:text-white relative">
                <i class="fas fa-bell text-xl mb-1"></i>
                <span class="text-xs">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</span>
                <div id="mobileNavBadge" class="notification-badge hidden">0</div>
            </button>
            <button class="flex flex-col items-center text-gray-400 hover:text-white" onclick="scrollToBroadcast()">
                <i class="fas fa-broadcast-tower text-xl mb-1"></i>
                <span class="text-xs">‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</span>
            </button>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8 max-w-4xl pb-24 md:pb-8">
        <header class="flex justify-between items-center mb-10">
            <div>
                <h1 class="text-3xl font-bold text-blue-400">
                    <i class="fas fa-bell mr-3"></i>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏£‡∏ß‡∏°‡∏®‡∏π‡∏ô‡∏¢‡πå
                </h1>
                <p class="text-gray-400 mt-2">‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô, ‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô, ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheets</p>
            </div>
            
            <div class="flex items-center space-x-4">
                <!-- Connection Status -->
                <div id="connectionStatus" class="md:flex items-center hidden">
                    <div id="statusDot" class="w-3 h-3 rounded-full bg-green-500 mr-2 pulse"></div>
                    <span id="statusText" class="text-sm status-connected">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets</span>
                </div>
                
                <!-- Notification badge -->
                <div class="relative">
                    <button id="notificationBtn" class="bg-gray-800 hover:bg-gray-700 p-3 rounded-full transition duration-200">
                        <i class="fas fa-bell text-xl"></i>
                        <div id="notificationBadge" class="notification-badge hidden">0</div>
                    </button>
                </div>
            </div>
        </header>

        <!-- Message Display -->
        <div id="msg" class="mb-4 p-4 rounded-lg"></div>

        <!-- Google Sheets Status -->
        <div class="mb-8 bg-green-900 rounded-2xl p-6 shadow-xl border-2 border-green-500">
            <h2 class="text-2xl font-bold text-green-300 mb-4">
                <i class="fas fa-check-circle mr-2"></i>‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
            </h2>
            <div class="bg-green-800 rounded-lg p-4">
                <p class="text-green-200 mb-2">
                    <i class="fas fa-info-circle mr-2"></i>
                    ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏•‡∏á Google Sheets ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                </p>
                <p class="text-green-300 text-sm">
                    ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheets ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                </p>
                <div class="mt-3 flex items-center text-green-400">
                    <i class="fas fa-sync-alt mr-2"></i>
                    <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß: <span id="syncCount">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                </div>
                <div class="mt-2 flex items-center text-green-300">
                    <i class="fas fa-users mr-2"></i>
                    <span>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <span id="totalUsers">1</span> ‡∏Ñ‡∏ô</span>
                </div>
                <div class="mt-2 flex items-center text-green-400">
                    <i class="fas fa-broadcast-tower mr-2"></i>
                    <span>‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <span id="totalBroadcasts">0</span> ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</span>
                </div>
            </div>
        </div>

        <!-- Broadcast Notification Section -->
        <div id="broadcastSection" class="mb-8 bg-purple-900 rounded-2xl p-6 shadow-xl border-2 border-purple-500">
            <h2 class="text-2xl font-bold text-purple-300 mb-4">
                <i class="fas fa-broadcast-tower mr-2"></i>‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô
            </h2>
            <div class="bg-purple-800 rounded-lg p-4">
                <p class="text-purple-200 mb-4">
                    <i class="fas fa-info-circle mr-2"></i>
                    ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ (‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ö‡∏ô‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô)
                </p>
                <div class="mb-4">
                    <label class="block text-purple-200 mb-2" for="broadcastTitle">
                        <i class="fas fa-heading mr-2"></i>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®
                    </label>
                    <input 
                        type="text" 
                        id="broadcastTitle" 
                        class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                        placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏î‡πà‡∏ß‡∏ô, ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß"
                        maxlength="50"
                    >
                </div>
                <div class="mb-4">
                    <label class="block text-purple-200 mb-2" for="broadcastMessage">
                        <i class="fas fa-comment-alt mr-2"></i>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®
                    </label>
                    <textarea 
                        id="broadcastMessage" 
                        rows="3"
                        class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                        placeholder="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô"
                        maxlength="200"
                    ></textarea>
                </div>
                <div class="flex space-x-3">
                    <button id="sendBroadcastBtn" class="flex-1 py-3 bg-purple-600 hover:bg-purple-500 text-white rounded-lg transition duration-200">
                        <i class="fas fa-paper-plane mr-2"></i>‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÑ‡∏õ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô
                    </button>
                    <button id="testBroadcastBtn" class="px-4 py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg transition duration-200">
                        <i class="fas fa-bell mr-2"></i>‡∏ó‡∏î‡∏™‡∏≠‡∏ö
                    </button>
                    <button id="clearBroadcastBtn" class="px-4 py-3 bg-red-600 hover:bg-red-500 text-white rounded-lg transition duration-200">
                        <i class="fas fa-trash mr-2"></i>‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
                    </button>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left column: Form for setting alarms -->
            <div class="lg:col-span-2 bg-gray-900 rounded-2xl p-6 shadow-xl">
                <h2 class="text-2xl font-bold text-blue-300 mb-6">
                    <i class="fas fa-clock mr-2"></i>‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß
                </h2>
                
                <form id="alarmForm" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Date picker -->
                        <div>
                            <label class="block text-gray-300 mb-2" for="date">
                                <i class="fas fa-calendar-alt mr-2"></i>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
                            </label>
                            <input 
                                type="date" 
                                id="date" 
                                class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                min="" 
                                required
                            >
                        </div>
                        
                        <!-- Time picker -->
                        <div>
                            <label class="block text-gray-300 mb-2" for="time">
                                <i class="fas fa-clock mr-2"></i>‡πÄ‡∏ß‡∏•‡∏≤
                            </label>
                            <input 
                                type="time" 
                                id="time" 
                                class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                required
                            >
                        </div>
                    </div>
                    
                    <!-- Title input -->
                    <div>
                        <label class="block text-gray-300 mb-2" for="title">
                            <i class="fas fa-heading mr-2"></i>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                        </label>
                        <input 
                            type="text" 
                            id="title" 
                            class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏ó‡∏µ‡∏°, ‡∏ô‡∏±‡∏î‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå"
                            maxlength="50"
                            required
                        >
                    </div>
                    
                    <!-- Description input -->
                    <div>
                        <label class="block text-gray-300 mb-2" for="description">
                            <i class="fas fa-file-alt mr-2"></i>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                        </label>
                        <textarea 
                            id="description" 
                            rows="3"
                            class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô"
                            maxlength="200"
                        ></textarea>
                    </div>
                    
                    <!-- Repeat options -->
                    <div>
                        <label class="block text-gray-300 mb-2">
                            <i class="fas fa-redo mr-2"></i>‡∏ó‡∏≥‡∏ã‡πâ‡∏≥
                        </label>
                        <div class="flex flex-wrap gap-3">
                            <label class="inline-flex items-center">
                                <input type="radio" name="repeat" value="none" class="mr-2" checked>
                                <span>‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏ã‡πâ‡∏≥</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="repeat" value="daily" class="mr-2">
                                <span>‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="repeat" value="weekly" class="mr-2">
                                <span>‡∏ó‡∏∏‡∏Å‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="repeat" value="monthly" class="mr-2">
                                <span>‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Action buttons -->
                    <div class="flex justify-between pt-4">
                        <button type="button" id="clearBtn" class="px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg transition duration-200">
                            <i class="fas fa-trash mr-2"></i>‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤
                        </button>
                        <button type="submit" class="px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white rounded-lg transition duration-200 flex items-center">
                            <i class="fas fa-plus-circle mr-2"></i>‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                        </button>
                    </div>
                </form>
                
                <!-- Current time display -->
                <div class="mt-8 pt-6 border-t border-gray-700">
                    <div class="flex items-center justify-center">
                        <div class="text-center">
                            <p class="text-gray-400 mb-2">‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</p>
                            <div id="currentTime" class="text-3xl font-bold text-green-400"></div>
                            <div id="currentDate" class="text-gray-400 mt-2"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right column: List of active alarms -->
            <div id="alarmsSection" class="bg-gray-900 rounded-2xl p-6 shadow-xl">
                <h2 class="text-2xl font-bold text-blue-300 mb-6">
                    <i class="fas fa-list mr-2"></i>‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ
                </h2>
                
                <div id="activeAlarms" class="space-y-4 max-h-[500px] overflow-y-auto pr-2">
                    <!-- Alarms will be displayed here -->
                    <div class="text-center py-10 text-gray-500">
                        <i class="fas fa-clock text-4xl mb-4"></i>
                        <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ</p>
                        <p class="text-sm mt-2">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢</p>
                    </div>
                </div>
                
                <div class="mt-8 pt-6 border-t border-gray-700">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-gray-400">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                            <p id="totalAlarms" class="text-xl font-bold">0</p>
                        </div>
                        <button id="clearAllBtn" class="px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm transition duration-200">
                            ‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Background service status -->
        <div class="mt-8 bg-gray-900 rounded-xl p-4 flex items-center justify-between">
            <div class="flex items-center">
                <div id="serviceStatus" class="w-3 h-3 rounded-full bg-green-500 mr-3 pulse"></div>
                <div>
                    <p class="font-medium">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà</p>
                    <p class="text-sm text-gray-400">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheets ‚Ä¢ ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ö‡∏ô‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô ‚Ä¢ ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á</p>
                </div>
            </div>
            <div class="text-right">
                <p id="nextAlarmTime" class="text-sm text-gray-400">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ: ‡πÑ‡∏°‡πà‡∏°‡∏µ</p>
                <p id="unreadCountDisplay" class="text-xs text-blue-400">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏≠‡πà‡∏≤‡∏ô: <span>0</span></p>
            </div>
        </div>
        
        <!-- Demo notification -->
        <div id="demoNotification" class="hidden fixed bottom-4 right-4 max-w-sm bg-gray-800 border-l-4 border-blue-500 rounded-lg shadow-xl p-4 z-40 slide-in">
            <div class="flex justify-between">
                <div class="flex-1">
                    <h4 class="font-bold text-blue-300" id="demoTitle"></h4>
                    <p class="text-gray-300 text-sm mt-1" id="demoDesc"></p>
                    <p class="text-gray-500 text-xs mt-2">
                        <i class="far fa-clock mr-1"></i>
                        <span id="demoTime"></span>
                    </p>
                </div>
                <button class="text-gray-500 hover:text-white ml-4" id="closeDemoBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Application Script -->
    <script>
        // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ GOOGLE_SCRIPT_URL ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwpOYJ_pB6Llu9bd7RJABMd0awxu09oVFPB1cK4zsq3-aBYze5EpSHTSGgO1EcSJ3DwpQ/exec";
        
        // DOM Elements
        const alarmForm = document.getElementById('alarmForm');
        const dateInput = document.getElementById('date');
        const timeInput = document.getElementById('time');
        const titleInput = document.getElementById('title');
        const descriptionInput = document.getElementById('description');
        const currentTimeElement = document.getElementById('currentTime');
        const currentDateElement = document.getElementById('currentDate');
        const activeAlarms = document.getElementById('activeAlarms');
        const totalAlarmsElement = document.getElementById('totalAlarms');
        const nextAlarmTimeElement = document.getElementById('nextAlarmTime');
        const syncCountElement = document.getElementById('syncCount');
        const clearAllBtn = document.getElementById('clearAllBtn');
        const clearBtn = document.getElementById('clearBtn');
        const demoNotification = document.getElementById('demoNotification');
        const demoTitle = document.getElementById('demoTitle');
        const demoDesc = document.getElementById('demoDesc');
        const demoTime = document.getElementById('demoTime');
        const closeDemoBtn = document.getElementById('closeDemoBtn');
        const statusText = document.getElementById('statusText');
        
        // Broadcast elements
        const broadcastTitle = document.getElementById('broadcastTitle');
        const broadcastMessage = document.getElementById('broadcastMessage');
        const sendBroadcastBtn = document.getElementById('sendBroadcastBtn');
        const testBroadcastBtn = document.getElementById('testBroadcastBtn');
        const clearBroadcastBtn = document.getElementById('clearBroadcastBtn');
        const totalUsersElement = document.getElementById('totalUsers');
        const totalBroadcastsElement = document.getElementById('totalBroadcasts');
        
        // State variables
        let alarms = JSON.parse(localStorage.getItem('alarms')) || [];
        let alarmCheckInterval;
        let userId = localStorage.getItem('userId') || generateUserId();
        let userName = localStorage.getItem('userName') || `‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ${Math.floor(Math.random() * 1000)}`;
        
        // SweetAlert2 configuration
        const SwalConfig = {
            confirmButtonText: '‡πÉ‡∏ä‡πà, ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô',
            cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
            confirmButtonColor: '#3b82f6',
            cancelButtonColor: '#6b7280',
            reverseButtons: true
        };
        
        // Initialize the app
        function init() {
            console.log('üöÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô...');
            
            // Generate user ID if not exists
            if (!localStorage.getItem('userId')) {
                localStorage.setItem('userId', userId);
                localStorage.setItem('userName', userName);
            }
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            dateInput.min = today;
            dateInput.value = today;
            
            // Set default time to next hour
            const nextHour = new Date();
            nextHour.setHours(nextHour.getHours() + 1);
            timeInput.value = `${nextHour.getHours().toString().padStart(2, '0')}:00`;
            
            updateCurrentTime();
            renderAlarms();
            updateSyncCount();
            
            // Check alarms every second
            alarmCheckInterval = setInterval(checkAlarms, 1000);
            
            // Update current time every second
            setInterval(updateCurrentTime, 1000);
            
            // Request notification permission
            if ('Notification' in window && Notification.permission === 'default') {
                setTimeout(() => {
                    Notification.requestPermission();
                }, 2000);
            }
            
            // Load broadcast messages
            loadBroadcastMessages();
            
            // Test connection
            testConnection();
            
            console.log('‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        }
        
        // Generate unique user ID
        function generateUserId() {
            return 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        // Update current time display
        function updateCurrentTime() {
            const now = new Date();
            currentTimeElement.textContent = now.toLocaleTimeString('th-TH', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            currentDateElement.textContent = now.toLocaleDateString('th-TH', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Update sync count display
        function updateSyncCount() {
            const syncCount = alarms.filter(alarm => alarm.synced).length;
            syncCountElement.textContent = syncCount;
        }
        
        // Render active alarms
        function renderAlarms() {
            console.log('üìã ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:', alarms.length, '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
            
            if (alarms.length === 0) {
                activeAlarms.innerHTML = `
                    <div class="text-center py-10 text-gray-500">
                        <i class="fas fa-clock text-4xl mb-4"></i>
                        <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ</p>
                        <p class="text-sm mt-2">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢</p>
                    </div>
                `;
                totalAlarmsElement.textContent = '0';
                nextAlarmTimeElement.textContent = '‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ: ‡πÑ‡∏°‡πà‡∏°‡∏µ';
                return;
            }
            
            // Sort alarms by datetime
            alarms.sort((a, b) => new Date(a.datetime) - new Date(b.datetime));
            activeAlarms.innerHTML = '';
            let nextAlarm = null;
            
            alarms.forEach((alarm, index) => {
                const alarmDate = new Date(alarm.datetime);
                const now = new Date();
                const isPast = alarmDate < now;
                
                if (!nextAlarm && !isPast && !alarm.triggered) {
                    nextAlarm = alarm;
                }
                
                const alarmElement = document.createElement('div');
                alarmElement.className = `bg-gray-800 rounded-xl p-4 border-l-4 ${isPast ? 'border-gray-600' : 'border-blue-500'} ${alarm.triggered ? 'opacity-70' : ''}`;
                alarmElement.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h3 class="font-bold ${isPast ? 'text-gray-400' : 'text-white'}">${alarm.title}</h3>
                            <p class="text-gray-400 text-sm mt-1">${alarm.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î'}</p>
                            <div class="flex items-center mt-3">
                                <span class="text-xs px-2 py-1 rounded ${isPast ? 'bg-gray-700 text-gray-400' : 'bg-blue-900 text-blue-300'}">
                                    <i class="far fa-clock mr-1"></i>
                                    ${alarmDate.toLocaleDateString('th-TH')} ${alarmDate.toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'})}
                                </span>
                                ${alarm.repeat !== 'none' ? 
                                    `<span class="text-xs px-2 py-1 rounded bg-purple-900 text-purple-300 ml-2">
                                        <i class="fas fa-redo mr-1"></i>${getRepeatText(alarm.repeat)}
                                    </span>` : ''
                                }
                                ${alarm.triggered ? 
                                    `<span class="text-xs px-2 py-1 rounded bg-green-900 text-green-300 ml-2">
                                        <i class="fas fa-check mr-1"></i>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß
                                    </span>` : ''
                                }
                                ${alarm.synced ? 
                                    `<span class="text-xs px-2 py-1 rounded bg-green-900 text-green-300 ml-2">
                                        <i class="fas fa-cloud mr-1"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß
                                    </span>` : ''
                                }
                            </div>
                        </div>
                        <button class="delete-alarm ml-2 text-gray-500 hover:text-red-400" data-index="${index}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                activeAlarms.appendChild(alarmElement);
            });
            
            // Update next alarm display
            if (nextAlarm) {
                const nextAlarmDate = new Date(nextAlarm.datetime);
                nextAlarmTimeElement.textContent = `‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ: ${nextAlarmDate.toLocaleDateString('th-TH')} ${nextAlarmDate.toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'})}`;
            } else {
                nextAlarmTimeElement.textContent = '‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ: ‡πÑ‡∏°‡πà‡∏°‡∏µ';
            }
            
            totalAlarmsElement.textContent = alarms.length;
            
            // Add event listeners for delete buttons
            document.querySelectorAll('.delete-alarm').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    deleteAlarm(index);
                });
            });
        }
        
        // Get repeat option text
        function getRepeatText(repeatValue) {
            const repeatMap = {
                'none': '‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏ã‡πâ‡∏≥',
                'daily': '‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô',
                'weekly': '‡∏ó‡∏∏‡∏Å‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå',
                'monthly': '‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'
            };
            return repeatMap[repeatValue] || repeatValue;
        }
        
        // Check for alarms that need to be triggered
        function checkAlarms() {
            const now = new Date();
            
            alarms.forEach((alarm, index) => {
                const alarmDate = new Date(alarm.datetime);
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á ‡πÅ‡∏•‡∏∞‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
                if (!alarm.triggered && alarmDate <= now) {
                    console.log('üö® ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡πâ‡∏ß:', alarm.title);
                    triggerAlarm(index);
                    
                    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö‡∏ó‡∏≥‡∏ã‡πâ‡∏≥ ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡∏°‡πà
                    if (alarm.repeat !== 'none') {
                        rescheduleRepeatingAlarm(index);
                    }
                }
            });
        }
        
        // Trigger an alarm
        function triggerAlarm(index) {
            const alarm = alarms[index];
            
            console.log('üîî ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:', alarm.title);
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
            alarms[index].triggered = true;
            alarms[index].triggered_at = new Date().toISOString();
            localStorage.setItem('alarms', JSON.stringify(alarms));
            
            // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheets ‡∏ß‡πà‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß
            saveToGoogleSheets(alarm, 'triggered');
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
            renderAlarms();
            updateSyncCount();
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            showNotification(alarm);
            
            // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            playNotificationSound();
        }
        
        // Save data to Google Sheets
        async function saveToGoogleSheets(alarmData, status = 'created') {
            try {
                console.log('üì§ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheets:', alarmData.title);
                
                const payload = {
                    action: 'add',
                    date: alarmData.date || new Date(alarmData.datetime).toLocaleDateString('th-TH'),
                    time: alarmData.time || new Date(alarmData.datetime).toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'}),
                    title: alarmData.title,
                    description: alarmData.description || '',
                    repeat: alarmData.repeat || 'none',
                    status: status,
                    triggered_at: alarmData.triggered_at || '',
                    user_id: userId,
                    user_name: userName,
                    alarm_id: alarmData.id || ''
                };
                
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á URL parameters
                const params = new URLSearchParams();
                for (const key in payload) {
                    params.append(key, payload[key]);
                }
                
                // ‡πÉ‡∏ä‡πâ GET request
                const response = await fetch(GOOGLE_SCRIPT_URL + '?' + params.toString(), {
                    method: "GET"
                });
                
                const data = await response.text();
                console.log('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', data);
                
                // Mark the alarm as synced
                const alarmIndex = alarms.findIndex(a => a.id === alarmData.id);
                if (alarmIndex !== -1) {
                    alarms[alarmIndex].synced = true;
                    localStorage.setItem('alarms', JSON.stringify(alarms));
                    updateSyncCount();
                }
                
                return true;
            } catch (error) {
                console.error('‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheets:', error);
                return false;
            }
        }
        
        // Delete from Google Sheets
        async function deleteFromGoogleSheets(alarmId) {
            try {
                console.log('üóëÔ∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö‡∏à‡∏≤‡∏Å Google Sheets:', alarmId);
                
                const payload = {
                    action: 'delete',
                    alarm_id: alarmId,
                    user_id: userId
                };
                
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á URL parameters
                const params = new URLSearchParams();
                for (const key in payload) {
                    params.append(key, payload[key]);
                }
                
                const response = await fetch(GOOGLE_SCRIPT_URL + '?' + params.toString(), {
                    method: "GET"
                });
                
                const data = await response.text();
                console.log('‚úÖ ‡∏•‡∏ö‡∏à‡∏≤‡∏Å Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', data);
                return true;
            } catch (error) {
                console.error('‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏à‡∏≤‡∏Å Google Sheets:', error);
                return false;
            }
        }
        
        // Show notification
        function showNotification(alarm) {
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(`‚è∞ ${alarm.title}`, {
                    body: alarm.description || '‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏∂‡∏á‡πÅ‡∏•‡πâ‡∏ß!',
                    icon: 'https://cdn-icons-png.flaticon.com/512/565/565422.png',
                    tag: 'alarm-notification'
                });
            }
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
            showInAppNotification(alarm);
        }
        
        // Show in-app notification
        function showInAppNotification(alarm) {
            demoTitle.textContent = `‚è∞ ${alarm.title}`;
            demoDesc.textContent = alarm.description || '‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏∂‡∏á‡πÅ‡∏•‡πâ‡∏ß!';
            demoTime.textContent = new Date().toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'});
            
            demoNotification.classList.remove('hidden');
            
            // ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            setTimeout(() => {
                demoNotification.classList.add('hidden');
            }, 10000);
        }
        
        // Play notification sound
        function playNotificationSound() {
            try {
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏á‡πà‡∏≤‡∏¢‡πÜ
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.1);
                gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                console.log("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏î‡πâ:", e);
            }
        }
        
        // Reschedule repeating alarm
        function rescheduleRepeatingAlarm(index) {
            const alarm = alarms[index];
            const alarmDate = new Date(alarm.datetime);
            
            switch (alarm.repeat) {
                case 'daily':
                    alarmDate.setDate(alarmDate.getDate() + 1);
                    break;
                case 'weekly':
                    alarmDate.setDate(alarmDate.getDate() + 7);
                    break;
                case 'monthly':
                    alarmDate.setMonth(alarmDate.getMonth() + 1);
                    break;
            }
            
            const newAlarm = {
                id: Date.now(),
                title: alarm.title,
                description: alarm.description,
                date: alarm.date,
                time: alarm.time,
                datetime: alarmDate.toISOString(),
                repeat: alarm.repeat,
                triggered: false,
                synced: false
            };
            
            alarms.push(newAlarm);
            localStorage.setItem('alarms', JSON.stringify(alarms));
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheets
            saveToGoogleSheets(newAlarm, 'created');
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
            renderAlarms();
        }
        
        // Delete an alarm
        async function deleteAlarm(index) {
            const alarm = alarms[index];
            
            // ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö
            const result = await Swal.fire({
                icon: 'warning',
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö',
                html: `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô<br>
                      <strong>"${alarm.title}"</strong><br>
                      ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${new Date(alarm.datetime).toLocaleDateString('th-TH')} ‡πÄ‡∏ß‡∏•‡∏≤ ${new Date(alarm.datetime).toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'})}?<br>
                      <small class="text-gray-400">(‡∏à‡∏∞‡∏•‡∏ö‡∏à‡∏≤‡∏Å Google Sheets ‡∏î‡πâ‡∏ß‡∏¢)</small>`,
                showCancelButton: true,
                confirmButtonText: '‡πÉ‡∏ä‡πà, ‡∏•‡∏ö‡∏ó‡∏±‡∏ô‡∏ó‡∏µ',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                ...SwalConfig
            });
            
            if (!result.isConfirmed) return;
            
            // ‡∏•‡∏ö‡∏à‡∏≤‡∏Å Google Sheets ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ
            if (alarm.synced) {
                const deleted = await deleteFromGoogleSheets(alarm.id);
                if (!deleted) {
                    Swal.fire({
                        icon: 'warning',
                        title: '‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô',
                        text: '‡∏•‡∏ö‡∏à‡∏≤‡∏Å Google Sheets ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÅ‡∏ï‡πà‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß',
                        ...SwalConfig
                    });
                }
            }
            
            // ‡∏•‡∏ö‡∏à‡∏≤‡∏Å localStorage
            alarms.splice(index, 1);
            localStorage.setItem('alarms', JSON.stringify(alarms));
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
            renderAlarms();
            updateSyncCount();
            
            Swal.fire({
                icon: 'success',
                title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                text: '‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                ...SwalConfig
            });
        }
        
        // Clear all alarms
        async function clearAllAlarms() {
            if (alarms.length === 0) {
                Swal.fire({
                    icon: 'info',
                    title: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ',
                    text: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö',
                    ...SwalConfig
                });
                return;
            }
            
            const result = await Swal.fire({
                icon: 'warning',
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
                html: `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <strong>${alarms.length}</strong> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?<br>
                      <small class="text-gray-400">(‡∏à‡∏∞‡∏•‡∏ö‡∏à‡∏≤‡∏Å Google Sheets ‡∏î‡πâ‡∏ß‡∏¢)</small>`,
                showCancelButton: true,
                confirmButtonText: '‡πÉ‡∏ä‡πà, ‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                ...SwalConfig
            });
            
            if (!result.isConfirmed) return;
            
            // ‡∏•‡∏ö‡∏à‡∏≤‡∏Å Google Sheets ‡∏ó‡∏∏‡∏Å‡∏≠‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ
            let deleteCount = 0;
            for (const alarm of alarms) {
                if (alarm.synced) {
                    const deleted = await deleteFromGoogleSheets(alarm.id);
                    if (deleted) deleteCount++;
                }
            }
            
            // ‡∏•‡∏ö‡∏à‡∏≤‡∏Å localStorage
            alarms = [];
            localStorage.setItem('alarms', JSON.stringify(alarms));
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
            renderAlarms();
            updateSyncCount();
            
            Swal.fire({
                icon: 'success',
                title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                text: `‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß (‡∏•‡∏ö ${deleteCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≤‡∏Å Google Sheets)`,
                ...SwalConfig
            });
        }
        
        // Form submission handler
        alarmForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const title = titleInput.value.trim();
            const description = descriptionInput.value.trim();
            const date = dateInput.value;
            const time = timeInput.value;
            const repeat = document.querySelector('input[name="repeat"]:checked').value;
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            if (!title || !date || !time) {
                Swal.fire({
                    icon: 'error',
                    title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö (‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠, ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà, ‡πÄ‡∏ß‡∏•‡∏≤)',
                    ...SwalConfig
                });
                return;
            }
            
            const datetime = new Date(`${date}T${time}`);
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (datetime <= new Date()) {
                Swal.fire({
                    icon: 'warning',
                    title: '‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï',
                    ...SwalConfig
                });
                return;
            }
            
            const alarm = {
                id: Date.now(),
                title,
                description,
                date,
                time,
                datetime: datetime.toISOString(),
                repeat,
                triggered: false,
                synced: false
            };
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            alarms.push(alarm);
            localStorage.setItem('alarms', JSON.stringify(alarms));
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheets
            const saved = await saveToGoogleSheets(alarm, 'created');
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
            alarmForm.reset();
            dateInput.value = new Date().toISOString().split('T')[0];
            const nextHour = new Date();
            nextHour.setHours(nextHour.getHours() + 1);
            timeInput.value = `${nextHour.getHours().toString().padStart(2, '0')}:00`;
            document.querySelector('input[name="repeat"][value="none"]').checked = true;
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
            renderAlarms();
            
            Swal.fire({
                icon: 'success',
                title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                text: `‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô "${title}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!${saved ? ' (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô Google Sheets ‡πÅ‡∏•‡πâ‡∏ß)' : ' (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö)'}`,
                ...SwalConfig
            });
        });
        
        // Clear form button
        clearBtn.addEventListener('click', function() {
            alarmForm.reset();
            dateInput.value = new Date().toISOString().split('T')[0];
            const nextHour = new Date();
            nextHour.setHours(nextHour.getHours() + 1);
            timeInput.value = `${nextHour.getHours().toString().padStart(2, '0')}:00`;
            document.querySelector('input[name="repeat"][value="none"]').checked = true;
            
            Swal.fire({
                icon: 'success',
                title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                text: '‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                ...SwalConfig
            });
        });
        
        // Clear all alarms button
        clearAllBtn.addEventListener('click', clearAllAlarms);
        
        // Close demo notification button
        closeDemoBtn.addEventListener('click', function() {
            demoNotification.classList.add('hidden');
        });
        
        // Load broadcast messages
        function loadBroadcastMessages() {
            const broadcastDB = JSON.parse(localStorage.getItem('broadcastDB')) || {
                messages: [],
                lastUpdated: new Date().toISOString()
            };
            
            // Update broadcast count display
            totalBroadcastsElement.textContent = broadcastDB.messages.length;
            totalUsersElement.textContent = 1; // Default user count
        }
        
        // Send broadcast message
        async function sendBroadcastToAll(title, message) {
            try {
                // Create broadcast message
                const broadcastMessage = {
                    id: 'broadcast_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    title: title,
                    message: message,
                    sender: userId,
                    senderName: userName,
                    timestamp: new Date().toISOString(),
                    readBy: []
                };
                
                // Get existing broadcast database
                const broadcastDB = JSON.parse(localStorage.getItem('broadcastDB')) || {
                    messages: [],
                    lastUpdated: new Date().toISOString()
                };
                
                // Add new message at the beginning
                broadcastDB.messages.unshift(broadcastMessage);
                
                // Keep only last 100 messages
                if (broadcastDB.messages.length > 100) {
                    broadcastDB.messages = broadcastDB.messages.slice(0, 100);
                }
                
                broadcastDB.lastUpdated = new Date().toISOString();
                
                // Save to local storage
                localStorage.setItem('broadcastDB', JSON.stringify(broadcastDB));
                
                // Update broadcast count display
                totalBroadcastsElement.textContent = broadcastDB.messages.length;
                
                // Save to Google Sheets for record
                const sheetResult = await saveBroadcastToGoogleSheets(title, message);
                
                // Show success message
                Swal.fire({
                    icon: 'success',
                    title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                    text: `‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® "${title}" ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!${sheetResult ? ' (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô Google Sheets)' : ' (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö)'}`,
                    ...SwalConfig
                });
                
                // Show notification
                demoTitle.textContent = `üì¢ ${title}`;
                demoDesc.textContent = message;
                demoTime.textContent = new Date().toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'});
                demoNotification.classList.remove('hidden');
                
                return true;
            } catch (error) {
                console.error('Error sending broadcast:', error);
                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÑ‡∏î‡πâ: ' + error.message,
                    ...SwalConfig
                });
                return false;
            }
        }
        
        // Save broadcast to Google Sheets
        async function saveBroadcastToGoogleSheets(title, message) {
            try {
                const payload = {
                    action: 'add',
                    date: new Date().toLocaleDateString('th-TH'),
                    time: new Date().toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'}),
                    title: `üì¢ ${title}`,
                    description: message,
                    repeat: 'none',
                    status: 'broadcast',
                    triggered_at: new Date().toISOString(),
                    broadcast: true,
                    user_id: userId,
                    user_name: userName
                };
                
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á URL parameters
                const params = new URLSearchParams();
                for (const key in payload) {
                    params.append(key, payload[key]);
                }
                
                const response = await fetch(GOOGLE_SCRIPT_URL + '?' + params.toString(), {
                    method: "GET"
                });
                
                const data = await response.text();
                console.log('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏•‡∏á Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', data);
                return true;
            } catch (error) {
                console.error('‚ùå Error saving broadcast to Google Sheets:', error);
                return false;
            }
        }
        
        // Test broadcast
        function testBroadcast(title, message) {
            const testMessage = {
                id: 'test_' + Date.now(),
                title: title || '‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®',
                message: message || '‡∏ô‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®',
                sender: 'system',
                senderName: '‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö',
                timestamp: new Date().toISOString(),
                readBy: []
            };
            
            // Show notification
            demoTitle.textContent = `üì¢ ${testMessage.title}`;
            demoDesc.textContent = testMessage.message;
            demoTime.textContent = new Date().toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'});
            demoNotification.classList.remove('hidden');
            
            Swal.fire({
                icon: 'success',
                title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                text: '‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                ...SwalConfig
            });
        }
        
        // Send broadcast button
        sendBroadcastBtn.addEventListener('click', async function() {
            const title = broadcastTitle.value.trim();
            const message = broadcastMessage.value.trim();
            
            if (!title || !message) {
                Swal.fire({
                    icon: 'error',
                    title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®',
                    ...SwalConfig
                });
                return;
            }
            
            if (title.length > 50) {
                Swal.fire({
                    icon: 'error',
                    title: '‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ',
                    text: '‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 50 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)',
                    ...SwalConfig
                });
                return;
            }
            
            if (message.length > 200) {
                Swal.fire({
                    icon: 'error',
                    title: '‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ',
                    text: '‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 200 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)',
                    ...SwalConfig
                });
                return;
            }
            
            const result = await Swal.fire({
                icon: 'question',
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®',
                html: `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®<br>
                      <strong>"${title}"</strong><br>
                      ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö?`,
                showCancelButton: true,
                confirmButtonText: '‡πÉ‡∏ä‡πà, ‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                ...SwalConfig
            });
            
            if (result.isConfirmed) {
                await sendBroadcastToAll(title, message);
            }
        });
        
        // Test broadcast button
        testBroadcastBtn.addEventListener('click', function() {
            const title = broadcastTitle.value.trim() || '‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®';
            const message = broadcastMessage.value.trim() || '‡∏ô‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®';
            
            Swal.fire({
                icon: 'info',
                title: '‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®',
                html: `‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ó‡∏î‡∏™‡∏≠‡∏ö:<br>
                      <strong>"${title}"</strong><br>
                      ${message}`,
                showCancelButton: true,
                confirmButtonText: '‡∏™‡πà‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                ...SwalConfig
            }).then((result) => {
                if (result.isConfirmed) {
                    testBroadcast(title, message);
                }
            });
        });
        
        // Clear broadcast form button
        clearBroadcastBtn.addEventListener('click', function() {
            broadcastTitle.value = '';
            broadcastMessage.value = '';
            
            Swal.fire({
                icon: 'success',
                title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                text: '‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                ...SwalConfig
            });
        });
        
        // Test connection
        async function testConnection() {
            try {
                const params = new URLSearchParams({
                    action: 'test',
                    test: 'connection',
                    user_id: userId
                });
                
                const response = await fetch(GOOGLE_SCRIPT_URL + '?' + params.toString(), {
                    method: "GET"
                });
                
                const data = await response.text();
                console.log('‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', data);
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                if (statusText) {
                    statusText.textContent = '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets';
                    statusText.className = 'text-sm status-connected';
                }
                
            } catch (error) {
                console.log('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets ‡πÑ‡∏î‡πâ:', error);
                
                if (statusText) {
                    statusText.textContent = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets';
                    statusText.className = 'text-sm status-disconnected';
                }
            }
        }
        
        // Helper functions for mobile navigation
        function scrollToForm() {
            document.querySelector('#alarmForm').scrollIntoView({ behavior: 'smooth' });
        }
        
        function scrollToAlarms() {
            document.querySelector('#alarmsSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        function scrollToBroadcast() {
            document.querySelector('#broadcastSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Initialize the application
        init();
    </script>
</body>
</html>
