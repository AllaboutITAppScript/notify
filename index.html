<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîî ‡πÅ‡∏≠‡∏õ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üîî</text></svg>">
    
    <style>
        :root {
            --primary: #2196F3;
            --primary-dark: #1976D2;
            --secondary: #FF4081;
            --success: #4CAF50;
            --warning: #FF9800;
            --danger: #f44336;
            --dark: #2C3E50;
            --light: #F5F7FA;
            --gray: #78909C;
            --badge: #FF5252;
            --shadow: 0 4px 20px rgba(0,0,0,0.1);
            --radius: 16px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Prompt', 'Sarabun', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--dark);
            min-height: 100vh;
            padding: 0;
        }
        
        /* Header with Notification Bell */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
        }
        
        .title h1 {
            color: var(--dark);
            font-size: 1.4rem;
            margin-bottom: 5px;
        }
        
        .title p {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        /* Notification Bell */
        .notification-bell-container {
            position: relative;
        }
        
        .notification-bell {
            width: 50px;
            height: 50px;
            background: var(--light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .notification-bell:hover {
            background: white;
            border-color: var(--primary);
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(33, 150, 243, 0.2);
        }
        
        .bell-icon {
            font-size: 22px;
            color: var(--primary);
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--badge);
            color: white;
            font-size: 12px;
            font-weight: bold;
            min-width: 24px;
            height: 24px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 6px;
            border: 3px solid white;
            animation: pulse 2s infinite;
            z-index: 1001;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 82, 82, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(255, 82, 82, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 82, 82, 0); }
        }
        
        /* Notification Panel */
        .notification-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 380px;
            max-height: 500px;
            background: white;
            border-radius: var(--radius);
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            z-index: 999;
            display: none;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.1);
        }
        
        .notification-panel.show {
            display: flex;
            animation: slideDown 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .panel-header {
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .panel-header h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
        }
        
        .panel-actions {
            display: flex;
            gap: 10px;
        }
        
        .panel-body {
            flex: 1;
            overflow-y: auto;
            padding: 0;
        }
        
        .empty-notifications {
            padding: 40px 20px;
            text-align: center;
            color: var(--gray);
        }
        
        .empty-notifications i {
            font-size: 48px;
            margin-bottom: 15px;
            color: #E0E0E0;
            display: block;
        }
        
        /* Notification Items */
        .notification-item {
            padding: 18px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .notification-item:hover {
            background: #f8f9fa;
        }
        
        .notification-item.unread {
            background: #f0f7ff;
        }
        
        .notification-item.unread::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--primary);
            border-radius: 0 2px 2px 0;
        }
        
        .notification-icon {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
        }
        
        .notification-icon.info { background: var(--primary); }
        .notification-icon.success { background: var(--success); }
        .notification-icon.warning { background: var(--warning); }
        .notification-icon.danger { background: var(--danger); }
        
        .notification-content {
            flex: 1;
            min-width: 0;
        }
        
        .notification-title {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 5px;
            font-size: 1rem;
        }
        
        .notification-message {
            color: var(--gray);
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 8px;
        }
        
        .notification-time {
            font-size: 0.75rem;
            color: #90A4AE;
        }
        
        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Status Cards */
        .status-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .card {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }
        
        .card h2 {
            color: var(--primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.3rem;
        }
        
        .card h2 i {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        
        .status-item:last-child {
            border-bottom: none;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 10px;
        }
        
        .status-dot.active {
            background: var(--success);
            animation: blink 1.5s infinite;
        }
        
        .status-dot.inactive {
            background: var(--danger);
        }
        
        .status-dot.waiting {
            background: var(--warning);
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        /* Notification Form */
        .notification-form {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            margin: 25px 0;
            box-shadow: var(--shadow);
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark);
            font-size: 1rem;
        }
        
        .form-label i {
            margin-right: 8px;
            color: var(--primary);
        }
        
        .form-control {
            width: 100%;
            padding: 16px;
            border: 2px solid #E3F2FD;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
            background: #F8F9FA;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }
        
        /* Buttons */
        .btn {
            padding: 16px 28px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(33, 150, 243, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success), #45a049);
            color: white;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #d32f2f);
            color: white;
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(244, 67, 54, 0.3);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #e68900);
            color: white;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 152, 0, 0.3);
        }
        
        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 25px;
        }
        
        /* History */
        .history-section {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            margin: 25px 0;
            box-shadow: var(--shadow);
            max-height: 500px;
            overflow-y: auto;
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .history-item {
            padding: 18px;
            background: #f8f9fa;
            border-radius: 12px;
            margin-bottom: 12px;
            border-left: 4px solid var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .history-item.sent {
            border-left-color: var(--success);
            background: #f1f8e9;
        }
        
        .history-item.pending {
            border-left-color: var(--warning);
            background: #fff8e1;
        }
        
        .history-item.failed {
            border-left-color: var(--danger);
            background: #ffebee;
        }
        
        /* Instructions */
        .instructions {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            margin: 25px 0;
            box-shadow: var(--shadow);
        }
        
        .steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .step {
            text-align: center;
            padding: 25px;
            background: linear-gradient(135deg, #f5f7fa, #e4e8f0);
            border-radius: 12px;
            transition: transform 0.3s;
        }
        
        .step:hover {
            transform: translateY(-5px);
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin: 0 auto 15px;
        }
        
        /* Toast */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 10px;
        }
        
        .toast {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 15px;
            animation: slideInRight 0.3s;
            border-left: 5px solid var(--success);
            min-width: 320px;
            max-width: 400px;
        }
        
        .toast.error { border-left-color: var(--danger); }
        .toast.warning { border-left-color: var(--warning); }
        .toast.info { border-left-color: var(--primary); }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Footer */
        .footer {
            text-align: center;
            color: white;
            padding: 30px 20px;
            margin-top: 40px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .notification-panel {
                width: calc(100% - 40px);
                right: 10px;
                top: 70px;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .status-cards {
                grid-template-columns: 1fr;
            }
            
            .header {
                padding: 12px 15px;
            }
            
            .logo {
                width: 45px;
                height: 45px;
                font-size: 20px;
            }
            
            .title h1 {
                font-size: 1.2rem;
            }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
    </style>
</head>
<body>
    <!-- Header with Notification Bell -->
    <header class="header">
        <div class="logo-container">
            <div class="logo">
                <i class="fas fa-bell"></i>
            </div>
            <div class="title">
                <h1>‡πÅ‡∏≠‡∏õ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</h1>
                <p>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πâ‡∏õ‡∏¥‡∏î‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå</p>
            </div>
        </div>
        
        <div class="notification-bell-container">
            <div class="notification-bell" id="notificationBell">
                <i class="fas fa-bell bell-icon"></i>
                <div class="notification-badge" id="notificationBadge">0</div>
            </div>
            
            <!-- Notification Panel -->
            <div class="notification-panel" id="notificationPanel">
                <div class="panel-header">
                    <h3>
                        <i class="fas fa-bell"></i>
                        <span>‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</span>
                    </h3>
                    <div class="panel-actions">
                        <button class="btn btn-danger" id="markAllReadBtn" style="padding: 8px 12px; font-size: 0.9rem;">
                            <i class="fas fa-check-double"></i> ‡∏≠‡πà‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                        </button>
                        <button class="btn btn-danger" id="clearAllBtn" style="padding: 8px 12px; font-size: 0.9rem;">
                            <i class="fas fa-trash"></i> ‡∏•‡πâ‡∏≤‡∏á
                        </button>
                    </div>
                </div>
                <div class="panel-body" id="notificationList">
                    <div class="empty-notifications">
                        <i class="fas fa-bell-slash"></i>
                        <h4>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h4>
                        <p>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì!</p>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <!-- Status Cards -->
        <div class="status-cards">
            <div class="card">
                <h2><i class="fas fa-cogs"></i> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏ö‡∏ö</h2>
                <div class="status-item">
                    <span>‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:</span>
                    <span>
                        <span class="status-dot" id="notificationStatus"></span>
                        <span id="notificationStatusText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</span>
                    </span>
                </div>
                <div class="status-item">
                    <span>Service Worker:</span>
                    <span>
                        <span class="status-dot" id="swStatus"></span>
                        <span id="swStatusText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</span>
                    </span>
                </div>
                <div class="status-item">
                    <span>‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á:</span>
                    <span>
                        <span class="status-dot" id="bgStatus"></span>
                        <span id="bgStatusText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</span>
                    </span>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-chart-bar"></i> ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</h2>
                <div class="status-item">
                    <span>‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
                    <span id="totalNotifications">0</span>
                </div>
                <div class="status-item">
                    <span>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô:</span>
                    <span id="unreadNotifications">0</span>
                </div>
                <div class="status-item">
                    <span>‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß:</span>
                    <span id="sentNotifications">0</span>
                </div>
            </div>
        </div>

        <!-- Notification Form -->
        <div class="notification-form">
            <h2><i class="fas fa-plus-circle"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà</h2>
            
            <div class="form-group">
                <label class="form-label" for="notificationTitle">
                    <i class="fas fa-heading"></i> ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠:
                </label>
                <input type="text" id="notificationTitle" class="form-control" 
                       placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç" 
                       value="‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô">
            </div>
            
            <div class="form-group">
                <label class="form-label" for="notificationMessage">
                    <i class="fas fa-comment-alt"></i> ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°:
                </label>
                <textarea id="notificationMessage" class="form-control" rows="4" 
                          placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà...">
‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô ‡∏à‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏°‡πâ‡∏õ‡∏¥‡∏î‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß</textarea>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="scheduleTime">
                    <i class="fas fa-clock"></i> ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ô‡∏≤‡∏ó‡∏µ):
                </label>
                <input type="number" id="scheduleTime" class="form-control" 
                       min="1" max="10080" value="2" 
                       placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏≤‡∏ó‡∏µ">
                <div style="margin-top: 8px; font-size: 0.9rem; color: var(--gray);">
                    <i class="fas fa-info-circle"></i> ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 2 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-success" id="scheduleBtn">
                    <i class="fas fa-clock"></i> ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                </button>
                <button class="btn btn-primary" id="sendNowBtn">
                    <i class="fas fa-paper-plane"></i> ‡∏™‡πà‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                </button>
                <button class="btn btn-warning" id="requestPermissionBtn">
                    <i class="fas fa-hand-paper"></i> ‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï
                </button>
                <button class="btn btn-danger" id="testNotificationBtn">
                    <i class="fas fa-bell"></i> ‡∏ó‡∏î‡∏™‡∏≠‡∏ö
                </button>
            </div>
        </div>

        <!-- History -->
        <div class="history-section">
            <div class="history-header">
                <h2><i class="fas fa-history"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h2>
                <button class="btn btn-danger" id="clearHistoryBtn" style="padding: 10px 20px;">
                    <i class="fas fa-trash-alt"></i> ‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
                </button>
            </div>
            
            <div id="notificationHistory">
                <!-- History items will be added here -->
                <div style="text-align: center; padding: 40px; color: var(--gray);">
                    <i class="fas fa-history fa-3x" style="margin-bottom: 15px; display: block; opacity: 0.5;"></i>
                    ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                </div>
            </div>
        </div>

        <!-- Instructions -->
        <div class="instructions">
            <h2><i class="fas fa-graduation-cap"></i> ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏¥‡∏î Browser</h2>
            
            <div class="steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <h3>‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï</h3>
                    <p>‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° "‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <h3>‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤</h3>
                    <p>‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô 2 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏à‡∏≤‡∏Å‡∏ô‡∏µ‡πâ</p>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <h3>‡∏õ‡∏¥‡∏î Browser</h3>
                    <p><strong>‡∏õ‡∏¥‡∏î‡∏ó‡∏∏‡∏Å‡πÅ‡∏ó‡πá‡∏ö‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</strong> ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå</p>
                </div>
                <div class="step">
                    <div class="step-number">4</div>
                    <h3>‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
                    <p>‡∏£‡∏≠ 2 ‡∏ô‡∏≤‡∏ó‡∏µ ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥!</p>
                </div>
            </div>
            
            <div style="margin-top: 25px; padding: 20px; background: #E3F2FD; border-radius: 12px; border-left: 4px solid var(--primary);">
                <h4><i class="fas fa-lightbulb"></i> ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ:</h4>
                <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ <strong>Service Worker</strong> ‡πÅ‡∏•‡∏∞ <strong>Background Sync</strong> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πâ‡∏õ‡∏¥‡∏î‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå</p>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <h3>‡πÅ‡∏≠‡∏õ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</h3>
            <p>‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πâ‡∏õ‡∏¥‡∏î‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå ‚Ä¢ ‡∏°‡∏µ‡∏Å‡∏£‡∏∞‡∏î‡∏¥‡πà‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ‚Ä¢ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå</p>
            <div style="margin-top: 15px; font-size: 0.9rem; opacity: 0.8;">
                <i class="fas fa-code"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ HTML5, Service Workers, ‡πÅ‡∏•‡∏∞ IndexedDB
            </div>
        </footer>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Audio for Notification Sound -->
    <audio id="notificationSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3" type="audio/mpeg">
    </audio>

    <!-- Main JavaScript -->
    <script>
        // Global Variables
        let notifications = [];
        let serviceWorkerRegistration = null;
        let isPanelOpen = false;
        
        // Initialize App
        document.addEventListener('DOMContentLoaded', initializeApp);
        
        async function initializeApp() {
            console.log('üöÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏≠‡∏õ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô...');
            
            // Setup event listeners
            setupEventListeners();
            
            // Check notification permission
            checkNotificationPermission();
            
            // Register Service Worker
            await registerServiceWorker();
            
            // Load notifications from storage
            await loadNotifications();
            
            // Update UI
            updateNotificationUI();
            
            // Check system capabilities
            checkSystemCapabilities();
            
            // Start checking for scheduled notifications
            startNotificationChecker();
            
            // Play welcome sound
            setTimeout(() => playNotificationSound(), 500);
            
            console.log('‚úÖ ‡πÅ‡∏≠‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß');
            showToast('‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡πÅ‡∏≠‡∏õ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô!', 'success', '‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß');
        }
        
        function setupEventListeners() {
            // Notification bell
            document.getElementById('notificationBell').addEventListener('click', toggleNotificationPanel);
            
            // Form buttons
            document.getElementById('scheduleBtn').addEventListener('click', scheduleNotification);
            document.getElementById('sendNowBtn').addEventListener('click', sendImmediateNotification);
            document.getElementById('requestPermissionBtn').addEventListener('click', requestNotificationPermission);
            document.getElementById('testNotificationBtn').addEventListener('click', testNotification);
            
            // Panel buttons
            document.getElementById('markAllReadBtn').addEventListener('click', markAllAsRead);
            document.getElementById('clearAllBtn').addEventListener('click', clearAllNotifications);
            document.getElementById('clearHistoryBtn').addEventListener('click', clearHistory);
            
            // Close panel when clicking outside
            document.addEventListener('click', (event) => {
                const panel = document.getElementById('notificationPanel');
                const bell = document.getElementById('notificationBell');
                
                if (!panel.contains(event.target) && !bell.contains(event.target)) {
                    panel.classList.remove('show');
                    isPanelOpen = false;
                }
            });
        }
        
        // Toggle notification panel
        function toggleNotificationPanel() {
            const panel = document.getElementById('notificationPanel');
            isPanelOpen = !isPanelOpen;
            
            if (isPanelOpen) {
                panel.classList.add('show');
                // Mark all as read when opening panel
                markAllAsRead();
            } else {
                panel.classList.remove('show');
            }
        }
        
        // Check notification permission
        function checkNotificationPermission() {
            const statusDot = document.getElementById('notificationStatus');
            const statusText = document.getElementById('notificationStatusText');
            
            if (!('Notification' in window)) {
                statusDot.className = 'status-dot inactive';
                statusText.textContent = '‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö';
                return false;
            }
            
            const permission = Notification.permission;
            
            switch(permission) {
                case 'granted':
                    statusDot.className = 'status-dot active';
                    statusText.textContent = '‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÅ‡∏•‡πâ‡∏ß';
                    return true;
                case 'denied':
                    statusDot.className = 'status-dot inactive';
                    statusText.textContent = '‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÅ‡∏•‡πâ‡∏ß';
                    return false;
                default:
                    statusDot.className = 'status-dot waiting';
                    statusText.textContent = '‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï';
                    return false;
            }
        }
        
        // Request notification permission
        async function requestNotificationPermission() {
            if (!('Notification' in window)) {
                showToast('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', 'error');
                return false;
            }
            
            try {
                const permission = await Notification.requestPermission();
                
                // Update UI
                checkNotificationPermission();
                
                if (permission === 'granted') {
                    showToast('‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß!', 'success');
                    
                    // Register Service Worker again
                    await registerServiceWorker();
                    
                    return true;
                } else {
                    showToast('‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò', 'warning');
                    return false;
                }
            } catch (error) {
                console.error('‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:', error);
                showToast('‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', 'error');
                return false;
            }
        }
        
        // Register Service Worker
        async function registerServiceWorker() {
            const statusDot = document.getElementById('swStatus');
            const statusText = document.getElementById('swStatusText');
            
            if (!('serviceWorker' in navigator)) {
                statusDot.className = 'status-dot inactive';
                statusText.textContent = '‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö';
                return;
            }
            
            try {
                serviceWorkerRegistration = await navigator.serviceWorker.register('sw.js', {
                    scope: './'
                });
                
                console.log('Service Worker registered:', serviceWorkerRegistration);
                
                statusDot.className = 'status-dot active';
                statusText.textContent = '‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà';
                
                // Listen for updates
                serviceWorkerRegistration.addEventListener('updatefound', () => {
                    console.log('Service Worker update found');
                });
                
                // Send message to Service Worker
                if (serviceWorkerRegistration.active) {
                    serviceWorkerRegistration.active.postMessage({
                        type: 'APP_READY',
                        data: { timestamp: Date.now() }
                    });
                }
                
            } catch (error) {
                console.error('Service Worker registration failed:', error);
                statusDot.className = 'status-dot inactive';
                statusText.textContent = '‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß';
            }
        }
        
        // Check system capabilities
        function checkSystemCapabilities() {
            const bgDot = document.getElementById('bgStatus');
            const bgText = document.getElementById('bgStatusText');
            
            const capabilities = {
                serviceWorker: 'serviceWorker' in navigator,
                notifications: 'Notification' in window,
                push: 'PushManager' in window,
                sync: 'SyncManager' in window,
                periodicSync: 'periodicSync' in navigator,
                indexedDB: 'indexedDB' in window
            };
            
            console.log('System capabilities:', capabilities);
            
            if (capabilities.serviceWorker && capabilities.notifications) {
                bgDot.className = 'status-dot active';
                bgText.textContent = '‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
            } else {
                bgDot.className = 'status-dot inactive';
                bgText.textContent = '‡∏à‡∏≥‡∏Å‡∏±‡∏î';
            }
        }
        
        // Schedule notification
        async function scheduleNotification() {
            const title = document.getElementById('notificationTitle').value.trim();
            const message = document.getElementById('notificationMessage').value.trim();
            const minutes = parseInt(document.getElementById('scheduleTime').value);
            
            // Validation
            if (!title || !message) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°', 'warning');
                return;
            }
            
            if (isNaN(minutes) || minutes < 1 || minutes > 10080) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 1-10080 ‡∏ô‡∏≤‡∏ó‡∏µ', 'warning');
                return;
            }
            
            // Create notification object
            const notification = {
                id: 'notification-' + Date.now(),
                title: title,
                message: message,
                type: 'scheduled',
                minutes: minutes,
                scheduledTime: Date.now() + (minutes * 60000),
                createdAt: Date.now(),
                status: 'scheduled',
                read: false
            };
            
            // Add to notifications array
            notifications.unshift(notification);
            
            // Save to storage
            await saveNotifications();
            
            // Update UI
            updateNotificationUI();
            
            // Show confirmation
            const timeString = new Date(notification.scheduledTime).toLocaleTimeString('th-TH', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            showToast(
                '‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 
                'success',
                `‡∏à‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡∏≠‡∏µ‡∏Å ${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ (${timeString})`
            );
            
            // Add to history
            addToHistory({
                type: 'scheduled',
                title: notification.title,
                message: `‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏≠‡∏µ‡∏Å ${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ`,
                time: new Date().toLocaleTimeString('th-TH'),
                status: 'pending'
            });
            
            // Send to Service Worker for background scheduling
            if (serviceWorkerRegistration && serviceWorkerRegistration.active) {
                serviceWorkerRegistration.active.postMessage({
                    type: 'SCHEDULE_NOTIFICATION',
                    notification: notification
                });
            }
        }
        
        // Send immediate notification
        async function sendImmediateNotification() {
            const title = document.getElementById('notificationTitle').value.trim() || '‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô';
            const message = document.getElementById('notificationMessage').value.trim() || '‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô';
            
            // Check permission
            if (Notification.permission !== 'granted') {
                const granted = await requestNotificationPermission();
                if (!granted) return;
            }
            
            // Create notification object
            const notification = {
                id: 'immediate-' + Date.now(),
                title: title,
                message: message,
                type: 'immediate',
                createdAt: Date.now(),
                status: 'sent',
                read: false
            };
            
            // Add to notifications
            notifications.unshift(notification);
            
            // Save
            await saveNotifications();
            
            // Update UI
            updateNotificationUI();
            
            // Send notification
            if (serviceWorkerRegistration && serviceWorkerRegistration.active) {
                // Send through Service Worker
                serviceWorkerRegistration.showNotification(title, {
                    body: message,
                    icon: '/icons/icon-192x192.png',
                    badge: '/icons/icon-96x96.png',
                    tag: notification.id,
                    requireInteraction: true,
                    actions: [
                        {
                            action: 'view',
                            title: '‡∏î‡∏π'
                        },
                        {
                            action: 'close',
                            title: '‡∏õ‡∏¥‡∏î'
                        }
                    ]
                });
            } else if (Notification.permission === 'granted') {
                // Fallback to regular notification
                new Notification(title, {
                    body: message,
                    icon: '/icons/icon-192x192.png'
                });
            }
            
            // Play sound
            playNotificationSound();
            
            // Show toast
            showToast('‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß!', 'success');
            
            // Add to history
            addToHistory({
                type: 'immediate',
                title: notification.title,
                message: '‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ',
                time: new Date().toLocaleTimeString('th-TH'),
                status: 'sent'
            });
        }
        
        // Test notification
        async function testNotification() {
            // Check permission first
            if (Notification.permission !== 'granted') {
                await requestNotificationPermission();
                return;
            }
            
            // Send test notification
            if (serviceWorkerRegistration && serviceWorkerRegistration.active) {
                serviceWorkerRegistration.showNotification('‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', {
                    body: '‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏õ',
                    icon: '/icons/icon-192x192.png',
                    tag: 'test-' + Date.now(),
                    requireInteraction: true
                });
                
                // Play sound
                playNotificationSound();
                
                // Show toast
                showToast('‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', 'info');
            }
        }
        
        // Update notification UI
        function updateNotificationUI() {
            updateNotificationList();
            updateNotificationStats();
            updateBadgeCount();
            updateHistory();
        }
        
        // Update notification list
        function updateNotificationList() {
            const list = document.getElementById('notificationList');
            
            // Filter notifications (show max 10)
            const displayNotifications = notifications.slice(0, 10);
            
            if (displayNotifications.length === 0) {
                list.innerHTML = `
                    <div class="empty-notifications">
                        <i class="fas fa-bell-slash"></i>
                        <h4>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h4>
                        <p>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì!</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            displayNotifications.forEach(notification => {
                const time = new Date(notification.createdAt).toLocaleTimeString('th-TH', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const iconClass = notification.type === 'scheduled' ? 'warning' : 
                                notification.status === 'sent' ? 'success' : 'info';
                
                html += `
                    <div class="notification-item ${notification.read ? '' : 'unread'}" data-id="${notification.id}">
                        <div class="notification-icon ${iconClass}">
                            <i class="fas ${notification.type === 'scheduled' ? 'fa-clock' : 'fa-bell'}"></i>
                        </div>
                        <div class="notification-content">
                            <div class="notification-title">${notification.title}</div>
                            <div class="notification-message">${notification.message}</div>
                            <div class="notification-time">${time}</div>
                        </div>
                    </div>
                `;
            });
            
            list.innerHTML = html;
            
            // Add click event to notification items
            document.querySelectorAll('.notification-item').forEach(item => {
                item.addEventListener('click', () => {
                    const id = item.dataset.id;
                    markAsRead(id);
                });
            });
        }
        
        // Update notification statistics
        function updateNotificationStats() {
            const total = notifications.length;
            const unread = notifications.filter(n => !n.read).length;
            const sent = notifications.filter(n => n.status === 'sent').length;
            
            document.getElementById('totalNotifications').textContent = total;
            document.getElementById('unreadNotifications').textContent = unread;
            document.getElementById('sentNotifications').textContent = sent;
        }
        
        // Update badge count
        function updateBadgeCount() {
            const unread = notifications.filter(n => !n.read).length;
            const badge = document.getElementById('notificationBadge');
            
            badge.textContent = unread > 99 ? '99+' : unread;
            badge.style.display = unread > 0 ? 'flex' : 'none';
            
            // Update browser badge if supported
            if ('setAppBadge' in navigator) {
                navigator.setAppBadge(unread).catch(console.error);
            }
            
            // Update title
            document.title = unread > 0 ? `(${unread}) ‡πÅ‡∏≠‡∏õ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô` : '‡πÅ‡∏≠‡∏õ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô';
        }
        
        // Update history
        function updateHistory() {
            const history = document.getElementById('notificationHistory');
            
            // Filter for history (all notifications)
            if (notifications.length === 0) {
                history.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--gray);">
                        <i class="fas fa-history fa-3x" style="margin-bottom: 15px; display: block; opacity: 0.5;"></i>
                        ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            notifications.forEach(notification => {
                const time = new Date(notification.createdAt).toLocaleTimeString('th-TH', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const statusClass = notification.status === 'sent' ? 'sent' : 
                                  notification.status === 'scheduled' ? 'pending' : 'failed';
                
                const statusText = notification.status === 'sent' ? '‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß' : 
                                 notification.status === 'scheduled' ? '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£' : '‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß';
                
                html += `
                    <div class="history-item ${statusClass}">
                        <div>
                            <strong>${notification.title}</strong>
                            <div style="margin-top: 5px; color: var(--gray); font-size: 0.9rem;">
                                ${notification.message}
                            </div>
                            <div style="margin-top: 5px; font-size: 0.8rem; color: #78909C;">
                                <i class="fas fa-clock"></i> ${time}
                            </div>
                        </div>
                        <div>
                            <span style="font-size: 0.8rem; padding: 4px 8px; background: rgba(0,0,0,0.1); border-radius: 10px;">
                                ${statusText}
                            </span>
                        </div>
                    </div>
                `;
            });
            
            history.innerHTML = html;
        }
        
        // Mark notification as read
        function markAsRead(id) {
            const notification = notifications.find(n => n.id === id);
            if (notification && !notification.read) {
                notification.read = true;
                saveNotifications();
                updateNotificationUI();
            }
        }
        
        // Mark all as read
        function markAllAsRead() {
            let updated = false;
            
            notifications.forEach(notification => {
                if (!notification.read) {
                    notification.read = true;
                    updated = true;
                }
            });
            
            if (updated) {
                saveNotifications();
                updateNotificationUI();
                showToast('‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß', 'success');
            }
        }
        
        // Clear all notifications
        async function clearAllNotifications() {
            if (notifications.length === 0) return;
            
            if (confirm('‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                notifications = [];
                await saveNotifications();
                updateNotificationUI();
                showToast('‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß', 'info');
            }
        }
        
        // Clear history
        async function clearHistory() {
            if (notifications.length === 0) return;
            
            if (confirm('‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                notifications = [];
                await saveNotifications();
                updateNotificationUI();
                showToast('‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß', 'info');
            }
        }
        
        // Add to history (for logging)
        function addToHistory(data) {
            console.log('History added:', data);
            // In production, you might want to save this separately
        }
        
        // Start notification checker
        function startNotificationChecker() {
            // Check every 30 seconds for scheduled notifications
            setInterval(checkScheduledNotifications, 30000);
            
            // Initial check
            setTimeout(checkScheduledNotifications, 1000);
        }
        
        // Check scheduled notifications
        function checkScheduledNotifications() {
            const now = Date.now();
            const scheduled = notifications.filter(n => 
                n.status === 'scheduled' && n.scheduledTime <= now
            );
            
            scheduled.forEach(async (notification) => {
                console.log('Sending scheduled notification:', notification.title);
                
                // Update status
                notification.status = 'sent';
                await saveNotifications();
                
                // Send notification
                if (Notification.permission === 'granted') {
                    if (serviceWorkerRegistration && serviceWorkerRegistration.active) {
                        serviceWorkerRegistration.showNotification(notification.title, {
                            body: `[‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤] ${notification.message}`,
                            icon: '/icons/icon-192x192.png',
                            tag: notification.id
                        });
                    } else {
                        new Notification(notification.title, {
                            body: `[‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤] ${notification.message}`,
                            icon: '/icons/icon-192x192.png'
                        });
                    }
                    
                    // Play sound
                    playNotificationSound();
                    
                    // Show toast
                    showToast(notification.title, 'info', '‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ');
                }
            });
            
            // Update UI
            if (scheduled.length > 0) {
                updateNotificationUI();
            }
        }
        
        // Load notifications from storage
        async function loadNotifications() {
            try {
                const saved = localStorage.getItem('notifications');
                if (saved) {
                    notifications = JSON.parse(saved);
                    
                    // Filter out old scheduled notifications (older than 1 day)
                    const oneDayAgo = Date.now() - (24 * 60 * 60 * 1000);
                    notifications = notifications.filter(n => 
                        n.status !== 'scheduled' || n.scheduledTime > oneDayAgo
                    );
                }
            } catch (error) {
                console.error('Load notifications error:', error);
                notifications = [];
            }
        }
        
        // Save notifications to storage
        async function saveNotifications() {
            try {
                localStorage.setItem('notifications', JSON.stringify(notifications));
            } catch (error) {
                console.error('Save notifications error:', error);
            }
        }
        
        // Play notification sound
        function playNotificationSound() {
            try {
                const audio = document.getElementById('notificationSound');
                audio.currentTime = 0;
                audio.play().catch(e => console.log('Cannot play sound:', e));
            } catch (error) {
                console.log('Play sound error:', error);
            }
        }
        
        // Show toast notification
        function showToast(title, type = 'info', message = '') {
            const container = document.getElementById('toastContainer');
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-times-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            
            toast.innerHTML = `
                <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--${type}); display: flex; align-items: center; justify-content: center; color: white; font-size: 18px;">
                    <i class="fas ${icons[type] || 'fa-info-circle'}"></i>
                </div>
                <div style="flex: 1;">
                    <strong style="display: block; margin-bottom: 5px;">${title}</strong>
                    ${message ? `<div style="font-size: 0.9rem; color: var(--gray);">${message}</div>` : ''}
                </div>
                <button class="toast-close" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #999; padding: 5px; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%;">
                    &times;
                </button>
            `;
            
            container.appendChild(toast);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.style.opacity = '0';
                    toast.style.transform = 'translateX(100px)';
                    setTimeout(() => {
                        if (toast.parentNode) toast.parentNode.removeChild(toast);
                    }, 300);
                }
            }, 5000);
            
            // Close button
            toast.querySelector('.toast-close').addEventListener('click', () => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100px)';
                setTimeout(() => {
                    if (toast.parentNode) toast.parentNode.removeChild(toast);
                }, 300);
            });
        }
    </script>
</body>
</html>
