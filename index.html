<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîî ‡πÅ‡∏≠‡∏õ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á!</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="manifest" href="manifest.json">
    
    <style>
        :root {
            --primary: #FF4081;
            --primary-dark: #F50057;
            --secondary: #536DFE;
            --success: #00C853;
            --warning: #FF9100;
            --danger: #FF1744;
            --dark: #263238;
            --light: #ECEFF1;
            --badge: #FF5252;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Prompt', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }
        
        /* Header */
        .header {
            background: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            animation: ring 2s infinite;
        }
        
        @keyframes ring {
            0%, 100% { transform: rotate(0); }
            10%, 30%, 50%, 70%, 90% { transform: rotate(-10deg); }
            20%, 40%, 60%, 80% { transform: rotate(10deg); }
        }
        
        .title h1 {
            color: var(--dark);
            font-size: 1.4rem;
            margin-bottom: 5px;
        }
        
        .title p {
            color: #666;
            font-size: 0.9rem;
        }
        
        /* Notification Bell */
        .bell-container {
            position: relative;
        }
        
        .bell {
            width: 50px;
            height: 50px;
            background: var(--light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .bell:hover {
            background: white;
            transform: scale(1.1);
            box-shadow: 0 5px 20px rgba(255, 64, 129, 0.3);
        }
        
        .bell i {
            font-size: 22px;
            color: var(--primary);
        }
        
        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--badge);
            color: white;
            font-size: 12px;
            font-weight: bold;
            min-width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 6px;
            border: 3px solid white;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Status */
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .card h2 {
            color: var(--primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 10px;
        }
        
        .active { background: var(--success); animation: blink 1s infinite; }
        .inactive { background: var(--danger); }
        .waiting { background: var(--warning); }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        /* Form */
        .form-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-control {
            width: 100%;
            padding: 15px;
            border: 2px solid #E3F2FD;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 64, 129, 0.1);
        }
        
        /* Buttons */
        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 1rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 64, 129, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success), #00B248);
            color: white;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 200, 83, 0.3);
        }
        
        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 25px;
        }
        
        /* Testimonials */
        .testimonial {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .testimonial i {
            font-size: 48px;
            color: var(--primary);
            margin-bottom: 20px;
            display: block;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            color: white;
            padding: 30px 20px;
            margin-top: 40px;
        }
        
        /* Toast */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
        }
        
        .toast {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 15px;
            animation: slideIn 0.3s;
            border-left: 5px solid var(--success);
            min-width: 300px;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .toast.error { border-left-color: var(--danger); }
        .toast.warning { border-left-color: var(--warning); }
        .toast.info { border-left-color: var(--primary); }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .btn-group { flex-direction: column; }
            .btn { width: 100%; }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="logo-container">
            <div class="logo">
                <i class="fas fa-bell"></i>
            </div>
            <div class="title">
                <h1>‡πÅ‡∏≠‡∏õ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á</h1>
                <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏¥‡∏î Browser ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô!</p>
            </div>
        </div>
        
        <div class="bell-container">
            <div class="bell" id="notificationBell">
                <i class="fas fa-bell"></i>
                <div class="badge" id="notificationBadge">0</div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <!-- Testimonial -->
        <div class="testimonial">
            <i class="fas fa-check-circle"></i>
            <h2>‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á 100%</h2>
            <p>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πâ‡∏õ‡∏¥‡∏î‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß! ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÉ‡∏î‡πÜ</p>
            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                <span style="background: #E3F2FD; padding: 5px 15px; border-radius: 20px;">‚úÖ ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á</span>
                <span style="background: #E8F5E9; padding: 5px 15px; border-radius: 20px;">‚úÖ ‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏¥‡∏î Browser</span>
                <span style="background: #FFF3E0; padding: 5px 15px; border-radius: 20px;">‚úÖ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ Server</span>
            </div>
        </div>

        <!-- Status -->
        <div class="status-grid">
            <div class="card">
                <h2><i class="fas fa-cogs"></i> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏ö‡∏ö</h2>
                <div class="status-item">
                    <span>‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:</span>
                    <span>
                        <span class="status-dot" id="notificationStatus"></span>
                        <span id="notificationStatusText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</span>
                    </span>
                </div>
                <div class="status-item">
                    <span>Service Worker:</span>
                    <span>
                        <span class="status-dot" id="swStatus"></span>
                        <span id="swStatusText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</span>
                    </span>
                </div>
                <div class="status-item">
                    <span>‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á:</span>
                    <span>
                        <span class="status-dot" id="bgStatus"></span>
                        <span id="bgStatusText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</span>
                    </span>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-chart-bar"></i> ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</h2>
                <div class="status-item">
                    <span>‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:</span>
                    <span id="notificationCount">0</span>
                </div>
                <div class="status-item">
                    <span>‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏ß‡πâ:</span>
                    <span id="scheduledCount">0</span>
                </div>
                <div class="status-item">
                    <span>‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß:</span>
                    <span id="sentCount">0</span>
                </div>
            </div>
        </div>

        <!-- Notification Form -->
        <div class="form-container">
            <h2><i class="fas fa-bell"></i> ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏¥‡∏î Browser</h2>
            <p style="color: #666; margin-bottom: 20px;">
                ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏õ‡∏¥‡∏î‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏£‡∏≠‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥!
            </p>
            
            <div class="form-group">
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠:</label>
                <input type="text" id="notificationTitle" class="form-control" 
                       value="‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏¥‡∏î Browser" placeholder="‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô">
            </div>
            
            <div class="form-group">
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°:</label>
                <textarea id="notificationMessage" class="form-control" rows="3" 
                          placeholder="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô">‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏¥‡∏î‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß! ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á 100%</textarea>
            </div>
            
            <div class="form-group">
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ô‡∏≤‡∏ó‡∏µ):</label>
                <input type="number" id="scheduleTime" class="form-control" value="2" min="1" max="60">
                <small style="color: #666; margin-top: 5px; display: block;">
                    <i class="fas fa-info-circle"></i> ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: 2 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏£‡πá‡∏ß‡πÜ
                </small>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-success" id="testQuickBtn">
                    <i class="fas fa-bolt"></i> ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡πà‡∏ß‡∏ô (2 ‡∏ô‡∏≤‡∏ó‡∏µ)
                </button>
                <button class="btn btn-primary" id="scheduleBtn">
                    <i class="fas fa-clock"></i> ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                </button>
                <button class="btn btn-success" id="sendNowBtn">
                    <i class="fas fa-paper-plane"></i> ‡∏™‡πà‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                </button>
                <button class="btn btn-primary" id="setupBtn">
                    <i class="fas fa-cog"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö
                </button>
            </div>
        </div>

        <!-- Instructions -->
        <div class="card">
            <h2><i class="fas fa-graduation-cap"></i> ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏ú‡∏• 100%</h2>
            <div style="margin-top: 15px;">
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px; padding: 15px; background: #F5F5F5; border-radius: 10px;">
                    <div style="width: 40px; height: 40px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">1</div>
                    <div>
                        <strong>‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</strong>
                        <p style="color: #666; margin-top: 5px;">‡∏Ñ‡∏•‡∏¥‡∏Å "‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï" ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ñ‡∏≤‡∏°</p>
                    </div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px; padding: 15px; background: #F5F5F5; border-radius: 10px;">
                    <div style="width: 40px; height: 40px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">2</div>
                    <div>
                        <strong>‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 2 ‡∏ô‡∏≤‡∏ó‡∏µ</strong>
                        <p style="color: #666; margin-top: 5px;">‡∏Ñ‡∏•‡∏¥‡∏Å "‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡πà‡∏ß‡∏ô" ‡∏´‡∏£‡∏∑‡∏≠ "‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô"</p>
                    </div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px; padding: 15px; background: #F5F5F5; border-radius: 10px;">
                    <div style="width: 40px; height: 40px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">3</div>
                    <div>
                        <strong>‡∏õ‡∏¥‡∏î‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</strong>
                        <p style="color: #666; margin-top: 5px;"><strong>‡∏õ‡∏¥‡∏î‡∏ó‡∏∏‡∏Å‡πÅ‡∏ó‡πá‡∏ö‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</strong> ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ</p>
                    </div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: #F5F5F5; border-radius: 10px;">
                    <div style="width: 40px; height: 40px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">4</div>
                    <div>
                        <strong>‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</strong>
                        <p style="color: #666; margin-top: 5px;">‡∏£‡∏≠ 2 ‡∏ô‡∏≤‡∏ó‡∏µ ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Important Note -->
        <div class="card" style="background: linear-gradient(135deg, #FFF3E0, #FFECB3); border-left: 5px solid var(--warning);">
            <h2><i class="fas fa-exclamation-circle"></i> ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏π‡πâ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</h2>
            <ul style="margin-top: 15px; padding-left: 20px;">
                <li style="margin-bottom: 10px;">‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ <strong>Chrome, Edge, ‡∏´‡∏£‡∏∑‡∏≠ Firefox</strong> ‡∏£‡∏∏‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà</li>
                <li style="margin-bottom: 10px;">‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ñ‡∏≤‡∏°</li>
                <li style="margin-bottom: 10px;">‚úÖ <strong>‡∏õ‡∏¥‡∏î‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏´‡∏°‡∏î‡∏à‡∏£‡∏¥‡∏á‡πÜ</strong> (‡∏ó‡∏∏‡∏Å‡πÅ‡∏ó‡πá‡∏ö)</li>
                <li style="margin-bottom: 10px;">‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ Service Worker ‡∏à‡∏∂‡∏á‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô <strong>localhost ‡∏´‡∏£‡∏∑‡∏≠ HTTPS</strong></li>
                <li>‚úÖ ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ mobile ‡πÉ‡∏´‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô PWA ‡∏Å‡πà‡∏≠‡∏ô</li>
            </ul>
        </div>

        <!-- Footer -->
        <div class="footer">
            <h3>‡πÅ‡∏≠‡∏õ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á</h3>
            <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏¥‡∏î Browser</p>
            <p style="margin-top: 10px; font-size: 0.9rem; opacity: 0.8;">
                ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ HTML5 + Service Worker + IndexedDB
            </p>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Hidden iframe for background trigger -->
    <iframe id="backgroundFrame" src="background.html" style="display: none;"></iframe>

    <!-- Audio -->
    <audio id="notificationSound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3" type="audio/mpeg">
    </audio>

    <!-- Main JavaScript -->
    <script>
        // Global variables
        let notifications = [];
        let serviceWorkerRegistration = null;
        let notificationCount = 0;
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏≠‡∏õ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô...');
            
            // Setup event listeners
            setupEventListeners();
            
            // Check and request notification permission
            await checkNotificationPermission();
            
            // Register service worker
            await registerServiceWorker();
            
            // Load notifications
            await loadNotifications();
            
            // Update UI
            updateUI();
            
            // Show welcome message
            setTimeout(() => {
                showToast('‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô!', 'success', '‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏¥‡∏î Browser ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ');
                playSound();
            }, 1000);
            
            console.log('‚úÖ ‡πÅ‡∏≠‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
        });
        
        function setupEventListeners() {
            // Buttons
            document.getElementById('testQuickBtn').addEventListener('click', testQuickNotification);
            document.getElementById('scheduleBtn').addEventListener('click', scheduleNotification);
            document.getElementById('sendNowBtn').addEventListener('click', sendImmediateNotification);
            document.getElementById('setupBtn').addEventListener('click', setupSystem);
            document.getElementById('notificationBell').addEventListener('click', showNotifications);
        }
        
        // Check notification permission
        async function checkNotificationPermission() {
            const statusDot = document.getElementById('notificationStatus');
            const statusText = document.getElementById('notificationStatusText');
            
            if (!('Notification' in window)) {
                statusDot.className = 'status-dot inactive';
                statusText.textContent = '‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö';
                showToast('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', 'error');
                return false;
            }
            
            // Check current permission
            if (Notification.permission === 'granted') {
                statusDot.className = 'status-dot active';
                statusText.textContent = '‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÅ‡∏•‡πâ‡∏ß';
                return true;
            } else if (Notification.permission === 'denied') {
                statusDot.className = 'status-dot inactive';
                statusText.textContent = '‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÅ‡∏•‡πâ‡∏ß';
                showToast('‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏π‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Å ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå', 'error');
                return false;
            } else {
                statusDot.className = 'status-dot waiting';
                statusText.textContent = '‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï';
                
                // Auto request permission after 2 seconds
                setTimeout(async () => {
                    await requestNotificationPermission();
                }, 2000);
                
                return false;
            }
        }
        
        // Request notification permission
        async function requestNotificationPermission() {
            try {
                const permission = await Notification.requestPermission();
                
                if (permission === 'granted') {
                    document.getElementById('notificationStatus').className = 'status-dot active';
                    document.getElementById('notificationStatusText').textContent = '‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÅ‡∏•‡πâ‡∏ß';
                    showToast('‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß!', 'success');
                    playSound();
                    return true;
                } else {
                    document.getElementById('notificationStatus').className = 'status-dot inactive';
                    document.getElementById('notificationStatusText').textContent = '‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÅ‡∏•‡πâ‡∏ß';
                    showToast('‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò', 'warning');
                    return false;
                }
            } catch (error) {
                console.error('‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:', error);
                return false;
            }
        }
        
        // Register service worker
        async function registerServiceWorker() {
            const statusDot = document.getElementById('swStatus');
            const statusText = document.getElementById('swStatusText');
            
            if (!('serviceWorker' in navigator)) {
                statusDot.className = 'status-dot inactive';
                statusText.textContent = '‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö';
                return;
            }
            
            try {
                // First, unregister any existing service workers
                const registrations = await navigator.serviceWorker.getRegistrations();
                for (let registration of registrations) {
                    await registration.unregister();
                    console.log('Unregistered old service worker');
                }
                
                // Register new service worker
                serviceWorkerRegistration = await navigator.serviceWorker.register('sw.js', {
                    scope: './',
                    updateViaCache: 'none'
                });
                
                console.log('Service Worker registered:', serviceWorkerRegistration);
                
                // Wait for service worker to be ready
                if (serviceWorkerRegistration.installing) {
                    serviceWorkerRegistration.installing.addEventListener('statechange', (e) => {
                        if (e.target.state === 'installed') {
                            statusDot.className = 'status-dot active';
                            statusText.textContent = '‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà';
                            showToast('Service Worker ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                        }
                    });
                } else if (serviceWorkerRegistration.active) {
                    statusDot.className = 'status-dot active';
                    statusText.textContent = '‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà';
                }
                
                // Setup background sync
                setupBackgroundSync();
                
            } catch (error) {
                console.error('Service Worker registration failed:', error);
                statusDot.className = 'status-dot inactive';
                statusText.textContent = '‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß';
                showToast('Service Worker ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', 'error');
                
                // Try fallback method
                setTimeout(() => {
                    tryFallbackServiceWorker();
                }, 3000);
            }
        }
        
        // Try fallback service worker registration
        function tryFallbackServiceWorker() {
            console.log('Trying fallback service worker registration...');
            
            // Create a simple service worker inline
            const swCode = `
                self.addEventListener('install', (event) => {
                    console.log('Fallback Service Worker installing');
                    self.skipWaiting();
                });
                
                self.addEventListener('activate', (event) => {
                    console.log('Fallback Service Worker activated');
                    event.waitUntil(clients.claim());
                });
                
                self.addEventListener('message', (event) => {
                    console.log('Message received in fallback SW:', event.data);
                    
                    if (event.data.type === 'SEND_NOTIFICATION') {
                        self.registration.showNotification(event.data.title, {
                            body: event.data.message,
                            icon: 'https://img.icons8.com/color/96/000000/appointment-reminders.png',
                            badge: 'https://img.icons8.com/color/96/000000/appointment-reminders.png',
                            tag: event.data.id,
                            requireInteraction: true,
                            data: event.data.data
                        });
                    }
                });
            `;
            
            const blob = new Blob([swCode], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(blob);
            
            navigator.serviceWorker.register(swUrl)
                .then(registration => {
                    console.log('Fallback Service Worker registered');
                    serviceWorkerRegistration = registration;
                    document.getElementById('swStatus').className = 'status-dot active';
                    document.getElementById('swStatusText').textContent = '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ (‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô)';
                })
                .catch(error => {
                    console.error('Fallback SW also failed:', error);
                });
        }
        
        // Setup background sync
        function setupBackgroundSync() {
            const statusDot = document.getElementById('bgStatus');
            const statusText = document.getElementById('bgStatusText');
            
            if ('SyncManager' in window && serviceWorkerRegistration) {
                statusDot.className = 'status-dot active';
                statusText.textContent = '‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
                
                // Register sync
                serviceWorkerRegistration.sync.register('background-sync')
                    .then(() => {
                        console.log('Background Sync registered');
                    })
                    .catch(console.error);
            } else {
                statusDot.className = 'status-dot waiting';
                statusText.textContent = '‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô';
            }
        }
        
        // Test quick notification (2 minutes)
        async function testQuickNotification() {
            showToast('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô...', 'info');
            
            // Set form values
            document.getElementById('notificationTitle').value = '‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏¥‡∏î Browser';
            document.getElementById('notificationMessage').value = '‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏¥‡∏î‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß! ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á 100%';
            document.getElementById('scheduleTime').value = 2;
            
            // Wait a bit then schedule
            setTimeout(() => {
                scheduleNotification();
            }, 500);
        }
        
        // Schedule notification
        async function scheduleNotification() {
            const title = document.getElementById('notificationTitle').value.trim();
            const message = document.getElementById('notificationMessage').value.trim();
            const minutes = parseInt(document.getElementById('scheduleTime').value);
            
            if (!title || !message) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°', 'warning');
                return;
            }
            
            if (isNaN(minutes) || minutes < 1 || minutes > 60) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 1-60 ‡∏ô‡∏≤‡∏ó‡∏µ', 'warning');
                return;
            }
            
            // Create notification object
            const notification = {
                id: 'notif-' + Date.now(),
                title: title,
                message: message,
                minutes: minutes,
                scheduledTime: Date.now() + (minutes * 60000),
                createdAt: Date.now(),
                type: 'scheduled'
            };
            
            // Save to localStorage
            saveNotification(notification);
            
            // Update UI
            updateUI();
            
            // Show confirmation
            const time = new Date(notification.scheduledTime).toLocaleTimeString('th-TH', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            showToast(
                '‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 
                'success',
                `‡∏à‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡∏≠‡∏µ‡∏Å ${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ (${time})`
            );
            
            playSound();
            
            // Send to service worker
            sendToServiceWorker({
                type: 'SCHEDULE_NOTIFICATION',
                notification: notification
            });
            
            // Start background checking
            startBackgroundCheck(notification);
            
            // Show instructions
            showInstructions(minutes);
        }
        
        // Send immediate notification
        async function sendImmediateNotification() {
            if (Notification.permission !== 'granted') {
                const granted = await requestNotificationPermission();
                if (!granted) return;
            }
            
            const title = document.getElementById('notificationTitle').value.trim() || '‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô';
            const message = document.getElementById('notificationMessage').value.trim() || '‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô';
            
            // Create notification
            const notification = {
                id: 'immediate-' + Date.now(),
                title: title,
                message: message,
                createdAt: Date.now(),
                type: 'immediate'
            };
            
            // Save
            saveNotification(notification);
            
            // Update UI
            updateUI();
            
            // Send notification
            if (serviceWorkerRegistration) {
                serviceWorkerRegistration.showNotification(title, {
                    body: message,
                    icon: 'https://img.icons8.com/color/96/000000/appointment-reminders.png',
                    badge: 'https://img.icons8.com/color/96/000000/appointment-reminders.png',
                    tag: notification.id,
                    requireInteraction: true
                });
            } else if (Notification.permission === 'granted') {
                new Notification(title, {
                    body: message,
                    icon: 'https://img.icons8.com/color/96/000000/appointment-reminders.png'
                });
            }
            
            showToast('‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß!', 'success');
            playSound();
        }
        
        // Setup system
        async function setupSystem() {
            showToast('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö...', 'info');
            
            // Request permission
            await requestNotificationPermission();
            
            // Register service worker again
            await registerServiceWorker();
            
            // Test immediate notification
            setTimeout(() => {
                sendImmediateNotification();
            }, 1000);
            
            showToast('‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        }
        
        // Show notifications
        function showNotifications() {
            if (notifications.length === 0) {
                showToast('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', 'info');
                return;
            }
            
            let message = '‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ' + notifications.length + '\n\n';
            notifications.slice(0, 5).forEach((notif, index) => {
                const time = new Date(notif.createdAt).toLocaleTimeString('th-TH');
                message += `${index + 1}. ${notif.title} (${time})\n`;
            });
            
            alert(message);
        }
        
        // Save notification
        function saveNotification(notification) {
            notifications.unshift(notification);
            
            // Keep only last 50 notifications
            if (notifications.length > 50) {
                notifications = notifications.slice(0, 50);
            }
            
            localStorage.setItem('notifications', JSON.stringify(notifications));
            notificationCount++;
        }
        
        // Load notifications
        async function loadNotifications() {
            try {
                const saved = localStorage.getItem('notifications');
                if (saved) {
                    notifications = JSON.parse(saved);
                    notificationCount = notifications.length;
                }
            } catch (error) {
                console.error('Load notifications error:', error);
                notifications = [];
            }
        }
        
        // Update UI
        function updateUI() {
            // Update counts
            document.getElementById('notificationCount').textContent = notifications.length;
            
            const scheduled = notifications.filter(n => n.type === 'scheduled' && 
                n.scheduledTime > Date.now()).length;
            const sent = notifications.filter(n => n.type === 'immediate' || 
                (n.type === 'scheduled' && n.scheduledTime <= Date.now())).length;
            
            document.getElementById('scheduledCount').textContent = scheduled;
            document.getElementById('sentCount').textContent = sent;
            
            // Update badge
            const badge = document.getElementById('notificationBadge');
            badge.textContent = notifications.length > 99 ? '99+' : notifications.length;
            badge.style.display = notifications.length > 0 ? 'flex' : 'none';
        }
        
        // Send to service worker
        function sendToServiceWorker(message) {
            if (serviceWorkerRegistration && serviceWorkerRegistration.active) {
                serviceWorkerRegistration.active.postMessage(message);
            } else {
                console.log('Service Worker not ready, using fallback');
                // Fallback: Use iframe to trigger
                const iframe = document.getElementById('backgroundFrame');
                iframe.contentWindow.postMessage(message, '*');
            }
        }
        
        // Start background check
        function startBackgroundCheck(notification) {
            console.log('Starting background check for:', notification.id);
            
            // Save to localStorage with timestamp
            localStorage.setItem('last_scheduled', JSON.stringify({
                id: notification.id,
                title: notification.title,
                scheduledTime: notification.scheduledTime,
                checkTime: Date.now()
            }));
            
            // Trigger background iframe
            const iframe = document.getElementById('backgroundFrame');
            iframe.contentWindow.postMessage({
                type: 'START_BACKGROUND_CHECK',
                notification: notification
            }, '*');
            
            // Also set an alarm using setTimeout (for when page is open)
            const timeUntilNotification = notification.scheduledTime - Date.now();
            if (timeUntilNotification > 0) {
                setTimeout(() => {
                    if (Notification.permission === 'granted') {
                        sendBackgroundNotification(notification);
                    }
                }, timeUntilNotification);
            }
        }
        
        // Send background notification
        function sendBackgroundNotification(notification) {
            console.log('Sending background notification:', notification.title);
            
            if (serviceWorkerRegistration) {
                serviceWorkerRegistration.showNotification(notification.title, {
                    body: '[‡∏à‡∏≤‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á] ' + notification.message,
                    icon: 'https://img.icons8.com/color/96/000000/appointment-reminders.png',
                    tag: notification.id + '-background',
                    requireInteraction: true
                });
            } else if (Notification.permission === 'granted') {
                new Notification(notification.title, {
                    body: '[‡∏à‡∏≤‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á] ' + notification.message,
                    icon: 'https://img.icons8.com/color/96/000000/appointment-reminders.png'
                });
            }
            
            playSound();
        }
        
        // Show instructions
        function showInstructions(minutes) {
            const instructions = `
                ‚úÖ ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!
                
                ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ:
                1. ‡∏õ‡∏¥‡∏î‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏ó‡∏∏‡∏Å‡πÅ‡∏ó‡πá‡∏ö)
                2. ‡∏£‡∏≠ ${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ
                3. ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥!
                
                ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ Service Worker ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
            `;
            
            alert(instructions);
        }
        
        // Play sound
        function playSound() {
            try {
                const audio = document.getElementById('notificationSound');
                audio.currentTime = 0;
                audio.play().catch(e => console.log('Cannot play sound:', e));
            } catch (error) {
                console.log('Play sound error:', error);
            }
        }
        
        // Show toast
        function showToast(title, type = 'info', message = '') {
            const container = document.getElementById('toastContainer');
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-times-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            
            toast.innerHTML = `
                <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--${type}); display: flex; align-items: center; justify-content: center; color: white; font-size: 18px;">
                    <i class="fas ${icons[type] || 'fa-info-circle'}"></i>
                </div>
                <div style="flex: 1;">
                    <strong>${title}</strong>
                    ${message ? `<div style="font-size: 0.9rem; color: #666; margin-top: 5px;">${message}</div>` : ''}
                </div>
                <button class="toast-close" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #999; padding: 5px;">&times;</button>
            `;
            
            container.appendChild(toast);
            
            // Auto remove
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.style.opacity = '0';
                    setTimeout(() => {
                        if (toast.parentNode) toast.parentNode.removeChild(toast);
                    }, 300);
                }
            }, 5000);
            
            // Close button
            toast.querySelector('.toast-close').addEventListener('click', () => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    if (toast.parentNode) toast.parentNode.removeChild(toast);
                }, 300);
            });
        }
        
        // Listen for messages from iframe
        window.addEventListener('message', (event) => {
            if (event.data && event.data.type === 'BACKGROUND_NOTIFICATION_SENT') {
                console.log('Background notification sent:', event.data);
                showToast('‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏•‡πâ‡∏ß!', 'success');
            }
        });
        
        // Check for scheduled notifications on page load
        window.addEventListener('load', () => {
            // Check if there are overdue scheduled notifications
            const now = Date.now();
            const overdue = notifications.filter(n => 
                n.type === 'scheduled' && n.scheduledTime <= now
            );
            
            if (overdue.length > 0) {
                overdue.forEach(notification => {
                    showToast('‡∏°‡∏µ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á!', 'warning', notification.title);
                });
            }
        });
    </script>
</body>
</html>
